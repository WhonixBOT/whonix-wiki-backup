{{DISPLAYTITLE:Uninstall Qubes-Whonix}}
{{Header}}
{{#seo:
|description=How to uninstall Qubes-Whonix.
|image=https://www.whonix.org/w/images/5/55/Qubes-logo-icon.png
}}

== Introduction ==
This procedure is useful before a complete re-installation of Qubes-Whonix. <ref>Or if deciding not to use Whonix at all.</ref>

Alternatively it is possible to [[Qubes/Reinstall|Reinstall Qubes-Whonix TemplateVMs]] without uninstallation as documented on this page.

Before Qubes-Whonix TemplateVM packages can be uninstalled, the TemplateVM must not be used by any VMs. Otherwise Qubes prohibits removal. Therefore either delete the VM as documented below [[#Stop using Whonix TemplateVMs in VM Template Settings|Stop using Whonix TemplateVMs in VM Template Settings]].

== Remove Whonix-Workstation TemplateBasedAppVMs ==
The <code>anon-whonix</code> Whonix-Workstation TemplateBasedAppVM <ref name=vm-type-spelling>
[https://www.qubes-os.org/doc/glossary/ Qubes glossary] documents <code>TemplateBasedVM</code>, <code>TemplateBasedVMs</code> and <code>TemplateBasedHVM</code>. So the spelling of <code>TemplateBasedAppVMs</code> and <code>TemplateBasedProxyVMs</code> should be correct.
</ref> must be manually removed. Alternatively you could [[#Stop using Whonix TemplateVMs in VM Template Settings|Stop using Whonix TemplateVMs in VM Template Settings]].

In the case of previously used <code>anon-whonix</code>, strongly consider backups of anything important before proceeding. 

{{Box|text=
'''1.''' Remove <code>anon-whonix</code>.

{{Box|text=
<code>Qube Manager</code> -> <code>right-click Whonix TemplateBasedAppVM</code> <code>anon-whonix</code> -> <code><u>D</u>elete qube</code> <ref>
{{CodeSelect|code=
qvm-remove anon-whonix
}}
</ref>
}}

'''2.''' Repeat the above step for any other TemplateBasedAppVMs based on Whonix-Workstation TemplateVM <code>{{whonix-ws}}</code> in case you had created any earlier. Replace <code>vm-name</code> with the actual name of the VM.

{{Box|text=
<code>Qube Manager</code> -> <code>right-click Whonix TemplateBasedAppVM</code> <code>vm-name</code> -> <code><u>D</u>elete qube</code> <ref>
{{CodeSelect|code=
qvm-remove vm-name
}}
</ref>
}}
}}

== Remove the Whonix-Workstation DVM Template ==
The <code>{{whonix-ws}}-dvm</code> domain must be manually removed. Alternatively you could [[#Stop using Whonix TemplateVMs in VM Template Settings|Stop using Whonix TemplateVMs in VM Template Settings]].

In the case of customized Whonix-Workstation DVM Template, strongly consider backups of anything important before proceeding. 

{{Box|text=
{{Qubes_Terminal}}

'''1.''' Set the default DispVM for <code>anon-whonix</code> to <code>""</code>. This is only required chose skipping removal of <code>anon-whonix</code> as documented above.

{{CodeSelect|code=
qvm-prefs anon-whonix default_dispvm ""
}}

'''2.''' Repeat the above step for any other TemplateBasedAppVMs based on Whonix-Workstation TemplateVM <code>{{whonix-ws}}</code> in case you had created any earlier. Replace <code>vm-name</code> with the actual name of the VM.

{{CodeSelect|code=
qvm-prefs vm-name default_dispvm ""
}}

'''3.''' Set the default DispVM for <code>{{whonix-ws}}-dvm</code> to <code>""</code>.

{{CodeSelect|code=
qvm-prefs {{whonix-ws}}-dvm default_dispvm ""
}}

'''4.''' Remove <code>{{whonix-ws}}-dvm</code>.

{{CodeSelect|code=
qvm-remove {{whonix-ws}}-dvm
}}

'''5.''' The process of removing <code>{{whonix-ws}}-dvm</code> is now complete.
}}

== Stop using Whonix-Gateway as Qubes UpdateVM ==
Set Qubes dom0 UpdateVM to <code>sys-firewall</code> or any other VM of our choice.

Note: Upgrades will be no longer torified.

This is only required if you previously elected to update dom0 thorough Whonix. In any case it is a good idea to check Qubes dom0 UpdateVM setting.

{{Box|text=
<code>Qubes Manager</code> -> <code>System</code> -> <code>Global Settings</code> -> <code>Dom0 UpdateVM:</code> <code>sys-firewall</code></code> -> <code>OK</code> <ref>
To revert this change, run.

{{CodeSelect|code=
qubes-prefs updatevm sys-firewall
}}
</ref>
}}

== Stop using Whonix-Gateway as NetVM for any VM ==
If you configured any VM to use <code>sys-whonix</code> as NetVM for any VM, this change need to be undone.

Note: The VM's traffic will be no longer torified.

This is only required if you previously elected to update any VMs thorough Whonix. In any case it is a good idea to check the NetVM setting of Qubes VMs.

{{Box|text=
To set the NetVM of any VM to <code>None</code>, in other words, to disable networking.

<code>Qube Manager</code> -> <code>right-click</code> <code>vm-name</code> -> <code>NetVM</code> -> <code>None</code> -> <code>OK</code> <ref>
{{CodeSelect|code=
qubes-prefs --set vm-name netvm ""
}}
</ref>

Alternatively you can also set the <code>NetVM</code> to <code>sys-firewall</code> or another ProxyVM of your choice. However, traffic will not be torified (unless you are using cloned VMs).
}}

== Remove Whonix-Gateway TemplateBasedProxyVMs ==
The <code>sys-whonix</code> Whonix-Gateway TemplateBasedProxyVM <ref name=vm-type-spelling /> must be manually removed. Alternatively you could [[#Stop using Whonix TemplateVMs in VM Template Settings|Stop using Whonix TemplateVMs in VM Template Settings]].

In the case of previously used <code>sys-whonix</code>, consider backups before proceeding. This might be custom [[Tor]] configuration, [[Onion Services]] configuration, [[Bridges]] configuration or Tor data to persist [[Tor Entry Guards]].

{{Box|text=
'''1.''' Remove <code>sys-whonix</code>.

{{Box|text=
<code>Qube Manager</code> -> <code>right-click</code> <code>sys-whonix</code> -> <code><u>D</u>elete qube</code> <ref>
{{CodeSelect|code=
qvm-remove anon-whonix
}}
</ref>
}}

'''2.''' Repeat the above step for any other TemplateBasedProxyVM based on Whonix-Gateway TemplateVM <code>{{whonix-gw}}</code> in case you had created any earlier. Replace <code>vm-name</code> with the actual name of the VM.

{{Box|text=
<code>Qube Manager</code> -> <code>right-click</code> <code>vm-name</code> -> <code><u>D</u>elete qube</code> <ref>
{{CodeSelect|code=
qvm-remove vm-name
}}
</ref>
}}
}}

== Stop using Whonix TemplateVMs in VM Template Settings ==
If a Whonix TemplateVM is set as the underlying TemplateVM for any VMs, the TemplateVM cannot be removed. Therefore either delete the VM as documented above or unset the TemplateVM using Qube Manager. <ref>
Or command line.
</ref>

The advantage of setting a <code>dummy</code> template as the TemplateVM is the ability to retain any VMs, along with the user storage contents.

{{Box|text=
{{Box|text=
'''1.''' {{Qubes Dummy Template}}
}}

'''2.''' Shut down the Whonix TemplateVM if already running: <code>Qube Manager</code> -> <code>right-click Whonix TemplateVM</code> -> <code><u>S</u>hutdown qube</code> <ref>
{{CodeSelect|code=
qvm-shutdown vm-name
}}
</ref><br /> 
'''3.''' Set the <code>dummy</code> template as the TemplateVM: <code>right-click VM</code> -> <code>Qube s<u>e</u>ttings</code> -> <code>Template:</code> <code>dummy</code> <ref>
{{CodeSelect|code=
qvm-prefs --set vm-name template dummy
}}
</ref>

The process of setting the TemplateVM of the VM to the <code>dummy</code> template is now complete.
}}

== Stop using Whonix-Gateway for torified TemplateVM Updates ==
In technical terms, stop using Whonix-Gateway as UpdatesProxy for any TemplateVMs.

Open <code>/etc/qubes-rpc/policy/qubes.UpdatesProxy</code> with root rights.

TODO

== Uninstall Whonix TemplateVMs ==
=== Introduction ===
{{mbox
| image   = [[File:Ambox_warning_pn.svg.png|40px|alt=Whonix first time users warning]]
| text    = 
Note that the root filesystem will be lost when uninstalling the TemplateVM.
}}


This matters in the case of customized TemplateVMs. If that applies, strongly consider backups of anything important before proceeding.

{{mbox
| image   = [[File:Ambox_warning_pn.svg.png|40px]]
| text    = 
Whonix (or any) TemplateVM in Qubes cannot be removed if any other VM is still using them. See [[#Introduction|introduction]].
}}

=== Whonix-Gateway ===

# Open a dom0 terminal: <code>Qubes App Launcher (blue/grey "Q")</code> -> <code>System Tools</code> -> <code>Xfce Terminal</code>
# Uninstall <u>all</u> Qubes-Whonix-Gateway template packages matching <code>qubes-template-whonix-gw*</code>: <ref name=matching>
Note the matching syntax below and the effect of running <code>qubes-template-whonix-gw'''*'''</code> or <code>qubes-template-whonix-ws<u>*</u></code>. Also note the asterisk <code>*</code> wildcard at the end. Depending on the Whonix version, this leads to multiple template packages being uninstalled if they are present:

* <code>qubes-template-whonix-gw</code> (Whonix 13)
* <code>qubes-template-whonix-ws</code> (Whonix 13)
* <code>qubes-template-whonix-gw-14</code> (stable Whonix release)
* <code>qubes-template-whonix-ws-14</code> (stable Whonix release)
* <code>qubes-template-whonix-gw-15</code> (future Whonix release)
* <code>qubes-template-whonix-ws-15</code> (future Whonix release)

Wildcards are used so these instructions are valid for all old and future versions of Whonix. Alternatively, the asterisk <code>*</code> syntax could be replaced with a specific template package listed above.
</ref>

{{CodeSelect|code=
sudo dnf remove qubes-template-whonix-gw*
}}

Review the <code>dnf</code> confirmation output before proceeding.

=== Whonix-Workstation ===

# Open a dom0 terminal: <code>Qubes App Launcher (blue/grey "Q")</code> -> <code>System Tools</code> -> <code>Xfce Terminal</code>
# Uninstall <u>all</u> Qubes-Whonix-Workstation template packages matching <code>qubes-template-whonix-ws*</code>:  <ref name=matching />
{{CodeSelect|code=
sudo dnf remove qubes-template-whonix-ws*
}}

Review the <code>dnf</code> confirmation output before proceeding.

=== All Whonix Template Packages ===

# Open a dom0 terminal: <code>Qubes App Launcher (blue/grey "Q")</code> -> <code>System Tools</code> -> <code>Xfce Terminal</code>
# Uninstall <u>all</u> Qubes-Whonix template packages matching <code>qubes-template-whonix*</code>: <ref name=matching />
{{CodeSelect|code=
sudo dnf remove qubes-template-whonix*
}}

Review the <code>dnf</code> confirmation output before proceeding.

== Done ==
The process of uninstallation of Whonix is now complete.

= Footnotes =
{{reflist|close=1}}

{{Footer}}

[[Category:Documentation]]
