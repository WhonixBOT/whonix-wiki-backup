{{DISPLAYTITLE:Uninstall Qubes-Whonix}}
{{Header}}
{{#seo:
|description=How to uninstall Qubes-Whonix.
|image=https://www.whonix.org/w/images/5/55/Qubes-logo-icon.png
}}

== Introduction ==
This procedure is useful before a complete re-installation of Qubes-Whonix. <ref>Or if deciding not to use Whonix at all.</ref>

Note that removal or recreation of Whonix ProxyVMs (<code>sys-whonix</code>) and AppVMs (<code>anon-whonix</code>) is a separate issue. TODO: document removal

== Stop using Whonix TemplateVMs in VM Template Settings ==
If a Whonix TemplateVM is set as the underlying TemplateVM for any VMs, the TemplateVM cannot be removed. Either:

* '''Option A:''' Unset the TemplateVM using Qube Manager:

The advantage of setting a <code>dummy</code> template as the TemplateVM is the ability to retain any VMs, along with the user storage contents.

{{Box|text=
'''1.''' Create the <code>dummy</code> TemplateVM. <ref>
* https://www.qubes-os.org/doc/reinstall-template/
* https://github.com/QubesOS/qubes-issues/issues/4437
</ref>

{{Box|text=
{{Qubes_Terminal}}

Execute the following commands.

{{Box|text=
Qubes R3.2:

{{CodeSelect|code=
mkdir -p /var/lib/qubes/vm-templates/dummy
}}
{{CodeSelect|code=
touch /var/lib/qubes/vm-templates/dummy/{root.img,private.img}
}}
{{CodeSelect|code=
qvm-add-template dummy
}}
}}

{{Box|text=
Qubes R4:

{{CodeSelect|code=
qvm-create --class TemplateVM --label red dummy
}}
}}

The process of creating the <code>dummy</code> TemplateVM is now complete.
}}

'''2.''' Shut down the Whonix TemplateVM if already running: <code>Qube Manager</code> -> <code>right-click Whonix TemplateVM</code> -> <code><u>S</u>hutdown qube</code> <ref>
{{CodeSelect|code=
qvm-shutdown vm-name
}}
</ref><br /> 
'''3.''' Set the <code>dummy</code> template as the TemplateVM: <code>right-click VM</code> -> <code>Qube s<u>e</u>ttings</code> -> <code>Template:</code> <code>dummy</code> <ref>
{{CodeSelect|code=
qvm-prefs --set vm-name template dummy
}}
</ref>

The process of setting the TemplateVM of the VM to the <code>dummy</code> template is now complete.
}}

<u>OR</u>

* '''Option B:''' Delete the VMs that depend on the Whonix template(s):
{{Box|text=
<code>Qube Manager</code> -> <code>right-click Whonix TemplateVM</code> -> <code><u>D</u>elete qube</code>
}}

== Remove the Whonix-Workstation DVM Template ==

The <code>{{whonix-ws}}-dvm</code> domain must be manually removed.

{{Box|text=
{{Qubes_Terminal}}

Set the default DispVM for <code>{{whonix-ws}}-dvm</code> to <code>""</code>.

{{CodeSelect|code=
qvm-prefs {{whonix-ws}}-dvm default_dispvm ""
}}

Remove <code>{{whonix-ws}}-dvm</code>.

{{CodeSelect|code=
qvm-remove {{whonix-ws}}-dvm
}}

The process of removing <code>{{whonix-ws}}-dvm</code> is now complete.
}}

== Uninstall Whonix TemplateVMs ==

{{mbox
| image   = [[File:Ambox_warning_pn.svg.png|40px|alt=Whonix first time users warning]]
| text    = 
Note that the root filesystem will be lost when uninstalling the TemplateVM.
}}


This matters in the case of customized TemplateVMs. If that applies, strongly consider backups of anything important before proceeding.

=== Whonix-Gateway ===

# Open a dom0 terminal: <code>Qubes App Launcher (blue/grey "Q")</code> -> <code>System Tools</code> -> <code>Xfce Terminal</code>
# Uninstall <u>all</u> Qubes-Whonix-Gateway template packages matching <code>qubes-template-whonix-gw*</code>: <ref name=matching>
Note the matching syntax below and the effect of running <code>qubes-template-whonix-gw'''*'''</code> or <code>qubes-template-whonix-ws<u>*</u></code>. Also note the asterisk <code>*</code> wildcard at the end. Depending on the Whonix version, this leads to multiple template packages being uninstalled if they are present:

* <code>qubes-template-whonix-gw</code> (Whonix 13)
* <code>qubes-template-whonix-ws</code> (Whonix 13)
* <code>qubes-template-whonix-gw-14</code> (stable Whonix release)
* <code>qubes-template-whonix-ws-14</code> (stable Whonix release)
* <code>qubes-template-whonix-gw-15</code> (future Whonix release)
* <code>qubes-template-whonix-ws-15</code> (future Whonix release)

Wildcards are used so these instructions are valid for all old and future versions of Whonix. Alternatively, the asterisk <code>*</code> syntax could be replaced with a specific template package listed above.
</ref>

{{CodeSelect|code=
sudo dnf remove qubes-template-whonix-gw*
}}

Review the <code>dnf</code> confirmation output before proceeding.

=== Whonix-Workstation ===

# Open a dom0 terminal: <code>Qubes App Launcher (blue/grey "Q")</code> -> <code>System Tools</code> -> <code>Xfce Terminal</code>
# Uninstall <u>all</u> Qubes-Whonix-Workstation template packages matching <code>qubes-template-whonix-ws*</code>:  <ref name=matching />
{{CodeSelect|code=
sudo dnf remove qubes-template-whonix-ws*
}}

Review the <code>dnf</code> confirmation output before proceeding.

=== All Whonix Template Packages ===

# Open a dom0 terminal: <code>Qubes App Launcher (blue/grey "Q")</code> -> <code>System Tools</code> -> <code>Xfce Terminal</code>
# Uninstall <u>all</u> Qubes-Whonix template packages matching <code>qubes-template-whonix*</code>: <ref name=matching />
{{CodeSelect|code=
sudo dnf remove qubes-template-whonix*
}}

Review the <code>dnf</code> confirmation output before proceeding.

= Footnotes =
{{reflist|close=1}}

{{Footer}}

[[Category:Documentation]]
