{{Title|
title=Combining Tunnels with Tor
}}
{{#seo:
|description=Instructions on how to combine tunnels (VPN, SSH, proxy) with Tor
}}

It is possible to combine Tor with tunnels like VPNs, proxies and SSH. Your traffic can be sent through both Tor and the second tunnel, in either order. However, this is an advanced topic and appropriate only for special cases. Adding a second connection does not automatically add security, but will add significant complexity. In fact, improper combination of Tor and another service [https://trac.torproject.org/projects/tor/wiki/doc/TorPlusVPN may] decrease your security and anonymity. For almost all users of Whonix, using Tor alone – without a VPN or proxy – is the right choice.

=== Connecting to a tunnel (proxy/VPN/SSH) before Tor ===

''' User -> proxy/VPN/SSH -> Tor -> Internet '''

In this case, your internet traffic will (1) pass through your ISP as proxy/VPN/SSH traffic; (2) exit your proxy/VPN/SSH server as encrypted Tor traffic; (3) enter to the Tor network; (4) exit the Tor network at a Tor exit node as normal internet traffic (encrypted or unencrypted).

''' Possible uses: '''
* You must connect to your VPN or proxy to access the internet.
* Your ISP blocks Tor and Tor bridges but doesn’t block the tunnel-link.
* Fear of de-anonymizing attacks against the Tor network; belief that your VPN or proxy is able to protect your identity in such case.

''' Warnings: '''
* A VPN or proxy that knows your identity and/or location may be more willing and able to compromise your privacy than your ISP.
* If your software configuration doesn’t block all traffic when your connection to your VPN suddenly disconnects, your encrypted Tor traffic will go through your ISP without warning. This is the default nature of most VPN configurations and not an issue specific to Whonix. Workarounds described [in links] below.
* If the use of Tor is dangerous in your area, VPNs or SSH may not provide enough protection (due to software misconfiguration or sophisticated packet inspection). Proxies do not provide encryption and should not be used to hide Tor use.

[[Tunnels/Connecting to a VPN before Tor | How to connect to a VPN before Tor]] (User -> VPN -> Tor -> Internet)

[[Tunnels/Connecting to a proxy before Tor | How to connect to a proxy before Tor]] (User -> proxy -> Tor -> Internet)

[[Tunnels/Connecting to SSH before Tor | How to connect to SSH before Tor]] (User -> SSH -> Tor -> Internet)

=== Connecting to a tunnel (proxy/VPN/SSH) after Tor ===

''' User -> Tor -> proxy/VPN/SSH -> Internet '''

In this case, your internet traffic will (1) pass through your ISP as encrypted Tor traffic; (2) exit the Tor network at a Tor exit node as proxy/VPN/SSH traffic; (3) exit your proxy/VPN/SSH as normal internet traffic (encrypted or unencrypted).

''' Possible uses: '''
* As one part of using a VPN or proxy anonymously for some specific reason.
* You must use Tor, but need to connect to an internet server who bans Tor exit nodes.

''' Warnings: '''
* Even though Tor will hide your IP address from your VPN or proxy, you can still be located with your payment method, usage logs, or other identifying information the service knows about you.
* You will not be able to access Tor hidden services.
* Malware on Whonix-Workstation can't bypass Tor but can ignore your VPN or proxy.
* It is not simple to configure VPNs, SSH or proxies in a foolproof, leak free manner. However, it is impossible for traffic to bybass Tor, even if the VPN or proxy is misconfigured.
* Most the pre-installed software on Whonix-Workstation, including Tor Browser, is configured take advantage of stream isolation. As a side effect, this software will ignore the VPN by default. You must reconfigure this software to disable stream isolation.


[[Tunnels/Connecting to Tor before a VPN| How to connect to Tor before a VPN]] (User -> Tor -> VPN -> Internet)

[[Tunnels/Connecting to Tor before a proxy | How to connect to Tor before a proxy]] (User -> Tor -> proxy -> Internet)

[[Tunnels/Connecting to Tor before SSH | How to connect to Tor before SSH]] (User -> Tor -> SSH -> Internet)

= Comparison Table =
{| class="wikitable" style="background-color: #fff;text-align: center"

! 
! user -> proxy -> Tor -> internet
! user -> VPN/SSH -> Tor -> internet
! user -> Tor -> proxy/VPN/SSH -> internet

|-
! configuration modification applied where
| Whonix-Gateway
| Whonix-Gateway [or host ([[FAQ#What.27s_the_difference_of_installing_a_VPN_on_the_host_versus_installing_on_Whonix-Gateway.3F|FAQ]])]
| Whonix-Workstation

|-
! evade Tor bans by websites
| {{No}}
| {{No}}
| style="background-color: {{Green}}"| possibly

|-
! evade Tor bans by network censors
| style="background-color: {{yellow}}"| maybe <ref>See [[Hide_Tor_and_Whonix_from_your_ISP#Using_a_Proxy]].</ref> <ref>Works only against simplistic IP blocking lists, because connections to such proxies are usually not encrypted.</ref>
| style="background-color: {{yellow}}"| maybe <ref>In these situations, VPNs are also often censored. You might be better off using [[Bridges]].</ref>
| {{No}}

|-
! [[Hide_Tor_and_Whonix_from_your_ISP|Hide Tor and Whonix from your ISP]]
| style="background-color: {{Red}}"| very weak <ref>See [[Hide_Tor_and_Whonix_from_your_ISP#Using_a_Proxy]].</ref>
| style="background-color: {{yellow}}"| maybe <ref>See [[Hide_Tor_and_Whonix_from_your_ISP]].</ref>
| {{No}}

|-
! no loss of [[Stream Isolation]]
| {{Yes}}
| {{Yes}}
| {{No}}

|-
! no {{Code2|reconfiguration}}<ref>Disabling [[Stream Isolation]].</ref> of pre-configured software {{Code2|required}}<ref>If you did not disable [[Stream Isolation]], then applications still pre-configured for Stream Isolation would go only through Tor and not through the extra tunnel-link. It is up to you for which applications you disable Stream Isolation and for which not. If for some reason, you want for example to use gpg through the extra tunnel link, but Tor Browser not, then just disable stream isolation for gpg, but not for Tor Browser.</ref> in order to use extra tunnel-link
| {{Yes}}
| {{Yes}}
| {{No}}

|-
! no permanent exit relay
| style="background-color: {{Green}}"| unaffected
| style="background-color: {{Green}}"| unaffected
| {{No}}

|-
! increased tunnel length
| style="background-color: {{Green}}"| Yes
| style="background-color: {{Green}}"| Yes
| style="background-color: {{Green}}"| Yes

|-
! effects on anonymity
| style="background-color: {{yellow}}"| disputed <ref name=torplusvpn>See [https://trac.torproject.org/projects/tor/wiki/doc/TorPlusVPN Tor Plus VPN or proxy].</ref>
| style="background-color: {{yellow}}"| disputed <ref name=torplusvpn />
| style="background-color: {{yellow}}"| disputed <ref name=torplusvpn />

|-
! [[Tunnel_UDP_over_Tor|Tunnel UDP over Tor]]
| {{No}}
| {{No}}
| Proxy: [[Tunnel_UDP_over_Tor#socks5_proxy_method_.28FAILED.29|<span style="background:#FF9090">No]]<br />
VPN: [[Tunnel_UDP_over_Tor#VPN_method_.28WORKING.29|<span style="background:#90FF90">Yes]]<br />
ssh: [[Tunnel_UDP_over_Tor#SSH_method_.28NOT_DOCUMENTED.29|<span style="background:{{Yellow}}">undocumented]]
|}

= Footnotes =
<references />
