{{Header}}
{{#seo:
|description=Documentation for the NEXT Whonix version! ONLY for developers! No guarantee it really makes into the next Whonix version.
|image=https://www.whonix.org/w/images/3/3f/Place-name-sign-1647341640.jpg
}}

= Warning =
'''Documentation for the NEXT Whonix version! ONLY for developers! No guarantee it really makes into the next Whonix version.'''

= I2P =
4. Adjust I2P Settings:

* I2P Tunnels Settings

Set the Inbound and Outbound Tunnel Length to 0:
{{CodeSelect|code=
sudo sed -i "s/\(.*outbound.length=\).*/\10/g;s/\(.*inbound.length=\).*/\10/g" "/var/lib/i2p/i2p-config/i2ptunnel.config"
}}<ref>It's faster and less connection interrupts. Anonymity is already provided by Tor. No need to leech from Tor/I2P.</ref>

* I2P Router Configuration
(Explanation in order)
<ref>
*change router identity and UDP port when IP changes \n   
*Enable NTCP https://geti2p.net/en/docs/transport/ntcp   
*Disable automatic IP fetching # We dont want/need to publish the Exit-Node IP
*Disable Ipv6 for the NTCP #Unsupported by Tor so we dont need it
*Number of concurrent NTCP connections # Reduced Connections so we dont overload the Tor node with connection attempts
*Disable Udp #Unsupported by Tor
*Sets the source of IP detection
*We dont want/need to publish the Exit-Node IP
*Disable Ipv6 for Udp
*toggles UPNP off # No need for Upnp
*Don't save your IP in the netDB and publish to other I2P routers( https://trac.i2p2.de/ticket/1314#comment:3)
*Sets the bandwidth that is max used by particiapting tunnels # We dont participate in Traffic so no need to share
*Disable In-network Updates # We use apt for that
*Disable time comparisation in I2P router
*Set ntp timesource to localhost
</ref>
more Options 
<ref>
http://www.ugha.i2p.xyz/AdvancedConfigurationOptions , http://echelon.i2p.re/docs/advanced.options.txt and https://trac.i2p2.de/ticket/1677 
</ref>


{{CodeSelect|code=
sudo su -c "cat > "/var/lib/i2p/i2p-config/router.config" << EOF
i2np.laptopMode=true
i2np.ntcp.enable=true
i2np.ntcp.autoip=false
i2np.ntcp.ipv6=false
i2np.ntcp.maxConnections=20
i2np.udp.enable=false
i2np.udp.addressSources=hidden
i2np.udp.ipv6=false
i2np.upnp.enable=false
router.isHidden=true
router.sharePercentage=0
router.updateDisabled=true
time.disabled=true
time.sntpServerList=127.0.0.1
EOF"
}}<ref>UDP is unsupported by Tor. Only outgoing TCP supported by Tor. If you know to use a hidden service, please add this information. Incoming connections are not possible, because [[Install_Software#Whonix-Workstation_is_firewalled|Whonix-Workstation is firewalled]].</ref><ref>Clock Skew Issues: There should be none anymore since Whonix 9 so configuring '''time.sntpServerList=localhost''' is no longer necessary. Please report if they occur. (Old clock skew documentation moved to [[Deprecated#I2P]].)</ref>

= onionshare =
'''Developers only!'''

==== Preparation ====
You need newer control port filter / upgrade to Whonix 14 developers-only. You get it by upgrading to Whonix 14 developers-only.

Upgrade both Whonix-Gateway and Whonix-Workstation to Whonix 14 developers-only. For instructions see:
[[Upgrading_Whonix_13_to_Whonix_14]]

Or use Whonix 13.0.0.1.4 developers-only from https://forums.whonix.org/t/whonix-13-0-0-1-4-developers-only/3486/3 or newer (if existing).

==== Configure Control Port Filter Proxy ====
On Whonix-Gateway.

Control Port Filter Proxy needs some adjustments.

{{CodeSelect|code=
sudo cp /usr/share/tor-controlport-filter-merger/examples/40_onionshare.yml /etc/tor-controlport-filter-merger.d/
}}

Restart Control Port Filter Proxy.

{{CodeSelect|code=
sudo service tor-controlport-filter restart
}}

==== Configure Whonix-Workstation Firewall  ====
Inside Whonix-Workstation.
<ref>As per https://labs.riseup.net/code/issues/7870#note-15 onionshare uses ports 17600 to 17659.</ref>

{{Firewall Settings Workstation}}

Add.

{{CodeSelect|code=
EXTERNAL_OPEN_PORTS+=" $(seq 17600 17659) "
}}

Save.

{{Reload_Firewall_Whonix-Workstation}}

==== enable backports  ====
Add Debian Jessie Backports to repos sources lists.

{{CodeSelect|code=
sudo su -c "echo -e 'deb http://http.debian.net/debian jessie-backports main' > /etc/apt/sources.list.d/jessie-backports.list"
}}

{{Apt-Pinning}}

==== Install Dependencies ====
[[Update]] your package lists.

{{CodeSelect|code=
sudo apt-get update
}}

Install the dependencies from jessie-backports. <ref>[https://github.com/micahflee/onionshare/issues/232#issuecomment-162349804 Requires] [https://packages.debian.org/de/jessie-backports/python3-stem python3-stem] 1.4.1b-1~bpo8+1 or higher. Can be installed from Debian backports.</ref>

{{CodeSelect|code=
sudo apt-get install --no-install-recommends -t jessie-backports python3-stem python3-flask python3-pyqt5 python-nautilus
}}

==== Install onionshare ====
You need to use onionshare 0.9.1 or above, because it has the required support for ephemeral Tor hidden services. <ref>Tor control protocol command add_onion</ref> Install it from git.

{{CodeSelect|code=
git clone https://github.com/micahflee/onionshare.git
}}

==== Start onionshare - regular ====
{{CodeSelect|code=
cd onionshare
}}

{{CodeSelect|code=
cd dev_scripts
}}

{{CodeSelect|code=
./onionshare /usr/bin/nano
}}

==== Start onionshare - stealth ====
{{CodeSelect|code=
sudo su -c "echo -e 'deb http://http.debian.net/debian stretch main' > /etc/apt/sources.list.d/stretch.list"
sudo apt-get update
sudo apt-get install --no-install-recommends -t stretch python3-stem
}}

{{CodeSelect|code=
./onionshare --stealth /usr/bin/nano
}}

==== Hack to get onionshare with stealth Hidden Services Support ====
Developers only.

<pre>
#!/bin/bash

set -x
set -e

sudo su -c "echo -e 'deb http://http.debian.net/debian jessie-backports main' > /etc/apt/sources.list.d/jessie-backports.list"

sudo su -c "echo -e 'deb http://http.debian.net/debian stretch main' > /etc/apt/sources.list.d/stretch.list"

sudo apt-get update

sudo apt-get install --yes --no-install-recommends -t jessie-backports python3-stem python3-flask python3-pyqt5 python-nautilus

sudo apt-get install --yes --no-install-recommends -t stretch python3-stem

## build dependencies
sudo apt-get install -y build-essential fakeroot python3-all python3-stdeb dh-python  python3-flask python3-stem python3-pyqt5 python-nautilus python3-nose

echo 'EXTERNAL_OPEN_PORTS+=" $(seq 17600 17659) "' | sudo tee /etc/whonix_firewall.d/50_user.conf

sudo whonix_firewall

cd onionshare

./install/build_deb.sh 

sudo dpkg -i deb_dist/onionshare_0.9.2-1_all.deb

true $?
</pre>

==== Current Status ====
TODO



Forum discussion:<br />
https://forums.whonix.org/t/feature-request-onionshare-support

= ricochet =
'''Unfinished!''' See also: <br />
* https://github.com/ricochet-im/ricochet/issues/30
* https://github.com/ricochet-im/ricochet/issues/30#issuecomment-271646818

On Whonix-Gateway, Control Port Filter Proxy needs some adjustments.

{{Open with root rights|
filename=etc/tor-controlport-filter.d/40_ricochet.conf
}}

Add the following content.

* https://github.com/Whonix/control-port-filter-python/blob/master/usr/share/tor-controlport-filter/examples/40_ricochet.yml
* https://raw.githubusercontent.com/Whonix/control-port-filter-python/master/usr/share/tor-controlport-filter/examples/40_ricochet.yml

Restart Control P ort Filter Proxy.

<pre>
sudo service control-port-filter-python restart
</pre>

On Whonix-Workstation.

<pre>
echo "EXTERNAL_OPEN_ALL=true" | sudo tee /etc/whonix_firewall.d/50_user.conf
</pre>

= ZeroNet =
* https://phabricator.whonix.org/T597
* https://www.whonix.org/wiki/ZeroNet

= whonixcheck SSL Certificate Pinning =
== How ==
'''UNFINISHED!''' See: https://github.com/Whonix/Whonix/issues/24

'''Advanced users only!'''

In Whonix-Gateway and Whonix-Workstation.

You need {{Code2|torbrowser-launcher}} installed. <ref>Because torbrowser-launcher ships The Tor Projects SSL certificate</ref> Currently only available from {{Code2|wheezy-backports}}.

To enable this on a by case base, use the --pin-tpo-cert command line option. Example.

<pre>
whonixcheck --pin-tpo-cert
</pre>

Or to permanently enable this.

Create a file {{Code2|/etc/whonix.d/50_user.conf}}.

<pre>
sudo nano /etc/whonix.d/50_user.conf
</pre>

Add.

<pre>
PIN_TPO_CERT="true"
</pre>

= Footnotes =
<references/>

{{Footer}}

[[Category:Documentation]]
