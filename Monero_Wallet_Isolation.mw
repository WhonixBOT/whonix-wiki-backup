{{Title|
title=How-to: Use Monero with Wallet Isolation in {{project_name}}
}}
{{Header}}
{{#seo:
|description=Isolate network part (monerod) from wallet part (monero wallet).
}}

{{stub}}

Based on https://www.getmonero.org/resources/user-guides/cli_wallet_daemon_isolation_qubes_whonix.html

== Create App Qubes ==
In dom0.

<code>Qubes VM Manager</code> &rarr; <code>VM</code> &rarr; <code>Create App Qube</code>

* Create Qubes-{{workstation_product_name}} App Qube
** Name: <code>monero-wallet-ws</code>.
** Color: Choose a color label for the {{workstation_product_name}} App Qube.
** Use this template: Choose the {{workstation_product_name}} Template. For example: <code>{{whonix-ws}}</code>.
** Standalone: Leave the Standalone field unchecked.
** Type: Choose the type <code>App Qube</code>.
** Allow networking: Choose <code>none</code>.
** Press: <code>OK</code>.

<code>Qubes VM Manager</code> &rarr; <code>VM</code> &rarr; <code>Create App Qube</code>

* Create <code>monerod-ws</code> App Qube
** Name:  <code>monerod-ws</code>.
** Color: Choose a color label for the {{workstation_product_name}} App Qube.
** Use this template: Choose the {{workstation_product_name}} Template. For example: <code>{{whonix-ws}}</code>.
** Standalone: Leave the Standalone field unchecked.
** Type: Choose the type <code>App Qube</code>.
** Allow networking: Choose the desired {{gateway_product_name}} ProxyVM from the list. For example: <code>{{gateway_product_name_vm}}</code>.
** Press: <code>OK</code>.
** Make sure this workstation has enough private storage. You can estimate how much space you need by checking the size of the raw blockchain. Keep in mind that the blockchain will take up more space with time.

== Configuration ==
=== <code>monero<u>d</u>-ws</code> User Systemd Unit Configuration ===
'''Note:''' The following instructions should be applied in {{workstation_product_name}} ([[{{q project name short}}|{{q project name}}]]: App Qube <code>monero<u>d</u>-ws</code>).

'''1.''' Create folder <code>~/.config/systemd/user</code>.

{{CodeSelect|code=
mkdir -p ~/.config/systemd/user
}}

'''2.''' Create file <code>~/.config/systemd/user/monero<u>d</u>.service</code>.

{{Open File|
filename=~/.config/systemd/user/monerod.service
}}


'''3.''' Paste the following contents. <ref>
Do not use <code>--detach</code> - outdated style for daemons. Better error handling without.
</ref>

{{CodeSelect|code=
[Unit]
Description=Monero Full Node
After=network.target

[Service]
User=user
Group=user

Type=simple
PIDFile=/home/user/.bitmonero/monerod.pid

ExecStart=DNS_PUBLIC=tcp TORSOCKS_ALLOW_INBOUND=1 torsocks monerod --data-dir=/home/user/.bitmonero \
    --no-igd --hide-my-port --pidfile=/home/user/.bitmonero/monerod.pid \
    --log-file=/home/user/.bitmonero/bitmonero.log --p2p-bind-ip=127.0.0.1
    
     monerod --p2p-bind-ip 127.0.0.1 --no-igd 

Restart=always
PrivateTmp=true

[Install]
WantedBy=default.target
}}

'''4.''' Save.

'''5.''' Reload systemd user instance.

{{CodeSelect|code=
systemctl --user daemon-reload
}}

'''6.''' Optional: Enable autostart for the <code>monero<u>d</u></code> systemd user instance.

{{CodeSelect|code=
systemctl --user enable monerod
}}

'''7.''' Start <code>monero<u>d</u></code> systemd user instance.

{{CodeSelect|code=
systemctl --user restart monerod
}}

'''8.''' Done.

Creation and configuration of <code>monero<u>d</u></code> systemd user unit has been completed.




=== <code>monero-wallet-ws</code> User Systemd Unit Configuration ===
'''Note:''' The following instructions should be applied in {{workstation_product_name}} ([[{{q project name short}}|{{q project name}}]]: App Qube <code>monero-wallet-ws</code>).

'''1.''' Create folder <code>~/.config/systemd/user</code>.

{{CodeSelect|code=
mkdir -p ~/.config/systemd/user
}}

'''2.''' Create file <code>~/.config/systemd/user/socat.service</code>.

{{Open File|
filename=~/.config/systemd/user/socat.service
}}

'''3.''' Paste the following contents.

{{CodeSelect|code=
[Unit]
Description=socat to Monero
After=network.target

[Service]
User=user
Group=user
Type=simple
Restart=always
PrivateTmp=true

ExecStart=socat TCP-LISTEN:18081,fork,bind=127.0.0.1 EXEC:"qrexec-client-vm monerod-ws user.monerod"

[Install]
WantedBy=default.target
}}

'''4.''' Save.

'''5.''' Reload systemd user instance.

{{CodeSelect|code=
systemctl --user daemon-reload
}}

'''6.''' Optional: Enable autostart for the <code>socat</code> systemd user instance.

{{CodeSelect|code=
systemctl --user enable socat
}}

'''7.''' Start <code>socat</code> systemd user instance.

{{CodeSelect|code=
systemctl --user restart socat
}}

'''8.''' Done.

Creation and configuration of <code>socat</code> systemd user unit has been completed.
