{{Title|
title=How-to: Use Monero with Wallet Isolation in {{project_name}}
}}
{{Header}}
{{#seo:
|description=Isolate network part (monerod) from wallet part (monero wallet).
}}

= Introduction =
{{stub}}

The connection scheme is <code>Monero Wallet</code> &rarr; <code>monero<u>d</u></code> &rarr; <code>Tor</code> &rarr; <code>Monero network</code>.

[[Root#Inappropriate_Use_of_Root_Rights|Inappropriate Use of Root Rights]] should be avoided. Instructions on this wiki page have been carefully crafted with when to use and when not to use <code>sudo</code> in mind. The user should not use <code>sudo</code> unless instructed in documentation. <ref>
The <code>systemctl --user</code> must be run as normal, non-root user without <code>sudo</code> because these are <code>systemd</code> <u>user</u> units and <u>not</u> <code>systemd</code> <u>system</u> units.
</ref>

{{Testers-Only}}

Based on https://www.getmonero.org/resources/user-guides/cli_wallet_daemon_isolation_qubes_whonix.html

= Setup =
== Create App Qubes ==
In dom0.

<code>Qubes VM Manager</code> &rarr; <code>VM</code> &rarr; <code>Create App Qube</code>

* Create Qubes-{{workstation_product_name}} App Qube
** Name: <code>monero-wallet-ws</code>.
** Color: Choose a color label for the {{workstation_product_name}} App Qube.
** Use this template: Choose the {{workstation_product_name}} Template. For example: <code>{{whonix-ws}}</code>.
** Standalone: Leave the Standalone field unchecked.
** Type: Choose the type <code>App Qube</code>.
** Allow networking: Choose <code>none</code>.
** Press: <code>OK</code>.

<code>Qubes VM Manager</code> &rarr; <code>VM</code> &rarr; <code>Create App Qube</code>

* Create <code>monero<u>d</u>-ws</code> App Qube
** Name:  <code>monero<u>d</u>-ws</code>.
** Color: Choose a color label for the {{workstation_product_name}} App Qube.
** Use this template: Choose the {{workstation_product_name}} Template. For example: <code>{{whonix-ws}}</code>.
** Standalone: Leave the Standalone field unchecked.
** Type: Choose the type <code>App Qube</code>.
** Allow networking: Choose the desired {{gateway_product_name}} ProxyVM from the list. For example: <code>{{gateway_product_name_vm}}</code>.
** Press: <code>OK</code>.
** Make sure this workstation has enough private storage. You can estimate how much space you need by checking the size of the raw blockchain. Keep in mind that the blockchain will take up more space with time.

== <code>monero<u>d</u>-ws</code> VM Configuration ==
'''Note:''' The following instructions should be applied in {{workstation_product_name}} ([[{{q project name short}}|{{q project name}}]]: App Qube <code>monero<u>d</u>-ws</code>).

'''1.''' Create folder <code>~/.config/systemd/user</code>.

{{CodeSelect|code=
mkdir -p ~/.config/systemd/user
}}

'''2.''' Create file <code>~/.config/systemd/user/monero<u>d</u>.service</code>.

{{Open File|
filename=~/.config/systemd/user/monerod.service
}}

'''3.''' Paste the following contents. <ref>
Do not use <code>--detach</code> - outdated style for daemons. Better error handling without.
</ref>

{{CodeSelect|code=
[Unit]
Description=Monero Full Node
After=network.target

[Service]
User=user
Group=user

Type=simple
PIDFile=/home/user/.bitmonero/monerod.pid

ExecStart=DNS_PUBLIC=tcp TORSOCKS_ALLOW_INBOUND=1 torsocks monerod --data-dir=/home/user/.bitmonero \
    --no-igd --hide-my-port --pidfile=/home/user/.bitmonero/monerod.pid \
    --log-file=/home/user/.bitmonero/bitmonero.log --p2p-bind-ip=127.0.0.1
    
     monerod --p2p-bind-ip 127.0.0.1 --no-igd 

Restart=always
PrivateTmp=true

[Install]
WantedBy=default.target
}}

'''4.''' Save.

'''5.''' Reload systemd user instance.

{{CodeSelect|code=
systemctl --user daemon-reload
}}

'''6.''' Optional: Enable autostart for the <code>monero<u>d</u></code> systemd user instance.

{{CodeSelect|code=
systemctl --user enable monerod
}}

'''7.''' Start <code>monero<u>d</u></code> systemd user instance.

{{CodeSelect|code=
systemctl --user restart monerod
}}

'''8.''' Done.

Creation and configuration of <code>monero<u>d</u></code> systemd user unit has been completed.

== <code>monero-wallet-ws</code> VM Setup ==
'''Note:''' The following instructions should be applied in {{workstation_product_name}} ([[{{q project name short}}|{{q project name}}]]: App Qube <code>monero-wallet-ws</code>).

'''1.''' Create folder <code>/usr/local/lib/systemd/system/</code>.

{{CodeSelect|code=
sudo mkdir -p /usr/local/etc/anon-ws-disable-stacked-tor.d/
}}

'''2.''' Create file <code>/usr/local/etc/anon-ws-disable-stacked-tor.d/50_user.conf</code>.

{{Open File|
filename=/usr/local/etc/anon-ws-disable-stacked-tor.d/50_user.conf
}}

'''3.''' Paste the following contents.

{{CodeSelect|code=
socat TCP-LISTEN:18081,fork,bind=127.0.0.1 EXEC:"qrexec-client-vm monerod-ws user.monerod" &
}}

'''4.''' Save.

'''5.''' Restart <code>[[Dev/anon-ws-disable-stacked-tor|anon-ws-disable-stacked-tor]]</code> systemd system instance.

{{CodeSelect|code=
sudo systemctl restart anon-ws-disable-stacked-tor
}}

'''6.''' Done.

Automatically starting the <code>socat</code> process has been completed.

= Usage =
'''Note:''' The following instructions should be applied in {{workstation_product_name}} ([[{{q project name short}}|{{q project name}}]]: App Qube <code>monero-wallet-ws</code>).

Start Monero Wallet CLI.

{{CodeSelect|code=
monero-wallet-cli
}}

= Monitoring =
'''Note:''' The following instructions should be applied in {{workstation_product_name}} ([[{{q project name short}}|{{q project name}}]]: App Qube <code>monero<u>d</u>-ws</code>).

Check the status of the <code>monero<u>d</u></code> systemd user service.

{{CodeSelect|code=
systemctl --user status monerod
}}

Follow the journal log of the <code>monero<u>d</u></code> systemd user service.

{{CodeSelect|code=
journalctl --boot --user -f -u monerod
}}

Follow the log file of the <code>monero<u>d</u></code>.

{{CodeSelect|code=
tail -f ~/.bitmonero/bitmonero.log
}}

View the log file of <code>monero<u>d</u></code>.

{{Open File|filename=
~/.bitmonero/bitmonero.log
}}

= See Also =
* [[Money]]
* [[Monero]]

= Donations =
After installing the Monero with wallet isolation server, please consider making a donation to Monero and {{project name}} project ([[Donate]]) to help keep it running for many years to come.

{{Pay Monero Specific}}

= Footnotes =
{{reflist|close=1}}

{{Footer}}

[[Category:Documentation]]
