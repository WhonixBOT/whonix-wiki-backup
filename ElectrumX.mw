{{Title|
title=How-to: Use ElectrumX Personal Server in {{project_name}}
}}
{{Header}}
{{#seo:
|description=Own Bitcoin Server for Higher Privacy
}}

{{stub}}

= Installation =
== Dependency Installation ==
'''Note:''' The following instructions should be applied in {{workstation_product_name}} ([[{{q project name short}}|{{q project name}}]]: In Template <code>{{whonix-ws}}</code>).

'''1.''' Install the [[PyLRU|Install PyLRU]]. <ref>
Not available from packages.debian.org at time of writing.

https:/packages.debian.org/pylru
</ref>

'''2.''' Install [[Bitcoin Core]].

'''3.''' Install dependencies from the Debian repository.

{{Install Package|
package=git python3-rocksdb python3-aiohttp python3-plyvel
}}

== Source Code Download and Digital Software Signature Verification ==
{{Box|text=
'''Note:''' The following instructions should be applied in {{workstation_product_name}} ([[{{q project name short}}|{{q project name}}]]: App Qube <code>anon-whonix</code>).

'''1.''' {{Open_a _product_ws_terminal}}

'''2.''' Acquire the OpenPGP public key of ElectrumX developer SomberNight. <ref>
* https://github.com/spesmilo/electrum/tree/master/pubkeys
* https://github.com/spesmilo/electrum/blob/master/SECURITY.md
</ref>

{{gpg key
|url=scurl-download https://raw.githubusercontent.com/spesmilo/electrum/master/pubkeys/sombernight.asc
|source_filename=sombernight.asc
|fingerprint=6D7A2116DA909E00AC21108BB33B5F232C6271E9
|gpg_fingerprint_output=
In late-2021, the output is identical to the following.

      Key fingerprint = 4AD6 4339 DFA0 5E20 B3F6  AD51 E7B7 48CD AF5E 5ED9
}}

'''3.''' Download the ElectrumX Server source code using <code>git</code>.

{{CodeSelect|code=
git clone https://github.com/spesmilo/electrumx.git
}}

'''4.''' Change directory.

{{CodeSelect|code=
cd electrumx
}}

'''5.''' Digital signature verification.

<u>Note:</u> At the time of writing, <code>1.16.0</code> was the latest stable release. Before starting the ElectrumX source code download, browse to [https://github.com/spesmilo/electrumx/tags <code>github.com/spesmilo/electrumx/tags</code>] to verify the version number.

{{CodeSelect|code=
git tag --verify 1.16.0
}}

{{GnuPG-Success}}

{{GnuPG-Warning}} 

'''6.''' Checkout the git tag.

{{CodeSelect|code=
git checkout 1.16.0
}}
}}

= Configuration =
== Bitcoin-Qt Configuration ==
'''Note:''' The following instructions should be applied in {{workstation_product_name}} ([[{{q project name short}}|{{q project name}}]]: App Qube <code>anon-whonix</code>).

'''x.''' Create folder <code>~/.bitcoin</code>.

{{CodeSelect|code=
mkdir -p ~/.bitcoin
}}

'''x.''' {{Open File|
filename=~/.bitcoin/bitcoin.conf
}}

'''x.''' Paste the following text. <ref>
* <code>prune=0</code> is the default for bitcoind but the Bitcon-Qt GUI has a first start wizard which asks if pruning should be enabled. To avoid that first start wizard and to make sure pruning is disabled, explicitly disable pruning in configuration file.
* Quote electrumx documentation: <blockquote>You must be running a non-pruning bitcoin daemon with <code>txindex=1</code></blockquote>
</ref>

{{CodeSelect|code=
server=1
bind=127.0.0.1
rpcbind=127.0.0.1
rpcallowip=127.0.0.1
txindex=1
prune=0
rpcuser=username
rpcpassword=password
}}

'''x.''' Save.

'''x.''' Disable pruning in Bitcoin-Qt.

<code>Bitcoin Core</code> -> <code>Settings</code> -> <code>Options</code> -> <u>un</u>select <code>Prune block storage to</code> <ref>
Optional since bitcoin-qt options menu says that configuration file overrides bitcoin-qt GUI settings anyhow but better just in case to avoid any potential bugs.
</ref>

'''x.''' Terminate Bitcoin-Qt.

Close terminate Bitcoin-Qt. This is required for the following next step which requires that Bitcoin-Qt is not running.

'''x.''' Reindex the blockchain.

Start Bitcon-Qt from the command line with the <code>-reindex</code> parameter. <ref>
Quote electrumx documentation: <blockquote>If you have an existing installation of bitcoind and have not previously set this you will need to reindex the blockchain with: <code>-reindex</code></blockquote>
</ref>

{{CodeSelect|code=
~/bitcoin-*/bin/bitcoin-qt -reindex
}}

== electrumx Configuration ==

'''x.''' {{Open File|
filename=~/electrumx.conf
}}

'''x.''' Paste the following contents.

{{CodeSelect|code=
COIN=Bitcoin
DB_DIRECTORY=/home/user/.electrumx
DAEMON_URL=username:password@127.0.0.1
SERVICES=rpC://127.0.0.1
PEER_DISCOVERY=self
}}

'''x.''' Save.

== electrumx User Systemd Unit Configuration ==

'''x.''' Create folder <code>~/.config/systemd/user</code>.

{{CodeSelect|code=
mkdir -p ~/.config/systemd/user
}}

'''x.''' {{Open File|
filename=~/.config/systemd/user/electrumx.service
}}

<ref>
Based on <code>~/electrumx/contrib/systemd/electrumx.service</code>
</ref>

'''x.''' Paste the following contents.

{{CodeSelect|code=
[Unit]
Description=Electrumx
After=network.target

[Service]
EnvironmentFile=/home/user/electrumx.conf
ExecStart=/home/user/electrumx/electrumx_server
LimitNOFILE=8192
TimeoutStopSec=30min

[Install]
WantedBy=multi-user.target
}}

'''x.''' Save.

'''x.''' Reload systemd user instance.

{{CodeSelect|code=
systemctl --user daemon-reload
}}

'''x.''' Enable electrumx systemd user instance.

{{CodeSelect|code=
systemctl --user enable electrumx
}}

'''x.''' Start electrumx systemd user instance.

{{CodeSelect|code=
systemctl --user restart electrumx
}}

= Debugging =
{{CodeSelect|code=
systemctl --user status electrumx
}}

{{CodeSelect|code=
journalctl --user -u electrumx
}}

= See Also =
* [[PyLRU]] (Dependency of ElectrumX.)
* [https://github.com/spesmilo/electrumx ElectrumX Source Code Repository]
* [https://electrumx-spesmilo.readthedocs.io ElectrumX Upstream Documentation]
* https://electrumx-spesmilo.readthedocs.io/en/latest/environment.html#services

TODO: remove noindex once this wiki page is good enough
__NOINDEX__

= Footnotes =
{{reflist|close=1}}

{{Footer}}

[[Category:Documentation]]
