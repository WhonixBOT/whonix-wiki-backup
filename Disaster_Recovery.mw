{{Header}}
{{DISPLAYTITLE:Disaster Recovery after Compromise
{{#seo:
|description=Disaster Recovery after Compromise
}}

The goal is to protect others and to re-establish a trusted environment from which future activities will be made private once again. Assuming you are still whole in life and limb and have regained access to your digital property, you can now move forward.


'''Threat model: You know or highly suspect that the host is compromised.'''

0. Hardware is expendable, but data is precious. Consider your current hardware and everything attached to it compromised. Do not use it any longer it's only good for salvaging data. Understand what's done is done. Your private data has been seized, copied, scrutinized and maliciously altered. Continuing to use data from compromised hosts/VMs in clean places risks reinfection if caution is not taken.

1. Acquire a new laptop and external storage with cash from a store. Set up Debian with Whonix.

2. Turn on your compromised machine and connect any untrusted external USB or HDDs to that device and copy everything over to the main disk. Install Onionshare on the host and start a session.

3. Start Onionshare in Whonix on the trusted machine. Connect to your untrusted machine and initiate a transfer session, copying over everything you want to salvage. Move these files out of the Workstation via shared folder.

4. Connect new external storage to your trusted machine and format it with encryption following our [[Full_Disk_Encryption_and_Encrypted_Images#New_Removable_Media|guidelines]]. Move the files back onto it without opening them. Files are innocuous if not opened and so you can copy them over normally to the backup device. Since you cannot be sure if some types of files were infected (PDFs, media) it is recommended you always copy the data you will be working on into the Workstation shared folder and execute it there from within the VM.

5. Once you backed up your data from the old computer, shut it down and permanently discard it along with the infected storage.

6. Consider any and all passwords compromised. Immediately change them using recommended means as per our [[Passwords|password page]].

7. Revoke all keys and generate new pairs then announce to all contacts your key migration and the reason behind it. Put notices on your code repos to alert potential users so they can inspect them for foul play and take precautions. 

8. Study your failures to prevent similar situations in the future. The next time you may not be so lucky to realize that security has been broken. Knowing why your cover was blown is one of the most pieces of information you can gather and share with others. If you follow everything on this wiki diligently and have not left your stuff unattended, then you are down to software vulnerabilities as the only plausible possibility. Post your Tor logs and report what Tor guard you were connected to so the community can piece together if it was part of a coordinated attack on the network. Disclose what hypervisor you used to the upstream security team and explain the situation in detail to bring it to their attention.




'''Threat model: You know or highly suspect that the Workstation is compromised, but there was no VM breakout.'''

1. Transfer your data out of the Workstation via shred folder.

2. Apply steps 6 and 7 from above.

3. Discard the infected Workstation snapshot or VM image.


More complex ideas for recovering from AppVM compromise on Qubes can be found [https://www.qubes-os.org/news/2017/04/26/qubes-compromise-recovery/ here]. However it may not be necessary as the steps above should be applicable to any hypervisor and are easier to grasp.



'''Threat model: You know or highly suspect that the Gateway is compromised, but there was no VM breakout.'''

A compromised Gateway has no access to the host resources. Only the Workstation should be considered compromised along with any data that it contains or is in shared folders it can access.

The recovery process is similar to the section on Workstations above. The main reasons for such a security failure can be caused by:

*Installing third party software on the Gateway.
*Browsing the clearnet from software installed on the Gateway on purpose.
*Installing vulnerable services on the Gateway like DHCP that a malcious Workstation can have access to and compromise.
*Using a vulnerable version of apt to perform software updates (this happens occasionally and we notify users).
*A RCE in Tor itself or pluggable transports (extremely imporbable according to its trackrecord).


= Footnotes =
{{reflist|close=1}}

{{Footer}}

[[Category:Documentation]]
