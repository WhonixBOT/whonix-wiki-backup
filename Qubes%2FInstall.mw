{{Header}}
{{#seo:
|description=How to Install Qubes-Whonix 14
|image=https://www.whonix.org/w/images/5/55/Qubes-logo-icon.png
}}
__NOTOC__
= Introduction =
{{Template:Qubes}}

'''First time user?'''<br />
{{First_Time_User}}

'''Installation'''<br />
These instructions apply to Qubes R3.2 and above.

== Remove Old Versions ==

Users who already have any version of Qubes-Whonix installed and wish to perform a complete (re-)install of Qubes-Whonix have to [[Qubes/Uninstall|uninstall Qubes-Whonix]] before proceeding. This applies to everyone who already has Qubes-Whonix installed such as:

* Users who choose to install Qubes-Whonix by the time they installed Qubes.
* Users who installed Qubes-Whonix after installing Qubes.

If you wish to avoid a complete re-installation (thereby loosing all your user data you stored in Whonix VMs unless you have a backup) and prefer to upgrade from Whonix 13 to Whonix 14 this is also possible, in that case please move on to [[Upgrading Whonix 13 to Whonix 14]].

== Update dom0 ==
=== All Qubes Versions ===
To launch a dom0 terminal, click the Qubes App Launcher (blue/grey "Q") and then open the Terminal Emulator (Xfce Terminal).

[[File:qubes-whonix1.png]]

Update Qubes dom0.

{{CodeSelect|code=
sudo qubes-dom0-update
}}

=== Qubes R3.2 Only ===
Update <code>qubes-mgmt-salt-dom0-virtual-machines</code> from Qubes dom0 testing repository. <ref>
[https://github.com/QubesOS/updates-status/issues/631 qubes-mgmt-salt-dom0-virtual-machines v3.2.4] or above required. Contains Qubes-Whonix salt with [https://github.com/QubesOS/qubes-issues/issues/4130 versioned Whonix template names] introduced for Qubes-Whonix 14.
</ref>

{{CodeSelect|code=
sudo qubes-dom0-update --enablerepo=qubes-dom0-current-testing qubes-mgmt-salt-dom0-virtual-machines
}}

=== Qubes R4 Only ===
* Qubes R4 users must also install <code>qubes-core-admin-addon-whonix</code>.

{{CodeSelect|code=
sudo qubes-dom0-update qubes-core-admin-addon-whonix
}}

* Testers see footnotes: <ref>
The following command will configure Qubes dom0 salt to use Qubes' community-testing-repository for downloading Whonix. 

{{CodeSelect|code=
sudo qubesctl top.enable qvm.whonix-testing pillar=true
}}
</ref> <ref>
* [https://github.com/QubesOS/updates-status/issues/623 qubes-mgmt-salt-dom0-virtual-machines v4.0.13 (r4.0)]
* [https://github.com/QubesOS/qubes-mgmt-salt-dom0-virtual-machines/pull/15 Qubes-Whonix salt - allow choice of repository / don't hardcode repository]
* [https://github.com/QubesOS/qubes-mgmt-salt-dom0-virtual-machines/pull/15  whonix: Add pillar file for easily enabling templates testing repository]
</ref>

== Community Templates Testing Repository ==
<div class="toccolours mw-collapsible mw-collapsed" style="width:800px">
Testers only: The following is only of interest for testers who wish to install from Community Templates Testing Repository.

If you are interested, click on Expand on the right.
<div class="mw-collapsible-content">
View the [https://github.com/QubesOS/qubes-installer-qubes-os/blob/master/qubes-release/qubes-templates.repo <code>/etc/yum.repos.d/qubes-templates.repo</code>] file.

{{CodeSelect|code=
cat /etc/yum.repos.d/qubes-templates.repo
}}

Ensure the file contains <code>[qubes-templates-community-testing]</code>. The following text should be included.

<pre>
[qubes-templates-community-testing]
name = Qubes Community Templates repository
#baseurl = https://yum.qubes-os.org/r$releasever/templates-community-testing
metalink = https://yum.qubes-os.org/r$releasever/templates-community-testing/repodata/repomd.xml.metalink
enabled = 0
fastestmirror = 1
gpgcheck = 1
gpgkey = file:///etc/pki/rpm-gpg/RPM-GPG-KEY-qubes-$releasever-templates-community
</pre>

If the <code>[qubes-templates-community-testing]</code> section is missing, then the user has probably already modified the file. In this case <code>dnf</code> <ref>Which is invoked by <code>qubes-dom0-update</code>.</ref> preserves user changes by saving updates to <code>/etc/yum.repos.d/qubes-templates.repo.rpmnew</code> <ref>Note the file extension <code>.repo.rpmnew</code>.</ref> instead of overwriting the file. Since the <code>.repo.rpmnew</code> file is ignored by <code>qubes-dom0-update</code>, users must manually update the <code>.repo</code> file.

Either:

* Manually add the changes from <code>.repo.rpmnew</code> to the <code>.repo</code> file; or
* Overwrite the <code>.repo</code> file with the <code>.repo.rpmnew</code> file:
** {{CodeSelect|code=
sudo cp /etc/yum.repos.d/qubes-templates.repo.rpmnew /etc/yum.repos.d/qubes-templates.repo
}}
** And then manually add back necessary changes. If the command fails because <code>/etc/yum.repos.d/qubes-templates.repo.rpmnew</code> does not exist, then the user probably has <code>[qubes-templates-community-testing]</code> already.
</div>
</div>

== Configure sys-whonix and anon-whonix ==

To use <code>salt</code> to set up <code>sys-whonix</code> and <code>anon-whonix</code>, run. <ref>
[[Dev/Qubes#salt]]</ref> <ref>
https://github.com/QubesOS/qubes-mgmt-salt-dom0-virtual-machines/blob/master/qvm/anon-whonix.sls
</ref>

{{CodeSelect|code=
sudo qubesctl state.sls qvm.anon-whonix
}}

=== Qubes R4 Only: Optional Whonix DVM Template VM ===

In Qubes R4 and above, users can choose to set up a <code>whonix-ws-dvm</code> DVM Template as a base for [[Qubes/Disposable_VM|Disposable VMs]]. <ref>https://github.com/QubesOS/qubes-mgmt-salt-dom0-virtual-machines/blob/master/qvm/whonix-ws-dvm.sls
</ref>

{{CodeSelect|code=
sudo qubesctl state.sls qvm.whonix-ws-dvm
}}

== Optional: Tor Updates ==

=== TemplateVMs ===

To force all TemplateVM updates over Tor: <ref>https://github.com/QubesOS/qubes-mgmt-salt-dom0-virtual-machines/blob/master/qvm/updates-via-whonix.sls
</ref>

* '''R3.2:''' For each template, manually open VM settings and set NetVM to <code>sys-whonix</code>.
* '''R4:''' The following salt command can be used:
** {{CodeSelect|code=
sudo qubesctl state.sls qvm.updates-via-whonix
}}

=== dom0 ===

To force dom0 updates over Tor, set Qubes dom0 UpdateVM to <code>sys-whonix</code>.

{{CodeSelect|code=
qubes-prefs updatevm sys-whonix
}}

== Optional: Enable AppArmor ==
{{Qubes_AppArmor}}

== Update and Launch Applications ==
 
Users can now [[Qubes/Update|update both Whonix-Gateway and Whonix-Workstation TemplateVMs]], before starting applications in the Whonix-Workstation AppVM. For example, to start [[Tor Browser|Tor browser]]:

<code>
Qubes App Launcher (blue/grey "Q") -> {{Code2|Domain: anon-whonix}} -> Privacy Browser
</code>

To learn about known bugs affecting this release, see [[Known_Issues#Missing_anon-whonix_Qubes_Appmenu_Entries|here]].

== Additional Information ==  
<div class="toccolours mw-collapsible mw-collapsed" style="width:800px">
If you are interested, click on Expand on the right.
<div class="mw-collapsible-content">
* {{Post Install Advice}}
* [[#Stay tuned|Stay tuned]]!

== Known Bugs ==
{{Known_bugs}}

==  Stay Tuned ==
{{Stay_tuned}}
</div>
</div>
== Footnotes ==
{{reflist|close=1}}
{{Template:Qubes}}
{{Footer}}
[[Category:Documentation]]
