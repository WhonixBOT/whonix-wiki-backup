{{Header}}
{{#seo:
|description=How to Install Qubes-Whonix 14
|image=https://www.whonix.org/w/images/5/55/Qubes-logo-icon.png
}}
__NOTOC__
= Introduction =

{{mbox
| image   = [[File:Ambox_warning_pn.svg.png|40px]]
| text       = '''Testers only!'''
}}

{{Template:Qubes}}

'''First time user?'''<br />
{{First_Time_User}}

'''Installation'''<br />
These instructions apply to Qubes R3.2 and above.

== Update dom0 ==

To launch a dom0 terminal, click the Qubes App Launcher (blue/grey "Q") and then open the Terminal Emulator (Xfce Terminal).

[[File:qubes-whonix1.png]]

Update Qubes dom0.

{{CodeSelect|code=
sudo qubes-dom0-update
}}

=== Qubes R4 Only ===

Qubes R4 users must also install <code>qubes-core-admin-addon-whonix</code> from Qubes' dom0 current testing repository. <ref>
[https://github.com/QubesOS/updates-status/issues/583 This issue] must first enter Qubes' stable repository.
</ref>

{{CodeSelect|code=
sudo qubes-dom0-update --enablerepo=qubes-dom0-current-testing qubes-core-admin-addon-whonix
}}

Update <code>mgmt-salt-dom0-virtual-machine</code>. <ref>mgmt-salt-dom0-virtual-machines v4.0.13 or above required. Contains Qubes-Whonix salt allow choice of repository.
</ref>

{{CodeSelect|code=
sudo qubes-dom0-update --enablerepo=qubes-dom0-current-testing mgmt-salt-dom0-virtual-machines
}}

The following command will configure Qubes dom0 salt to use Qubes community testing repository for downloading Whonix. <ref>
* [https://github.com/QubesOS/qubes-mgmt-salt-dom0-virtual-machines/pull/15 Qubes-Whonix salt - allow choice of repository / don't hardcode repository]
* [https://github.com/QubesOS/qubes-mgmt-salt-dom0-virtual-machines/pull/15  whonix: Add pillar file for easily enabling templates testing repository]
</ref>

{{CodeSelect|code=
sudo qubesctl top.enable qvm.whonix-testing pillar=true
}}

== Add Qubes' Community Templates Testing Repository == 

In dom0, upgrade <code>qubes-release</code> to Qubes' dom0 current testing repository. <ref>
The Qubes <code>templates-community-testing</code> repository definition was introduced in [https://github.com/QubesOS/qubes-installer-qubes-os/commit/30cdd9c 30cdd9c9] in Qubes dom0 package [https://github.com/QubesOS/updates-status/issues/582 v3.2-2-qubes-release #582] / [https://github.com/QubesOS/updates-status/issues/584 v4.0-4-qubes-release] which is currently only available in Qubes' <code>qubes-dom0-current-testing</code> repository.
</ref>

{{CodeSelect|code=
sudo qubes-dom0-update --enablerepo=qubes-dom0-current-testing qubes-release
}}

View the [https://github.com/QubesOS/qubes-installer-qubes-os/blob/master/qubes-release/qubes-templates.repo <code>/etc/yum.repos.d/qubes-templates.repo</code>] file.

{{CodeSelect|code=
cat /etc/yum.repos.d/qubes-templates.repo
}}

Ensure the file contains <code>[qubes-templates-itl-testing]</code>. The following text should be included.

<pre>
[qubes-templates-community-testing]
name = Qubes Community Templates repository
#baseurl = https://yum.qubes-os.org/r$releasever/templates-community-testing
metalink = https://yum.qubes-os.org/r$releasever/templates-community-testing/repodata/repomd.xml.metalink
enabled = 0
fastestmirror = 1
gpgcheck = 1
gpgkey = file:///etc/pki/rpm-gpg/RPM-GPG-KEY-qubes-$releasever-templates-community
</pre>

=== Missing Testing Template Repository ===

If the <code>[qubes-templates-itl-testing]</code> section is missing, then the user has probably already modified the file. In this case <code>dnf</code> <ref>Which is invoked by <code>qubes-dom0-update</code>.</ref> preserves user changes by saving updates to <code>/etc/yum.repos.d/qubes-templates.repo.rpmnew</code> <ref>Note the file extension <code>.repo.rpmnew</code>.</ref> instead of overwriting the file. Since the <code>.repo.rpmnew</code> file is ignored by <code>qubes-dom0-update</code>, users must manually update the <code>.repo</code> file.

Either:

* Manually add the changes from <code>.repo.rpmnew</code> to the <code>.repo</code> file; or
* Overwrite the <code>.repo</code> file with the <code>.repo.rpmnew</code> file:
** {{CodeSelect|code=
sudo cp /etc/yum.repos.d/qubes-templates.repo.rpmnew /etc/yum.repos.d/qubes-templates.repo
}}
** And then manually add back necessary changes. If the command fails because <code>/etc/yum.repos.d/qubes-templates.repo.rpmnew</code> does not exist, then the user probably has <code>[qubes-templates-itl-testing]</code> already.

== Download the Whonix Templates ==
{{mbox
| type      = notice
| image   = [[File:Ambox_notice.png|40px|alt=Info]]
| text       = Only the testers version of Whonix requires manual downloading of templates with <code>qubes-dom0-update</code>, <ref>If Qubes <code>salt</code> was used at this step, it would currently download Whonix from <code>qubes-templates-community</code>. See: [https://github.com/QubesOS/qubes-issues/issues/4087 Qubes-Whonix salt - allow choice of repository / don't hardcode repository].</ref> which downloads Whonix from Qubes' dom0 templates-community-testing repository. Users who wish to reinstall the templates should add <code>--action=reinstall</code>.
}}

Download Whonix-Gateway (<code>whonix-gw-14</code>) TemplateVM.

{{CodeSelect|code=
sudo qubes-dom0-update --enablerepo=qubes-templates-community-testing qubes-template-whonix-gw-14
}}

Download Whonix-Workstation (<code>whonix-ws-14</code>) TemplateVM.

{{CodeSelect|code=
sudo qubes-dom0-update --enablerepo=qubes-templates-community-testing qubes-template-whonix-ws-14
}}

== Configure sys-whonix and anon-whonix ==

To use <code>salt</code> to set up <code>sys-whonix</code> and <code>anon-whonix</code>, run. <ref>
[[Dev/Qubes#salt]]</ref> <ref>
https://github.com/QubesOS/qubes-mgmt-salt-dom0-virtual-machines/blob/master/qvm/anon-whonix.sls
</ref>

{{CodeSelect|code=
sudo qubesctl state.sls qvm.anon-whonix
}}

=== Qubes R3.2 Only ===

In Qubes R3.2, users must manually update the TemplateVM setting for <code>sys-whonix</code> and <code>anon-whonix</code>:

# Qubes VM Manager -> sys-whonix -> right click -> VM settings -> Template -> whonix-gw-14 -> OK
# Qubes VM Manager -> anon-whonix -> right click -> VM settings -> Template -> whonix-ws-14 -> OK

=== Qubes R4 Only: Optional Whonix DVM Template VM ===

In Qubes R4 and above, users can choose to set up a <code>whonix-ws-dvm</code> DVM Template as a base for [[Qubes/Disposable_VM|Disposable VMs]]. <ref>https://github.com/QubesOS/qubes-mgmt-salt-dom0-virtual-machines/blob/master/qvm/whonix-ws-dvm.sls
</ref>

{{CodeSelect|code=
sudo qubesctl state.sls qvm.whonix-ws-dvm
}}

== Optional: Tor Updates ==

=== TemplateVMs ===

To force all TemplateVM updates over Tor: <ref>https://github.com/QubesOS/qubes-mgmt-salt-dom0-virtual-machines/blob/master/qvm/updates-via-whonix.sls
</ref>

* '''R3.2:''' For each template, manually open VM settings and set NetVM to <code>sys-whonix</code>.
* '''R4:''' The following salt command can be used:
** {{CodeSelect|code=
sudo qubesctl state.sls qvm.updates-via-whonix
}}

=== dom0 ===

To force dom0 updates over Tor, set Qubes dom0 UpdateVM to <code>sys-whonix</code>.

{{CodeSelect|code=
qubes-prefs updatevm sys-whonix
}}

== Optional: Enable AppArmor ==
{{Qubes_AppArmor}}

== Update and Launch Applications ==
 
Users can now [[Qubes/Update|update both Whonix-Gateway and Whonix-Workstation TemplateVMs]], before starting applications in the Whonix-Workstation AppVM. For example, to start [[Tor Browser|Tor browser]]:

<code>
Qubes App Launcher (blue/grey "Q") -> {{Code2|Domain: anon-whonix}} -> Privacy Browser
</code>

To learn about known bugs affecting this release, see [[Known_Issues#Missing_anon-whonix_Qubes_Appmenu_Entries|here]].

== Additional Information ==  
<div class="toccolours mw-collapsible mw-collapsed" style="width:800px">
If you are interested, click on Expand on the right.
<div class="mw-collapsible-content">
* {{Post Install Advice}}
* [[#Stay tuned|Stay tuned]]!

==  Stay Tuned ==
{{Stay_tuned}}

== Known Bugs ==
{{Known_bugs}}

== Footnotes ==
<references />
</div>
</div>
{{Template:Qubes}}
{{Footer}}
[[Category:Documentation]]
