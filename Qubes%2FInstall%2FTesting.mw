{{Header}}
{{#seo:
|description=How to install Qubes-Whonix 14.
|image=https://www.whonix.org/w/images/5/55/Qubes-logo-icon.png
}}

{{mbox
| image   = [[File:Ambox_warning_pn.svg.png|40px]]
| text       = '''TESTERS ONLY!'''
}}

{{Template:Qubes}}
__NOTOC__

'''First time user?'''<br />
{{First_Time_User}}

'''Installation'''<br />
Use Qubes R3.2 or above.

'''1. Launch dom0 Terminal'''
<code>
Qubes App Launcher (blue/grey "Q")
</code>

[[File:qubes-whonix1.png]]

Then go to:- 
<code>
System Tools -> Konsole
</code>

'''2. Install Qubes-Whonix'''

1. Install <code>qubes-core-admin-addon-whonix</code> from Qubes dom0 current testing repository. <ref>
Waiting for https://github.com/QubesOS/updates-status/issues/583 to enter Qubes stable repository.
</ref>

{{CodeSelect|code=
sudo qubes-dom0-update --enablerepo=qubes-dom0-current-testing qubes-core-admin-addon-whonix
}}

2. Add Qubes Community Templates Testing Repository

In dom0 upgrade <code>qubes-release</code> from Qubes dom0 current testing repository. <ref>
Qubes <code>templates-community-testing</code> repository definition was introduced in [https://github.com/QubesOS/qubes-installer-qubes-os/commit/30cdd9c 30cdd9c9] in Qubes dom0 package [https://github.com/QubesOS/updates-status/issues/582 v3.2-2-qubes-release #582] / [https://github.com/QubesOS/updates-status/issues/584 v4.0-4-qubes-release] which is currently only available in Qubes <code>qubes-dom0-current-testing</code> repository.
</ref>

{{CodeSelect|code=
sudo qubes-dom0-update --enablerepo=qubes-dom0-current-testing qubes-release
}}

View your [https://github.com/QubesOS/qubes-installer-qubes-os/blob/master/qubes-release/qubes-templates.repo <code>/etc/yum.repos.d/qubes-templates.repo</code>].

{{CodeSelect|code=
cat /etc/yum.repos.d/qubes-templates.repo
}}

Make sure your <code>/etc/yum.repos.d/qubes-templates.repo</code> contains <code>[qubes-templates-itl-testing]</code>. The following should be included.

<pre>
[qubes-templates-community-testing]
name = Qubes Community Templates repository
#baseurl = https://yum.qubes-os.org/r$releasever/templates-community-testing
metalink = https://yum.qubes-os.org/r$releasever/templates-community-testing/repodata/repomd.xml.metalink
enabled = 0
fastestmirror = 1
gpgcheck = 1
gpgkey = file:///etc/pki/rpm-gpg/RPM-GPG-KEY-qubes-$releasever-templates-community
</pre>

If that <code>[qubes-templates-itl-testing]</code> section is missing, then it probably is because of this: You previously modified file <code>/etc/yum.repos.d/qubes-templates.repo</code>. In that case <code>dnf</code> <ref>Which gets invoked by <code>qubes-dom0-update</code>.</ref> will have preserved your changes and not actually update that file. The updated file contents can be found in file <code>/etc/yum.repos.d/qubes-templates.repo.rpmnew</code> (note the file extension <code>.rpmnew</code>) but that file will be disregarded during usage of <code>qubes-dom0-update</code>. So this situation must be resolved. <ref>Advanced users could manually take changes from <code>/etc/yum.repos.d/qubes-templates.repo.rpmnew</code> and add them to <code>/etc/yum.repos.d/qubes-templates.repo</code>.</ref> Just overwriting <code>/etc/yum.repos.d/qubes-templates.repo</code> and re-adding your changes should you desire so afterwards is simpler. Overwrite. You will loose eventual <code>/etc/yum.repos.d/qubes-templates.repo</code> modifications.

{{CodeSelect|code=
sudo cp /etc/yum.repos.d/qubes-templates.repo.rpmnew /etc/yum.repos.d/qubes-templates.repo
}}

Should above command fail because <code>/etc/yum.repos.d/qubes-templates.repo.rpmnew</code> did not exist and you already have <code>[qubes-templates-itl-testing]</code>, all good.

'''3. (Testers only) Download Whonix templates'''

Manual download of Whonix using <code>qubes-dom0-update</code> is only required for the testers version of Whonix.<br />

(Otherwise Qubes <code>salt</code> would download Whonix from <code>qubes-templates-community</code>.) <ref>
[https://github.com/QubesOS/qubes-issues/issues/4087 Qubes-Whonix salt - allow choice of repository / don't hardcode repository]
</ref>

Download Whonix from Qubes dom0 templates community testing repository.<br />
(For reinstallation add <code>--action=reinstall</code>.)<br />

Download the Whonix-Gateway (<code>whonix-gw-14</code>) TemplateVM.

{{CodeSelect|code=
sudo qubes-dom0-update --enablerepo=qubes-templates-community-testing qubes-template-whonix-gw-14
}}

Download Whonix-Workstation (<code>whonix-ws-14</code>) TemplateVM.

{{CodeSelect|code=
sudo qubes-dom0-update --enablerepo=qubes-templates-community-testing qubes-template-whonix-ws-14
}}

'''4. Set up sys-whonix and anon-whonix'''

Both, Qubes R3.2 and Qubes R4.0: Use <code>salt</code> to set up <code>sys-whonix</code> and <code>anon-whonix</code>. <ref>
[[Dev/Qubes#salt]]</ref> <ref>
https://github.com/QubesOS/qubes-mgmt-salt-dom0-virtual-machines/blob/master/qvm/anon-whonix.sls
</ref>

{{CodeSelect|code=
sudo qubesctl state.sls qvm.anon-whonix
}}

Qubes R3.2 only: Manually update the TemplateVM setting for <code>sys-whonix</code> and <code>anon-whonix</code>:
  Qubes VM Manager -> sys-whonix -> right click -> VM settings -> Template -> whonix-gw-14 -> OK
  Qubes VM Manager -> anon-whonix -> right click -> VM settings -> Template -> whonix-ws-14 -> OK

'''5. Optional. Qubes R4 and above only. Set up <code>whonix-ws-dvm</code> DVM Template as a base for [[Qubes/Disposable_VM|Disposable VMs]].''' <ref>https://github.com/QubesOS/qubes-mgmt-salt-dom0-virtual-machines/blob/master/qvm/whonix-ws-dvm.sls
</ref>

{{CodeSelect|code=
sudo qubesctl state.sls qvm.whonix-ws-dvm
}}

'''6. Optional. Make all your TemplateVMs update over tor.''' <ref>https://github.com/QubesOS/qubes-mgmt-salt-dom0-virtual-machines/blob/master/qvm/updates-via-whonix.sls
</ref>

Qubes R4 can use salt:
{{CodeSelect|code=
sudo qubesctl state.sls qvm.updates-via-whonix
}}

Qubes R3.2 only manually: For each template, open VM settings and set NetVM to sys-whonix.

'''7. Optional. Make Dom0 update over tor.'''

Set Qubes dom0 UpdateVM to <code>sys-whonix</code>.

{{CodeSelect|code=
qubes-prefs updatevm sys-whonix
}}

'''8. Enable AppArmor''' '''(optional, testers-only security enhancement)'''
{{Qubes_AppArmor}}

'''9. [[Qubes/Update|Update your Whonix-Gateway and Whonix-Workstation TemplateVMs]]'''

'''10. start Whonix-Workstation AppVM'''

For example, start the [[Tor Browser|browser]].

<code>
Qubes App Launcher (blue/grey "Q") -> {{Code2|Domain: anon-whonix}} -> Privacy Browser
</code>

'''11. Known Issues'''

Qubes R3.2 only: See [[Known_Issues#Missing_anon-whonix_Qubes_Appmenu_Entries|Missing anon-whonix Qubes Appmenu Entries]].

'''12. Advanced information''' '''(Optional [security] information.)''' 
<div class="toccolours mw-collapsible mw-collapsed" style="width:800px">
If you are interested, click on Expand on the right.
<div class="mw-collapsible-content">
* {{Post Install Advice}}
* [[#Stay tuned|Stay tuned]]!
* <s>[[Qubes/Disposable_VM|DisposableVM]]</s>

=  Stay tuned =
{{Stay_tuned}}

= Known bugs =
{{Known_bugs}}

= Footnotes =
<references />
</div>
</div>
{{Template:Qubes}}
{{Footer}}
[[Category:Documentation]]
