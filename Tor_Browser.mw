<!--
Copyright:

   Whonix Tor Browser wiki page Copyright (C) Amnesia <amnesia at boum dot org>
   Whonix Tor Browser wiki page Copyright (C) 2012 - 2018 ENCRYPTED SUPPORT LP <adrelanos@riseup.net>
   
   This program is free software; you can redistribute it and/or modify
   it under the terms of the GNU General Public License as published by
   the Free Software Foundation; either version 3 of the License, or
   (at your option) any later version.
         
   This program is distributed in the hope that it will be useful,
   but WITHOUT ANY WARRANTY; without even the implied warranty of
   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
   GNU General Public License for more details.
      
   You should have received a copy of the GNU General Public License
   along with this program; if not, write to:

    Free Software Foundation, Inc. 
    51 Franklin St, Fifth Floor
    Boston, MA 02110-1301, USA.

On Debian GNU/Linux systems, the complete text of the GNU General Public
License can be found in the /usr/share/common-licenses' directory.

The complete text of the GNU General Public License can also be found online on gnu.org <https://www.gnu.org/licenses/gpl.html>, in Whonix virtual machine images in /usr/share/common-licenses/GPL-3 file or on Github <https://github.com/Whonix/Whonix/blob/master/GPLv3>.
-->
<!--
The Whonix Tor Browser wiki page is forked from the Tails Browsing the web with Iceweasel page, from this exact source <http://git.immerda.ch/?p=amnesia.git;a=blob;f=wiki/src/doc/anonymous_internet/iceweasel.mdwn;hb=c65e9614d6df9784072ac1e506e2fc83b062f2b0>.
-->
{{DISPLAYTITLE:Tor Browser Basics}}
{{Header}}
{{#seo:
|description=Using Tor Browser in Whonix. Anonymity vs Pseudonymity, HTTPS Everywhere, Torbutton, Protection against dangerous JavaScript, NoScript, Tips, Update Tor Browser, Browser Plugins, Change Language
|og:image=https://www.whonix.org/w/images/1/19/Torbrowser.png
}}
= Introduction =
{{mbox
| image   = [[File:Ambox_warning_pn.svg.png|40px]]
| text       = '''Warning:''' Only Tor Browser is recommended for use in Whonix when browsing the Internet. <ref>For a comprehensive list of reasons, readers are encouraged to review some or all of the references in this section.</ref>
}}


[https://www.torproject.org/projects/torbrowser.html.en Tor Browser] <ref>https://tb-manual.torproject.org/linux/en-US/</ref> is a [https://en.wikipedia.org/wiki/Fork_(software_development) fork] of the Mozilla [https://www.mozilla.org/en-US/firefox/organizations/ Firefox ESR] web browser. It is developed by [https://www.torproject.org/ The Tor Project] and [https://www.torproject.org/projects/torbrowser/design/ optimized] and [https://www.torproject.org/torbutton/en/design/ designed] for [[Tor]], anonymity and security. Most will have browsed with Firefox and be familiar with the user interface that resembles those found in other popular, modern browsers. <ref>
A good overview of the browser component is provided by [https://www.torproject.org/projects/torbrowser/design/#Implementation The Tor Project design document].
<br />
<blockquote>The Tor Browser is based on Mozilla's Extended Support Release (ESR) Firefox branch. We have a series of patches against this browser to enhance privacy and security. Browser behavior is additionally augmented through the Torbutton extension, though we are in the process of moving this functionality into direct Firefox patches. We also change a number of Firefox preferences from their defaults.

Tor process management and configuration is accomplished through the Tor Launcher addon, which provides the initial Tor configuration splash screen and bootstrap progress bar. Tor Launcher is also compatible with Thunderbird, Instantbird, and XULRunner.

To help protect against potential Tor Exit Node eavesdroppers, we include HTTPS-Everywhere. To provide users with optional defense-in-depth against JavaScript and other potential exploit vectors, we also include NoScript. We also modify several extension preferences from their defaults.

To provide censorship circumvention in areas where the public Tor network is blocked either by IP, or by protocol fingerprint, we include several Pluggable Transports in the distribution. As of this writing, we include Obfs3proxy, Obfs4proxy, Scramblesuit, meek, and FTE.</blockquote>
</ref>

It is encouraged to read this entire wiki entry so Tor Browser is used effectively and safely on the Whonix platform. Advanced users may also be interested in the [[Tor_Browser/Advanced_Users#Tor_Browser_Adversary_ Model|Tor Browser Adversary Model]]. Regularly consult the [https://blog.torproject.org Tor Project blog] to stay in tune with Tor / Tor Browser news and the latest release information.

= Anonymity vs Pseudonymity =
{{mbox
| image   = [[File:Ambox_warning_pn.svg.png|40px]]
| text       = '''Warning:''' Using regular browsers is [[DoNot#Do_not_confuse_Anonymity_with_Pseudonymity.|pseudonymous rather than anonymous]].
}}


If browsers other than Tor Browser are used in Whonix, the IP address and Domain Name Service (DNS) requests <ref>{{Code|DNS is a distributed database which keeps track of computer's names and their corresponding IP addresses on the Internet}} https://web.stanford.edu/class/msande91si/www-spr04/readings/week1/InternetWhitepaper.htm. DNS servers enable the browser to know where resources are located on the Internet, and the corresponding IP address for fetching these.</ref> are still protected. However, only Tor Browser provides [[Tor_Browser#Torbutton|protocol level cleanup]], which includes unique features like proxy obedience, state separation, network isolation, and anonymity set preservation.

In stark contrast to regular browsers, Tor Browser is optimized for anonymity and has a plethora of [https://www.torproject.org/projects/torbrowser/design/#firefox-patches privacy-enhancing patches] and add-ons. <ref>See below for a further description of these features.</ref> By sharing the [[Fingerprint]] of around [https://metrics.torproject.org/userstats-relay-country.html two million other people], Tor Browser users "blend in" with the larger population and better protect their privacy.

= Encryption =
== HTTPS Encryption ==
It is important to understand the difference between HTTP and HTTPS: <ref name=whatishttps>https://en.wikipedia.org/wiki/HTTPS</ref>

<blockquote>HTTPS (also called HTTP over Transport Layer Security (TLS), HTTP over SSL, and HTTP Secure) is a communications protocol for secure communication over a computer network which is widely used on the Internet. HTTPS consists of communication over Hypertext Transfer Protocol (HTTP) within a connection encrypted by Transport Layer Security, or its predecessor, Secure Sockets Layer. The main motivation for HTTPS is authentication of the visited website and protection of the privacy and integrity of the exchanged data.</blockquote>

=== HTTPS Advantages ===
HTTPS advantages include: <ref name=whatishttps />
* Authentication of the website and web server the user is communicating with.
* Protection against [[Warning#Man-in-the-middle_attacks|man-in-the-middle attacks]].
* Bidirectional encryption of communications between a client and server. This protects against [[Warning#Tor_exit_nodes_can_eavesdrop_on_communications|eavesdropping]] and tampering with / forging of communication contents.
* A <i>reasonable</i> expectation that the website being communicated with is genuine. <ref>HTTPS is not foolproof due to reliance on the Certificate Authority (CA) system that issues digital certificates (private keys) for websites. As a trusted third party, this trust can be abused or the CAs can be subject to adversary attacks.</ref>

In the context of Tor Browser, this means HTTPS should be preferred over HTTP so communication is encrypted while browsing the Internet. While traffic is encrypted throughout the Tor network, the exit relay (third of three servers) can see traffic sent into Tor if it is plain HTTP. If HTTPS is used, the exit relay will only know the destination address. <ref>https://www.torproject.org/docs/faq#AmITotallyAnonymous</ref>

As an example, the screenshot below is how the browser looks when visiting the Whonix website. <ref>https://www.whonix.org</ref>

'''Figure:''' ''A Secure Connection to www.whonix.org''

[[File:tbbbbbb.png|600px]]

Take notice of the small area on the left-hand side of the address bar. Indicators of an encrypted connection are  <code>www.whonix.org</code> is highlighted with a padlock and "Secure Connection" in green writing, and the URL begins with ''https://'' instead of ''http://''.

{{mbox
| type      = notice
| image   = [[File:Ambox_notice.png|40px|alt=Info]]
| text       = Try to only use services providing HTTPS when sensitive information is sent or received. Otherwise, passwords, financial / personal information or other sensitive data can be easily stolen or intercepted by eavesdroppers. HTTP webpage contents can also be modified on its way to the browser for malicious purposes.
}}

=== HTTP / HTTPS Connections with and without Tor ===

The following figures from EFF provide an overview of HTTP / HTTPS connections with and without Tor, and what information is visible to various third parties. The descriptors are as follows: <ref>https://www.eff.org/pages/tor-and-https</ref>

<blockquote>Potentially visible data includes: the site you are visiting (SITE.COM), your username and password (USER/PW), the data you are transmitting (DATA), your IP address (LOCATION), and whether or not you are using Tor (TOR).</blockquote> 

'''Figure:''' ''Tor and HTTPS''

[[File:tor-with-https.png|800px]]

'''Figure:''' ''Tor and No HTTPS''

[[File:tor-without-https.png|800px]]

'''Figure:''' ''No Tor and HTTPS''

[[File:without-tor-with-https.png|800px]]

'''Figure:''' ''No Tor and No HTTPS''

[[File:without-tor-https.png|800px]]

== Onion Services Encryption ==
Whenever possible, it is encouraged to stay within the Tor network for communications and web browsing via available <i>.onion</i> addresses. These services are commonly referred to as onion services (formerly "hidden services"), even when their location is publicly known. <ref>https://riseup.net/en/security/network-security/tor/onionservices-best-practices</ref>

=== Onion Services Advantages ===
URLs ending in the <i>.onion</i> extension provide a superior level of security and privacy, since the connection forms a tunnel which is encrypted (end-to-end) using a random rendezvous point within the Tor network; HTTPS is not required. These connections also incorporate [https://en.wikipedia.org/wiki/Perfect_forward_secrecy perfect forward secrecy (PFS)]. PFS means the compromise of long-term keys does not compromise past session keys. As a consequence, past encrypted communications and sessions cannot be retrieved and decrypted if long-term secrets keys or passwords are compromised in the future by adversaries. <ref>This does not however defend against improved cryptanalysis that breaks underlying ciphers being used, for example by the emergence of quantum computers. Only post-quantum ciphers resistant to these attacks will prevail.</ref> 

Other primary benefits of onion services include: <ref>https://www.torproject.org/docs/hidden-services.html.en</ref> 

* Prevention of passive surveillance by network observers and the Tor exit node that is possible when using plain Tor + HTTPS. Adversaries cannot (easily) determine which destination the users are connecting from/to.
* Onion services establish "rendezvous points" in the Tor network for web services whereby neither the hosting service or the user know each other's network identity.
* Onion services can be combined with SSL/TLS to provide additional protection. Only a handful of services currently provide this service, including DuckDuckGo: https://3g2upl4pq6kufc4m.onion and ProtonMail: https://protonirockerxow.onion. <ref>Extra layers of encryption are not really necessary, since a completely encrypted tunnel is already formed (but it certainly does not hurt). Until recently, these certificates would not validate because of the *.onion hostname.</ref> <ref>https://riseup.net/en/security/network-security/tor/onionservices-best-practices</ref>
* Onion services do not use the insecure DNS system. Strong authentication comes from the self-authenticating address: the address itself forms a cryptographic proof of the <i>.onion's</i> identity. <ref>https://blog.torproject.org/blog/cooking-onions-names-your-onions</ref> <ref>This is why onion addresses appear absurdly long and random.</ref>

To learn more about how onion services work, refer to the [[Onion_Services#How_Onion_Services_Connections_Work|technical description]].

= Tor Browser Add-Ons =
== HTTPS Everywhere ==

[[File:httpseverywhere.png|150px|HTTPS Everywhere logo|thumb]]

[https://www.eff.org/https-everywhere HTTPS Everywhere] is a Firefox extension shipped in Tor Browser and produced as a collaboration between [https://torproject.org/ The Tor Project] and the [https://eff.org/ Electronic Frontier Foundation]. It helps to encrypt user communications with a number of major sites. 

Many sites on the Internet offer some limited support for encryption over HTTPS, but make it difficult to use. For instance, sites may default to unencrypted HTTP or fill encrypted pages with links that return to the unencrypted version of site. The HTTPS Everywhere extension addresses these problems by rewriting all site requests to HTTPS.

To learn more about HTTPS Everywhere, visit:

* The [https://www.eff.org/https-everywhere HTTPS Everywhere homepage].
* The [https://www.eff.org/https-everywhere/faq/ HTTPS Everywhere FAQ].

== NoScript ==

[[Image:noscript.png|NoScript logo|thumb]]

NoScript is a free, open source extension that comes bundled with Tor Browser and other Mozilla-based web browsers. NoScript can provide significant protection for users, depending on its configuration: <ref name=no_script>https://en.wikipedia.org/wiki/NoScript</ref>

<blockquote>NoScript allows executable web content based on JavaScript, Java, Flash, Silverlight, and other plugins only if the site hosting is considered trusted by its user and has been previously added to a whitelist. NoScript also offers specific countermeasures against security exploits. ... This is based on the assumption that malicious websites can use these technologies in harmful ways.</blockquote>

NoScript protects against [https://en.wikipedia.org/wiki/Cross-site_scripting cross-site scripting], which otherwise enables attackers to inject malicious client-side scripts into web pages being viewed, bypassing the [https://en.wikipedia.org/wiki/Same-origin_policy same-origin policy]. The same-origin policy refers to web browsers usually only allowing scripts in the first web page to access data in a second web page if they have the same origin (URL scheme, hostname and port number). <ref>[https://noscript.net/faq#clearclick Anti-clickjacking] was also previously available to protect against hidden or disguised user interface elements masquerading as trusted web page buttons, links and so on. Unfortunately this is no longer available in NoScript following the shift to Firefox extensions in Tor Browser based on Firefox 60 ESR. This feature provided protection against malicious activation of microphones or webcams, or users being tricked into interacting with hidden elements to steal important financial, personal or other data.</ref>

With NoScript enabled, a number of tracking services are neutralized because they rely on JavaScript. For instance, a host of operating system and browser configuration details are revealed if JavaScript is not disabled by default. 
<ref name=no_script /> Another unintended benefit concerns the use of system resources. If JavaScript is disabled, studies have shown that bandwidth consumption can be reduced by more than 40 per cent on the top 150 Alexa websites. Similarly, the required system resources to display a web page in the browser is lowered. <ref>https://ianix.com/pub/firefox-addons-and-bandwidth-consumption.html</ref>

=== Security vs Usability Trade-off ===
In the stock Tor Browser configuration, JavaScript is enabled by default for greater usability. The Tor Project FAQ provides a summary of the reasoning for this decision: <ref>https://www.torproject.org/docs/faq#TBBJavaScriptEnabled</ref>

<blockquote>We configure NoScript to allow JavaScript by default in Tor Browser because many websites will not work with JavaScript disabled. Most users would give up on Tor entirely if a website they want to use requires JavaScript, because they would not know how to allow a website to use JavaScript (or that enabling JavaScript might make a website work).<br /> <br />
There's a trade-off here. On the one hand, we should leave JavaScript enabled by default so websites work the way users expect. On the other hand, we should disable JavaScript by default to better protect against browser vulnerabilities ([https://blog.torproject.org/blog/tor-security-advisory-old-tor-browser-bundles-vulnerable not just a theoretical concern!]). But there's a third issue: websites can easily determine whether you have allowed JavaScript for them, and if you disable JavaScript by default but then allow a few websites to run scripts (the way most people use NoScript), then your choice of whitelisted websites acts as a sort of cookie that makes you recognizable (and distinguishable), thus harming your anonymity.</blockquote>

The take-home message is disabling all JavaScript with white-list based, pre-emptive script-blocking may better protect against vulnerabilities (many attacks are based on scripting), <ref>Javascript has previously been used in Windows to [http://www.pcworld.com/article/2046013/tor-project-stop-using-windows-disable-javascript.html deanonymize Tor users with a zero-day exploit] which revealed the computer's MAC address to the attackers.</ref> but it reduces usability on many sites and acts as a fingerprinting mechanism based on the select sites where it is enabled. <ref name=no_script /> On the other hand, allowing JavaScript by default increases usability and the risk of exploitation, but the user also has a fingerprint more in common with the larger pool of users. <ref>Having a large user base is important for strong anonymity, as Roger Dingledine explains [http://www.mail-archive.com/liberationtech@lists.stanford.edu/msg00022.html here.]</ref> <ref>Another related discussion justifying JavaScript's enabling by default was held on tor-talk, "Tor Browser disabling Javascript anonymity set reduction". https://lists.torproject.org/pipermail/tor-talk/2012-May/024227.html</ref>

Developers are unaware of any JavaScript vulnerabilities that could compromise Whonix anonymity. That said, it is inadvisable to change NoScript settings in Tor Browser unless the potential impacts are known. To enable/disable JavaScript, Java and/or plugin execution, left-click the NoScript status bar icon or use the the contextual menu. <ref>https://noscript.net/</ref> Permissions can be selected either temporarily or on a permanent basis. "Temporarily Trusted" will only enable a script(s) for that site until the browser session is closed, or until permission is manually revoked.

{{mbox
| type      = notice
| image   = [[File:Ambox_notice.png|40px|alt=Info]]
| text       = The Torbutton extension's [[#Security_Slider|Security Slider]] (see further below) also involves a security versus usability trade-off. Higher slider levels improve security and reduce usability, while the opposite is true of other settings. Fingerprinting risks are greatly reduced at higher slider levels, but some site functionality may also be lost.
}}


For further information, refer to the [http://noscript.net/ NoScript website] and [http://noscript.net/features features overview], or the [https://www.torproject.org/torbutton/en/design/ Torbutton design document].

=== NoScript Custom Setting Persistence ===

The Tor Project has introduced a new preference in Tor Browser version 8.5a2 allowing you to save your custom NoScript settings between browser restarts. This setting is turned off by default meaning your custom NoScript settings will not persist across successive Tor Browser sessions. 

To save NoScript settings across browser sessions.

Tor Browser address bar: <code>about:config</code> -> <code>"Press" enter</code> -> <code>I accept the risk!</code> -> <code>extensions.torbutton.noscript_persist</code> -> <code>"Toggle" to True</code><ref>https://blog.torproject.org/new-release-tor-browser-85a2</ref>

'''Note:''' Defining custom settings in NoScript will override the current Tor Browser Security Slider setting. When <code>extensions.torbutton.noscript_persist</code> is set to "True", any changes made to NoScript settings will persist across Tor Browser restarts. However, even with the persistent NoSript preference enabled, if the user changes the security slider setting, all custom per-site settings are lost.<ref>https://trac.torproject.orgprojects/tor/ticket/27175#comment:12</ref>  If <code>extensions.torbutton.noscript_persist</code> is set back to "False"<ref>The default Tor Browser setting</ref>, NoScript settings will be reset after Tor Browser syncs with the position of the Tor Browser Security Slider. 

'''Warning:'''
This preference sacrifices privacy for convenience and is therefore ''not'' recommended. While scripts do not need to be enabled or disabled constantly on sites that are frequently visited across Tor Browser restarts, a number of anonymity risks are introduced outlined below: <ref>https://trac.torproject.org/projects/tor/ticket/27175</ref>

1. '''Disk hygiene:''' Tor Browser is designed to be amnesic preventing the storage of history records and other on-disk information. This setting violates that design principle by allowing the storage of NoScript Per-site Permissions and increases the chance of an adversary extracting valuable information from that data.<br>
2. '''Long-term fingerprinting vectors:''' Persistent per-site settings allows websites to profile Tor Browser users, particularly if [https://www.maketecheasier.com/first-party-isolation-firefox/ first-party isolation] is not enforced. For example, consider the negative anonymity impact of whitelisting Google or Facebook, as their advertisements and widgets are ubiquitous.<br>
3. '''Expert opinion:''' Experienced Tor developers have stated that enabling this preference is dangerous and caution is required. <ref>https://trac.torproject.org/projects/tor/ticket/27175#comment:12</ref><br>

== Non-default Add-ons ==
As Tor Browser is based on Firefox, any browser add-on that is compatible with Firefox can also be installed in Tor Browser. In this context, add-ons is the collective name for extensions, themes and plugins: <ref name=plugins>https://tb-manual.torproject.org/en-US/plugins.html</ref> 

* Extensions add new features to Firefox or modify existing ones, like video downloaders, ad blockers and so on.
* Themes change the appearance of the browser, such as buttons, menus and the background image. 
* Plugins add support for Internet content and often include patented formats like Flash and Silverlight which are used for video, audio, online games and more. 
<ref>https://support.mozilla.org/en-US/kb/find-and-install-add-ons-add-features-to-firefox?redirectlocale=en-US&redirectslug=Customizing+Firefox+with+add-ons</ref>

=== Non-default Add-on Risks ===
The Tor Project explicitly warns against using non-default add-ons with Tor Browser: <ref name=plugins />

<blockquote>However, the only add-ons that have been tested for use with Tor Browser are those included by default. Installing any other browser add-ons may break functionality in Tor Browser or cause more serious problems that affect your privacy and security. It is strongly discouraged to install additional add-ons, and the Tor Project will not offer support for these configurations.

...

Video websites, such as Vimeo make use of the Flash Player plugin to display video content. Unfortunately, this software operates independently of Tor Browser and cannot easily be made to obey Tor Browser’s proxy settings. It can therefore reveal your real location and IP address to the website operators, or to an outside observer. For this reason, Flash is disabled by default in Tor Browser, and enabling it is not recommended.</blockquote>

==== Recommendations ====

{{mbox
| image   = [[File:Ambox_warning_pn.svg.png|40px]]
| text       = '''Warning:''' Generally avoid Java, JavaScript, Flash, themes, browser plugins and other non-default add-ons in Tor Browser. 
}}


The problem with non-default add-ons is that they are often comprised of [[non-free]] software, which can lead to the linkage of activities conducted under one pseudonym. They also worsen fingerprinting and open up attack vectors in the form of remote exploits.

This advice holds true even though Whonix is configured to prevent these applications (along with malware) from leaking the real external IP address, even if they are mis-configured (see [[Features]]). Before installing non-default add-ons, first consider the various alternatives such as HTML5 or online media converters. <ref>For example, most [https://www.youtube.com/html5|Youtube videos] can now be viewed in HTML5 which Tor Browser supports and prefers.</ref>

= Torbutton =

Tor alone is not enough to protect anonymity and privacy while browsing the Internet. All modern web browsers support [https://en.wikipedia.org/wiki/JavaScript JavaScript], [https://en.wikipedia.org/wiki/Adobe_Flash Adobe Flash], [https://en.wikipedia.org/wiki/HTTP_cookie cookies] and other features which are capable of defeating the anonymity <ref>[[DoNot#Confuse_Anonymity_with_Pseudonymity]]</ref> provided by the Tor network.

In Tor Browser, these features are handled from inside the browser, because it is a [https://gitweb.torproject.org/tor-browser.git modified (patched) version of Firefox] and it contains an extension called [https://www.torproject.org/torbutton/ Torbutton]: 

<blockquote>Torbutton is the component in Tor Browser that takes care of application-level security and privacy concerns in Firefox. To keep you safe, Torbutton disables many types of active content.</blockquote> <ref>https://www.torproject.org/docs/torbutton/torbutton-faq.html.en</ref>

It is recommended to learn more about [[Fingerprint|Fingerprinting]] and [[Data Collection Techniques]] to better understand the potential threats. Advanced users can also review detailed information about the Torbutton design and its various functions [[Tor_Browser/Advanced_Users#Torbutton_Design|here]].

== New Identity Function ==
The "New Identity" menu option sends the protocol command "signal newnym" to Tor's ControlPort. This clears the browser state, closes tabs, and obtains a fresh Tor circuit for future requests. <ref>https://blog.torproject.org/blog/torbutton-141-released</ref> 

{{mbox
| image   = [[File:Ambox_warning_pn.svg.png|40px]]
| text       = '''Warning:''' The New Identity feature will ''likely'' create a new Tor exit relay and a new IP address, but this is not guaranteed.
}}


Sometimes Tor only replaces the middle relay while using the same Tor exit relay; this is by design and the Tor default. Further, "signal newnym" does not interfere with long-lived connections such as an IRC connection.

New Identity is not yet perfect and there are open bugs; this is not a Whonix-specific issue. {{Browser_Fingerprinting_Footnote}}
For greater security, it is better to completely close Tor Browser and restart it. In [[Qubes-Whonix]], the safest option is using a Whonix-Workstation [[Qubes/DisposableVM|DisposableVM]] and closing it and recreating a new one after critical activities.

There are two ways to use the Torbutton New Identity feature.

# <code>Left-click the Hamburger Icon</code> -> <code>Select "New Identity"</code> <br />
# <code>Left-click Torbutton</code> -> <code>New <u>I</u>dentity</code>

Please read [[FAQ#New_Identity_and_Tor_Circuits|New Identity and Tor Circuits]] and the [[Tor_Browser/Advanced_Users#New_Identity_Design|New Identity Design]] to learn more about this option and its limitations.

== New Tor Circuit Function ==

The "New Tor Circuit for this Site" Torbutton feature causes a new circuit to be created for the <i>current</i> Tor Browser tab, including other open tabs or windows from the same website. <ref>https://trac.torproject.org/projects/tor/ticket/9442</ref> 

{{mbox
| image   = [[File:Ambox_warning_pn.svg.png|40px]]
| text       = '''Warning:''' This feature does not attempt to clear Tor browsing session data or unlink activity, unlike the "New Identity" feature. 
}}


If it is really necessary to separate contextual identities, it is always safer to close and then restart Tor Browser.

Potential use cases for this feature include: <ref>https://tails.boum.org/doc/anonymous_internet/Tor_Browser/index.en.html</ref>

* The Tor exit relay is located in a country which negatively affects the presentation of the website due to language localization.
* The site is censored due to the current Tor exit relay in use (caused by Tor IP address blacklisting).
* To bypass Google [https://en.wikipedia.org/wiki/CAPTCHA CAPTCHA] or [https://www.google.com/recaptcha/intro/index.html reCAPTHA] systems protecting sites from abuse if these are showing unsolvable captcha or no captcha at all.
* Connections to websites become unresponsive or slow.
* To change the Tor exit relay IP address without losing all open tabs.

To use it: <code>Left-click the Hamburger Icon</code> -> <code>Select "New Tor Circuit for this Site"</code>

Advanced users who want to learn more about this function should refer to the [[Tor_Browser/Advanced_Users#New_Tor_Circuit_Design|New Tor Circuit Design]] entry.

== Security Slider ==
Tor Browser includes a “Security Slider” that lets the user disable certain web features that can be used to compromise security and anonymity. Currently there are three levels: "Safest", "Safer" and "Standard". Users have to make a trade-off between security, usability and privacy. At the higher levels the slider will prevent some sites from working properly. <ref>https://tb-manual.torproject.org/en-US/security-slider.html</ref>

To use this feature: <code>Click Torbutton</code> -> <code>Click "Security Settings..."</code> -> <code>Select desired security level</code>

To learn more about the exact effect of each setting level, refer to the [[Tor_Browser/Advanced_Users#Security_Slider_Design|Security Slider design]] entry.

== Check for Tor Browser Update ==

Torbutton will notify if a Tor Browser update is available; see [[Tor_Browser#Tor_Browser_Internal_Updater|Tor Browser Internal Updater]] for further information and screenshots of this process. Note that [[#Update_Tor_Browser|multiple methods]] exist for updating Tor Browser.

To use the Torbutton menu option: <code>Click Torbutton</code> -> <code>Click "Check for Tor Browser <u>U</u>pdate..."</code>

== Disabled Torbutton Functions ==

Readers who are interested in why Torbutton's "Open Networking Settings" and "Tor Circuit View" features have been disabled in Whonix can learn more [[Tor_Browser/Advanced_Users#Disabled_Torbutton_Functions|here]].

= Tor Browser: How-To =
== Start Tor Browser ==
=== From the Menu ===
Start Tor Browser.

{{Box|text=
<u>If you are using [[Qubes-Whonix]]</u>.

<code>Qubes Start Menu</code> -> <code>Whonix-Workstation AppVM (commonly called {{Code2|anon-whonix}})</code> -> <code>Tor Browser</code>

<u>If you are using [[Non-Qubes-Whonix]]</u>.

<code>Start Menu</code> -> <code>Tor Browser</code>
}}

<div class="toccolours mw-collapsible mw-collapsed">
=== From the Command Line ===
To start Tor Browser from the command line, please press Expand on the right.
<div class="mw-collapsible-content">

{{Open a Whonix-Workstation Terminal}}

The user has two options. To start Tor Browser "normally" from the terminal. <ref><i>/usr/bin/torbrowser</i> simply navigates to the Tor Browser folder and runs <i>./start-tor-browser</i>. The former has more features like reporting error conditions or the absence of a Tor Browser folder, generation of non-zero exit code failures, and more.</ref>

{{CodeSelect|code=
torbrowser
}}
</div>

{{Anchor|From the Command Line or Debugging Mode}}
=== Debugging Mode ===
To start Tor Browser from the command line in debugging mode, please press Expand on the right.
<div class="mw-collapsible-content">
To generate debugging output if problems are experienced with Tor Browser (also see [[Tor_Browser/Advanced_Users#Debugging|Debugging]]).

{{Open a Whonix-Workstation Terminal}}

{{Box|text=
<u>Option A</u>:

Navigate to the Tor Browser folder.

{{CodeSelect|code=
cd ~/.tb/tor-browser/Browser
}}

Start Tor Browser in debugging mode.

{{CodeSelect|code=
./start-tor-browser --debug
}}
}}

{{Box|text=
<u>Option B</u>:
{{CodeSelect|code=
~/.tb/tor-browser/Browser/start-tor-browser --debug
}}
}}
</div>

=== Successful Tor Browser Connection ===

If Tor Browser successfully launches and connects to the Tor network, [https://check.torproject.org/ Check Torproject] should show the following message.

'''Figure:''' ''Successful Tor Browser Connection''

[[File:tbb2.png|600px]]

== File Downloads ==
=== Warnings ===

{{Download_Warnings}}

=== Secure Downloads ===

==== Preventing SSLStrip Attacks ====

{{mbox
| type      = notice
| image   = [[File:Ambox_notice.png|40px|alt=Info]]
| text       = If clicking or pasting a download link, make sure it is <code>http'''s'''://</code>. The <code>s</code> in <code>http'''s'''://</code> stands for "secure".
}}


Users often mistakenly believe that a secure, green padlock and a <code>http'''s'''://</code> URL makes any download from that particular website secure. This is not the case because the website might be redirecting to <code>http</code>. In fact, an [https://security.stackexchange.com/questions/41988/how-does-sslstrip-work SSLstrip attack] might succeed if a link is pasted or typed into the address bar without the <code>https://</code> component (e.g. <code>torproject.org</code> instead of <code>https://torproject.org</code>). <ref>And that website does not:

* Use [https://en.wikipedia.org/wiki/HTTP_Strict_Transport_Security HTTP Strict Transport Security (HSTS)]. See also: https://security.stackexchange.com/questions/91092/how-does-bypassing-hsts-with-sslstrip-work-exactly. Without HSTS, sites with non-encrypted resources or sub-domains are vulnerable to SSLstrip.
* Have a [https://www.eff.org/https-everywhere HTTPS Everywhere] rule in effect.
* Use [https://blog.mozilla.org/security/2012/11/01/preloading-hsts/ HSTS preloading].
* Use [https://en.wikipedia.org/wiki/HTTP_Public_Key_Pinning HTTP Public Key Pinning]. See also: https://news.netcraft.com/archives/2016/03/22/secure-websites-shun-http-public-key-pinning.html. HPKP limits trust to a handful of Certificate Authorities, but is not used by many websites due to the risk of site breakage if keys are not managed vigilantly.
</ref>

In this instance, it is impossible to confirm if the file is being downloaded over <code>https://</code>. Potentially, a SSLstrip attack might have made the download take place over plain <code>http</code>. The reason is a padlock is not visible; it just appears empty.

To avoid this risk and similar threats, <u>always explicitly type or paste <code>https://</code> in the URL / address bar</u>. The SSL certificate button or padlock will not appear in this instance, but that is nothing to be concerned about. Unfortunately, few users follow this sage advice; instead most mistakenly believe pasting or typing www.torproject.org into the address bar is safe.

==== Other Precautions ====

For even greater safety, download files from onion services (<i>.onion</i> addresses) whenever possible. Improved security is provided by [[Tor_Browser#Onion_Services_Encryption|onion service]] downloads, since: the connection is encrypted end-to-end (with PFS), targeting of individuals is difficult, and adversaries cannot easily determine where the user is connecting to or from.

Also, if files are already available in repositories, then prefer mechanisms which simplify and automate software upgrades and installations (like apt-get functions), rather than download Internet resources. Avoid installing unsigned software and be sure to always [[Verifying_Software_Signatures|verify key fingerprints and digital signatures of signed software]] from the Internet, <i>before</i> importing keys or completing installations.

Finally, consider using [[Multiple_Whonix-Workstations|multiple Whonix-Workstations]] when downloading and installing additional software, to better compartmentalize user activities and minimize the threat of misbehaving applications.

=== Navigating Tor Browser Downloads ===
{{Tor_Browser_Downloads}}

== Browser Language ==
In late-2018, the stable and experimental Tor Browser binaries with additional language packs support 25 languages. Recent additions include: Catalan, Irish, Indonesian, Icelandic, Norwegian, Danish, Hebrew, Swedish and Traditional Chinese. <ref>https://blog.torproject.org/new-release-tor-browser-80</ref> <ref>https://www.torproject.org/projects/torbrowser.html.en</ref> For instructions on changing the Tor Browser interface to a language other than English, see [[Language#Tor_Browser|Tor Browser Language]]. <ref>Language packs might be another fingerprinting vector, but this issue requires further investigation.</ref>

== Local Connections ==
Sometimes it is necessary to access the local application interface on <code>127.0.0.1</code> in order to run specific applications like I2P. <ref>Since it uses predetermined ports on the localhost.</ref> Due to potential fingerprinting and information leakage risks, this behavior is no longer possible in Tor Browser unless an exception is configured. <ref>https://trac.torproject.org/projects/tor/ticket/10419</ref> <ref>https://trac.torproject.org/projects/tor/ticket/11493</ref>

To configure an exception for local connections in Tor Browser: <ref>Alternatively the user can [[Tor_Browser/Advanced_Users#Remove_Proxy_Settings|remove Tor Browser's proxy settings]], but this method is still vulnerable to the same fingerprinting issues as configuring an exception. There are also other factors which will worsen the user's fingerprint, such as the breaking of both stream isolation and the tab isolation by socks user name in Tor Browser.</ref>

<code>Preferences</code> -> <code>General Tab</code> -> <code>Network Proxy | Settings...</code> -> <code>No Proxy for: "127.0.0.1"</code> -> <code>click "OK"</code>

The configured exception means a small trade-off in privacy, but it is much safer than using another browser (see [[Tor_Browser/Advanced_Users#Local_Connections_Exception_Threat_Analysis|Local Connections Exception Threat Analysis]]).

{{mbox
| type      = notice
| image   = [[File:Ambox_notice.png|40px|alt=Info]]
| text       = Web HTTP(S)/SOCKS proxies have different instructions and will not work with these steps, see [[Tor_Browser/Advanced_Users#Change_Proxy_Settings|Tor Browser Proxy Configuration]]. 
}}

=== Recommendations ===

For better anonymity:

* Browse with JavaScript disabled in Tor Browser and enable it only when needed. Disabled JavaScript mitigates these browser fingerprinting issues completely.
* Set passwords for web interfaces listening on the localhost.
* Run sensitive daemons with local WebGUIs on a separate, dedicated Whonix-Workstation and virtual network instance. TODO: expand or link how to do that

== Bypass Tor Censorship ==

{{mbox
| type      = notice
| image   = [[File:Ambox_notice.png|40px|alt=Info]]
| text       = This section outlines how to bypass Tor blocks by destination websites. Users who are blocked from connecting to the Tor network at the ISP level instead require [[Bridges|bridges]] or other circumvention tools.
}}


A number of websites or services [https://trac.torproject.org/projects/tor/wiki/org/doc/ListOfServicesBlockingTor actively block Tor users] via:

* A DNS query-based list used to tag IP addresses.
* Blocking software like [http://akamai.com/ Akamai] and [https://www.cloudflare.com/ Cloudflare].
* Other individual blocks.

There are various ad-hoc methods available to try and circumvent blocks. In most cases it is unnecessary to create a tunnel which pairs Whonix with other protocols (such as a VPN) in order to access the content.

The following services fetch content via other websites, which is a privacy trade-off. Further, only some services are effective with embedded, non-static content or support specific file types like PDF, .exe and mp3. <ref>https://trac.torproject.org/projects/tor/wiki/org/doc/ListOfServicesBlockingTor#Ad-hocSolutionsforaccessingblockedcontentonTor</ref>

'''Table:''' ''Tor Censorship Circumvention Options'' <ref>Source:
[https://trac.torproject.org/projects/tor/wiki/org/doc/ListOfServicesBlockingTor#Ad-hocSolutionsforaccessingblockedcontentonTor Ad-hoc Solutions for accessing blocked content on Tor] <br />
License: <br />
Content on this site is Copyright The Tor Project, Inc.. Reproduction of content is permitted under a [https://creativecommons.org/licenses/by/3.0/us/ Creative Commons Attribution 3.0 United States License]. All use under such license must be accompanied by a clear and prominent attribution that identifies The Tor Project, Inc. as the owner and originator of such content. The Tor Project Inc. reserves the right to change licenses and permissions at any time in its sole discretion.</ref>

{| class="wikitable"
|-
! scope="col"| Service
! scope="col"| URL
! scope="col"| Comment
! scope="col"| Non-static Embedded Content
! scope="col"| PDF, .exe, mp3
|-
! scope="row"| The Internet Archive's WaybackMachine
| web.archive.org/save/_embed/<URL>
| Archive.org respects robots.txt restrictions, works best with JS enabled
| No
| Yes
|-
! scope="row"| Archive.fo
| archive.fo/?run=1&url=<URL> And their official onion service: archivecaslytosk.onion/?run=1&url=<URL>
| Ideal for news sites, doesn't require JS
| No
| No
|-
! scope="row" | Google Cache 
| webcache.googleusercontent.com/search?q=cache:<URL without "http://">
| Google sometimes blocks these requests
| No - static only
| No
|-
! scope="row" | Startpage.com 
|  (1) Find the URL by searching, (2) Click on the proxy option 
| Not always efficacious
| No
| No
|-
! scope="row" | Searx.me
| (1) Find the URL by searching, (2) Click on the proxied option 
| Not always efficacious
| No
| No
|-
! scope="row" | Hypothes.is
| via.hypothes.is/<URL>
| Behind Cloudflare
| Yes
| Yes
|-
! scope="row" | Online Proxies
| hide.me/en/proxy, www.proxysite.com/, www.proxysite.club/ <ref>See also: hidester.com/proxy and youtubeunblocks.com/</ref>
| -
| Yes
| Yes
|-
|}

The Tor Project also recommends: <ref>https://trac.torproject.org/projects/tor/wiki/org/doc/ListOfServicesBlockingTor#Otherrelevantservices</ref>

<blockquote>To avoid captchas that are sometimes required when visiting YouTube, use hooktube.com/ (behind Cloudflare).<br /> <br />
imgur.com blocks Tor uploads, to upload images on an imgur domain go to a stackexchange website (for example tor.stackexchange.com), click on Ask a Question, use the image upload tooltip to upload the image, the resulting url will have a i.stack.imgur.com/... form.</blockquote>

== Harden Tor Browser ==

Anonymity and safety can be materially improved via: AppArmor, Tor Browser settings, sandboxing, multiple Tor Browser instances, and operation of Whonix-Workstation DisposableVMs ([[Qubes-Whonix]]) or multiple Whonix-Workstations.

Tor Browser provides reasonable security in its stock configuration. However, mitigating the risk of Tor Browser security breaches makes sense, because it is an untrusted application with a huge attack surface; it is frequently  attacked successfully in the wild by adversaries.

=== Tor Browser Series and Settings ===

* '''Settings:''' Follow relevant [[System_Hardening_Checklist#Tor_Browser_Series_and_Settings|System Hardening Checklist recommendations]], such as routinely using onion services for search queries and browsing (where possible), running the Security Slider in the highest position and disabling Javascript by default.
* '''Series:''' For greater security, consider using the [https://blog.torproject.org/blog/tor-browser-70a3-released alpha Tor Browser] release. This incorporates [https://www.ics.uci.edu/~perl/pets16_selfrando.pdf Selfrando] load-time memory randomization protection and other security features. Both the stable and alpha Tor Browser series now benefit from Mozilla's content level sandboxing, as well as being multi-process (e10s) compatible.

=== Multiple Tor Browser Instances and Whonix-Workstations ===

* '''Multiple Tor Browser Instances:''' To better separate different contextual identities, consider starting [[Whonix-Workstation_Security_Hardening#Multiple_Tor_Browser_Instances|multiple Tor Browser instances]] and running them through different SocksPorts. This method is less secure than the method outlined below.
* '''Multiple Whonix-Workstations:''' For tasks requiring different identities and/or additional software, it is recommended to compartmentalize activities and use [[Multiple_Whonix-Workstations|two or more Whonix-Workstation VMs]]. In this way, an exploit in Tor Browser in one Whonix-Workstation cannot simultaneously read the user's identity in another VM (for example, an IRC account). <ref>This does not protect against the sudden loss of networking, which could reveal to the attacker that two activities / accounts suddenly going off-line are probably related.</ref> This method is less secure than using a Whonix-Workstation DisposableVM with Tor Browser (see below).

=== Sandboxing and DisposableVMs ===

* '''Sandboxing:''' The Tor Project's official sandboxed Tor Browser is compatible with Whonix 14 and later releases, however it is no longer recommended since The Tor Project has officially abandoned its development. <ref>https://trac.torproject.org/projects/tor/ticket/25540</ref> [[Whonix-Workstation_Security#Firejail|Firejail]] can be used as an alternative sandboxing measure to restrict the Tor Browser process.
* '''Whonix-Workstation DisposableVMs:''' One of the safest configurations is to assume future compromise and run all instances of Tor Browser in an uncustomized Whonix-Workstation [[Qubes/Disposable_VM|DisposableVM]] in [[Qubes-Whonix]]. This configuration creates fresh Whonix-Workstation and Tor Browser instances for discrete Internet activities, while ensuring that previous, potentially compromised versions of both are destroyed. <ref>This does not protect against potential infection of dom0 or the Whonix-Workstation DisposableVM-Template by advanced adversaries. Traces of user activity may also be left on storage media or in RAM.</ref>

=== AppArmor Confinement ===

[[Whonix-Gateway_Security#AppArmor|AppArmor]] can help protect the user's system and data. It confines programs according to a set of rules that specify what files a given program can access, and with what privileges. This also provides some protection against zero-day attacks and exploits via unknown application flaws.

To mitigate the threat of specific attacks against Tor Browser, Whonix's Tor Browser [[AppArmor]] profile can be easily applied.

{{mbox
| type      = notice
| image   = [[File:Ambox_notice.png|40px|alt=Info]]
| text       = If AppArmor is applied, Tor Browser can only read and write to a limited number of folders. Permission denied errors are quite common, for example when trying to download files directly to the {{Code2|home}} folder.
}}


The workaround for denied errors is saving files from Tor Browser to the {{Code2|~/Downloads}} folder that is located within the {{Code2|home}} folder. In order to upload files with Tor Browser, first copy them to that folder.

{{Update}}

{{CodeSelect|code=
sudo apt-get update
}}

Install the {{Code2|apparmor-profile-torbrowser}} package.

{{CodeSelect|code=
sudo apt-get install apparmor-profile-torbrowser
}}

= Update Tor Browser =
== Introduction ==
Unfortunately, updating Tor Browser is more complex than regular system updates due to technical limitations outside of Whonix's control. <ref>
[[Tor_Browser/Advanced_Users#Technical_Background_of_Tor_Browser_Update_Process_Cumbersomeness]]
</ref> However, by applying the following instructions it is possible to keep Tor Browser up to date at all times.

There are three options for updating Tor Browser in Whonix:

* The Whonix [[#Tor_Browser_Downloader_by_Whonix|Tor Browser Downloader]]. <ref>This does [https://phabricator.whonix.org/T400 not yet notice upgrades] done by Tor Browser's Internal Updater.</ref>
* Tor Browser's [[#Tor_Browser_Internal_Updater|Internal Updater]]. <ref>Since v5.0, Tor Browser is configured to [https://blog.torproject.org/blog/tor-browser-50-released update itself].</ref>
* Tor Browser [[#Tor_Browser_Manual_Update|manual updates]].

The first two methods are suitable in most situations. Manual updates are only required if the Whonix Tor Browser update script ever breaks. Never continue to use an outdated version of Tor Browser, otherwise serious security flaws may degrade anonymity or result in a VM compromise. <ref>https://tb-manual.torproject.org/en-US/updating.html</ref>

{{mbox
| type      = notice
| image   = [[File:Ambox_notice.png|40px|alt=Info]]
| text       = It is recommended to follow [https://blog.torproject.org The Tor Project blog] to stay informed about recent updates.
}}

{{Anchor|Tor Browser Updater (Whonix)}}

== Tor Browser Downloader by Whonix ==
=== Installation Process ===
'''Note:''' {{Code2|Tor Browser Downloader (Whonix)}} is really just a downloader, not a updater. This means it is incapable of retaining user data, for example bookmarks and passwords. In order to keep user data, use the [[#Tor_Browser_Internal_Updater|Internal Updater]] method instead.

To use {{Code2|Tor Browser Downloader (Whonix)}}, follow these instructions in Whonix-Workstation:

{{Box|text=
<u>If you are using [[Qubes|Qubes-Whonix]]</u>, to ensure that <u>new</u> AppVMs and [[Qubes/DisposableVM|DispVMs]] are created with a copy of the latest Tor Browser version, complete the following steps:

<code>Qubes App Launcher (blue/grey "Q")</code> -> <code>Whonix-Workstation TemplateVM</code> (<code>{{whonix-ws}}</code>) -> <code>Tor Browser Downloader (Whonix)</code>

<u>If you are using [[Qubes|Qubes-Whonix]]</u>, to re-install the latest Tor Browser version in <u>existing</u> Whonix-Workstation AppVMs, complete the following steps:

<code>Qubes App Launcher (blue/grey "Q")</code> -> <code>Whonix-Workstation AppVM</code> (<code>anon-whonix</code>) -> <code>Tor Browser Downloader (Whonix)</code>

<u>If you are using a graphical Whonix-Workstation</u>, complete the following steps:

<code>Start Menu</code> -> <code>Applications</code> -> <code>System</code> -> <code>Tor Browser Downloader (Whonix)</code>

<u>If you are using a terminal</u>, complete the following steps:
{{CodeSelect|code=
update-torbrowser
}}
}}

There are several steps in this process. First, the downloader will show it is checking for updates.

'''Figure:''' ''Checking for Updates''

[[File:Tor Browser Downloader(Whonix) checking for updates.png|400px|Tor Browser Downloader (Whonix) checking for updates.]]

Next, the downloader will prompt for the preferred Tor Browser version and confirm installation. Take heed of the warning in the confirmation box stating <u>the existing Tor Browser user profile (including bookmarks and passwords) will be lost during this process.</u>

'''Figure:''' ''Download Confirmation''

[[File:torbrowserdownloader.png|Tor Browser Downloader (Whonix) Download Confirmation]]

After agreeing to the download process, a progress indicator will be displayed by the downloader. This process can be lengthy depending on the speed of the Tor network connection.

'''Figure:''' ''Downloading Tor Browser''

[[File:Tor Browser Downloader(Whonix) downloading.png|400px|Tor Browser Downloader (Whonix) Downloading Tor Browser.]]

Once the download has finished, the downloader will provide verification (or not) of the cryptographic signature associated with the Tor Browser binary, highlighting the key used to sign it and the date. The downloader will then ask for confirmation to install the package: see [[#Installation_Confirmation_Notification|Installation Confirmation Notification]] for steps on identifying a possible targeted attack.

'''Figure:''' ''Tor Browser Installation Confirmation''

[[File:torbrowserdownloader2.png|Tor Browser Downloader (Whonix) Installation Confirmation.]]

If the installation process is confirmed, the downloader will extract Tor Browser.

'''Figure:''' ''Extracting Tor Browser''

[[File:Tor Browser Downloader(Whonix) Extracting.png|400px|Tor Browser Downloader (Whonix) Extracting.]]

In the final step, the downloader will prompt whether the upgraded Tor Browser should be launched.

'''Figure:''' ''Finalized Tor Browser Installation''

[[File:Tor Browser Downloader(Whonix)FInished2.png|600px|Tor Browser Downloader (Whonix) Finished Installing Tor Browser.]]

<font size=-3>(Also available as [https://www.whonix.org/w/images/f/f2/Tor_Browser_Update_Check_005.png CLI version].)</font>

=== Download Confirmation Notification ===
{{mbox
| type      = notice
| image   = [[File:Ambox_notice.png|40px|alt=Info]]
| text       = This step is designed to keep Whonix users safe.
}}


At present there is no reliable and secure way for a program to determine the latest stable version of Tor Browser with reasonable certainty. <ref>[https://trac.torproject.org/projects/tor/ticket/14383 Finalize RecommendedTBBVersions format]</ref> <ref>[https://trac.torproject.org/projects/tor/ticket/13065 Counter downgrade / stale mirror attacks on RecommendedTBBVersions - sign / verify tbb versions file]</ref> When the version format changes, the automated parser of version information could falsely suggest: 

* An earlier stable version that is still considered secure. 
* An alpha series release.
* A beta Tor Browser build.
* A release candidate or nightly Tor Browser build.

Alternatively, one might be targeted by a denial of service, indefinite freeze or rollback (downgrade) attack. <ref>For a definition of these attacks, see the [https://github.com/theupdateframework/tuf/blob/develop/SECURITY.md threat model] of [http://theupdateframework.com TUF] ([https://github.com/theupdateframework/tuf The Update Framework]) ([http://www.webcitation.org/6F7Io2ncN w]).</ref>
<ref>Adversaries capable of breaking [[SSL]] could mount these attacks by replacing [https://www.torproject.org/projects/torbrowser/RecommendedTBBVersions RecommendedTBBVersions] with invalid, frozen or outdated version information.</ref>

To counter these threats, user intelligence is utilized as a sanity check. The Download Confirmation Notification provides a way to detect such situations and abort the procedure. In this instance, it is recommended to rotate the Tor circuits and attempt the download process again.

Version numbers that are visible under {{Code2|Online versions}} come from an online resource. The Tor Browser [https://www.torproject.org/projects/torbrowser/RecommendedTBBVersions RecommendedTBBVersions] versions file is provided by The Tor Project, and is parsed by Whonix's Tor Browser Downloader. The Whonix downloader will indicate that no upgrade is required if the installed Tor Browser version matches the up-to-date online version.

TODO: expand.

=== Installation Confirmation Notification ===
{{mbox
| type      = notice
| image   = [[File:Ambox_notice.png|40px|alt=Info]]
| text       = This step is also designed to protect users. 
}}


Currently, there is no reliable and secure way for a program to determine (with reasonable certainty) if the Tor Browser download was targeted by an indefinite freeze or rollback attack. <ref>Unfortunately, Tor Browser signatures do not yet provide expiration dates in a manner similar to Debian's [http://blog.ganneff.de/blog/2008/09/23/valid-until-field-in-release-f.html valid-until] field.</ref> <ref>Rollback attacks are possible because the user's computer clock could be wrong, so there is no solid basis for comparison.</ref>

When verifying cryptographic signatures, several important aspects must be considered:

* The signature should be made by a trusted key.
* Trusted keys will have signed other files in the past. It is also necessary to check if the right file was received, and not just any file that was signed by a trusted key.
* Even if the correct file type is received, <ref>That is, a browser and not a messenger or other application.</ref> it is necessary to check it has a <i>current</i> signature attached and not a historical one. This step counters the threat of indefinite freeze and rollback attacks.

By the time the Installation Confirmation Notification is visible, the verification of the signature (and hash) will have already succeeded. However, the signature creation dates in the figure below must be carefully examined to confirm that an indefinite freeze or downgrade attack did not occur. 

'''Previous Signature Creation Date:''' When Tor Browser was previously installed by tb-updater, the creation date of the accompanying signature that signed Tor Browser will have been stored. The {{Code2|Previous Signature Creation Date}} field displays that date.<br />
'''Last Signature Creation Date:''' This field displays the date of signature creation for the downloaded file.

'''Figure:''' ''Tor Browser Installation Confirmation''

[[File:torbrowserdownloader2.png|torbrowser-updater_signature_verification_screen.]] <br />

<ref>[[OpenPGP#Common_Misconceptions|GnuPG (OpenPGP) common misconceptions]].</ref>
<ref>The name of the file is stored in the hash file and verified to match the downloaded file name and hash.</ref>

Note: Tor Browser local version number detection is [https://phabricator.whonix.org/T400 not currently implemented] in Whonix.

TODO: expand.

{{Anchor|Running_Tor_Browser_in_Qubes_TemplateVM}}
{{Anchor|Running_Tor_Browser_in_Qubes_DVM_Template}}

{{Anchor|DVM Template}}

=== In Qubes-Whonix ===
{{Qubes Tor Browser Update}}

== Tor Browser Internal Updater ==
Tor Browser upgrades are possible from within the browser. <ref>https://blog.torproject.org/blog/tor-browser-50-released
<blockquote>
Starting with this release, Tor Browser will now also download and apply upgrades in the background, to ensure that users upgrade quicker and with less interaction. This behavior is governed by the about:config pref app.update.auto, but we do not recommend disabling it unless you really know what you're doing.
</blockquote>
</ref> When a new Tor Browser version is available but the browser has not completed an automatic upgrade in the background (the default), a warning prompt appears recommending an upgrade via Torbutton:

<code>Left-click Torbutton</code> -> <code>Check for Tor Browser <u>U</u>pdate...</code>

'''Figure:''' ''Torbutton Update Warning''

 [[File:Tbbupgrade.png|600px]]

== Tor Browser Manual Update ==

{{mbox
| type      = notice
| image   = [[File:Ambox_notice.png|40px|alt=Info]]
| text       = If the Tor Browser update script is ever broken, it is advised to [[Manually_Downloading_Tor_Browser|update manually]].
}}


Modern Tor Browser releases are generally easy to install and update on well-supported platforms like Whonix, leading most users to have a comfortable and reliable experience over long periods. However, if/when Tor Browser "breaks", some might find it difficult to perform a manual installation. <ref>Before the introduction of [[Tor_Browser#Tor_Browser_Internal_Updater|Tor Browser's internal updater]], manual installation was a difficult task which required the renaming (or deletion) of the old Tor Browser folder before the new version was extracted. If users have little concept of how Tor Browser functions "under the hood", then this logically causes problems when they attempt a manual installation (particularly on the host).</ref>

=== Whonix Bugs ===

Sometimes [[Tor_Browser#Tor_Browser_Downloader_by_Whonix|Whonix Tor Browser Downloader]] inside Whonix-Workstation breaks because torproject.org changes the way Tor Browser can be downloaded or verified. This program is maintained by the [[Team|Whonix team]] and The Tor Project is not responsible for necessary fixes. Generally, [http://forums.whonix.org/c/news Whonix news] will be published within a few days with working instructions on how to fix the problem. If this does not happen, then Whonix developers are unaware of the issue. 

Any bugs should be discussed in the Whonix [https://forums.whonix.org User Help Forum] or [https://phabricator.whonix.org/search/query/9YB5CfmXxpAG/#R Bug Tracker]. To date, no bugs were ever discovered in Tor Browser that were directly related to Whonix code and which might cause serious problems such as website pages failing to load.

=== Prerequisite Knowledge ===

The [[Manually_Downloading_Tor_Browser|manual Tor Browser download]] procedure assumes basic knowledge of:

* '''Software Verification:''' Users are expected to know how to PGP-verify the Tor Browser package, using the associated file signature and Tor signing keys (relevant links are provided). <ref>Whonix is not a standalone package, but a complete operating system. Whonix has a small team, while torproject.org has a much larger community and dedicated, paid support staff. Therefore, Whonix users are expected to learn Tor Browser basics in the first instance.</ref>
* '''Troubleshooting:''' If Tor Browser problems occur in Whonix such as webpages failing to resolve, then:
** Users are expected to perform the same test on the host (Non-Qubes-Whonix) or in a non-Whonix VM (Qubes-Whonix); see [[Install_Tor_Browser_Outside_of_Whonix|Non-Whonix Tor Browser]]. This step helps to determine whether the problem is related to Whonix or not. 
** It is also sensible to search for the problem on [https://trac.torproject.org/ torproject.org's bug tracker] and report a bug upstream if it has not been notified yet. In that case, when upstream (TPO) fixes the issue, the issue will most likely also get fixed in Whonix.

= Unsafe Tor Browser Habits =
It is important to develop a set of safe habits when communicating, browsing or downloading with Tor Browser. Even the world's premier anonymity software cannot protect users if they shoot themselves in the foot.

The following is an inexhaustive list of unsafe behaviors. It is recommended to also read the Whonix [[DoNot|Tips on Remaining Anonymous]] entry, along with [https://www.torproject.org/docs/documentation.html.en Tor Project documentation] before using Tor Browser for serious activities necessitating anonymity.

'''Table:''' ''Unsafe Tor Browser Habits''

{| class="wikitable"
|-
! scope="col"| '''Category'''
! scope="col"| '''Unsafe Configuration or Behavior'''
|-
! scope="row"| Add-ons
| Add [[#Non-default_Add-ons|non-default add-ons]] to Tor Browser. <br /> Configure [[#NoScript_Custom_Setting_Persistence|persistent, customized NoScript settings]].
|-
! scope="row"| Anonymity Modes
| Mix [[DoNot#Mix_Anonymity_Modes|modes of anonymity]]. <br /> Fail to [[#Multiple_Tor_Browser_Instances_and_Whonix-Workstations|compartmentalize]] [[#Sandboxing_and_DisposableVMs|Tor Browser activities]].
|-
! scope="row"| Bridges
| Expect that [[Bridges|Tor relay bridges]] will absolutely disguise all use of Tor / Tor Browser.
|-
! scope="row"| Browser Settings
| [https://trac.torproject.org/projects/tor/ticket/7255 Maximize or change] <ref>http://forums.whonix.org/t/should-still-recommend-against-maximizing-tor-browser-window</ref> the default window size setting. <br /> [[DoNot#Change_Settings_if_the_Consequences_are_Unknown|Change other browser settings]] if the implications are unknown.
|-
! scope="row"| Communications
| Send "anonymous" communications or other data over [https://www.torproject.org/docs/faq.html.en#CanExitNodesEavesdrop unencrypted channels using plain HTTP]. 
|-
! scope="row"| File Downloads
| [[#Warnings|Torrent]] over Tor. <br /> [[#Warnings|Open documents]] or other files downloaded by Tor while online. <br /> Open [[DoNot#Open_Random_Files_or_Links|random files or links]]. <br /> [[Tor_Browser#Preventing_SSLStrip_Attacks|Paste or type download links into the address bar]] without <code>https://</code> <br /> Download and install unsigned software from the Internet. <br /> Download and install signed software or import keys without first [[Verifying_Software_Signatures|verifying key fingerprints and digital signatures]].
|-
! scope="row"| HTML5 Canvas Image Data
| Allow [[Data_Collection_Techniques#HTML5_Canvas_Image_Data|extraction of canvas image data]] by websites.
|-
! scope="row"| Identities
| Disclose [[DoNot#Disclose_Identifying_Data_Online|identifying data]]. <br /> Maintain [[DoNot#Maintain_Long-term_Identities|long term identities]]. <br /> Use [[DoNot#Use_Different_Online_Identities_at_the_Same_Time|different online identities]] at the same time.
|-
! scope="row"| JavaScript
| [[#Security_vs_Usability_Trade-off|Enable JavaScript]] for websites of a dubious nature.
|-
! scope="row"| Logins
| Login to Google, Facebook or other corporate accounts with a [[DoNot#Login_to_Social_Networks_Accounts_and_Think_you_are_Anonymous|real name or pseudonym]]. <ref>https://www.torproject.org/docs/faq.html.en#AmITotallyAnonymous</ref> <br /> Login to accounts that have ever been [[DoNot#Login_to_Accounts_Used_without_Tor|used without Tor]]. <br /> Generally login to banking, financial, personal or [[DoNot#Login_to_Banking_or_Online_Payment_Accounts|other important accounts.]]
|-
! scope="row"| Local Connections
| [[#Local_Connections|Configure a local connection exception]] for applications, unless aware of the risks.
|-
! scope="row"| Networking
| Configure Tor Browser so that it leads to a [[DoNot#Allow_Tor_over_Tor_Scenarios|Tor over Tor scenario]].
|-
! scope="row"| Other Browsers
| Use [[#Anonymity_vs_Pseudonymity|browsers other than Tor Browser]] with Tor. <br /> Use [[DoNot#Use_Clearnet_and_Tor_at_the_Same_Time|a clearnet browser and Tor Browser]] at the same time.
|-
! scope="row"| Personal Websites and Links
| Visit [[DoNot#Visit_your_Own_Website_when_Anonymous|personal websites]] over Tor. <br /> Be the first person to [[DoNot#Spread_your_Own_Link_First|spread a personal link]].
|-
! scope="row"| Phone Verification
| Use [[DoNot#Use_.28Mobile.29_Phone_Verification|(mobile) phone verification]].
|-
! scope="row"| Proxy Settings
| [[Tor_Browser/Advanced_Users#Proxy_Settings|Change or remove default proxy settings]] if unaware of the implications.
|-
! scope="row"| Qubes-Whonix
| Launch Tor Browser in a [[Tor_Browser/Advanced_Users#Running_Tor_Browser_in_Qubes_TemplateVM| TemplateVM (<code>{{whonix-ws}}</code>) or DVM-TemplateVM (<code>{{whonix-ws}}-dvm</code>)]]. <br /> Launch [[Tor_Browser#DVM_Template|Tor Browser Downloader]] in a DVM-TemplateVM (<code>{{whonix-ws}}-dvm</code>).
|-
! scope="row"| Server Connections
| Connect to a [[DoNot#Do_not_Connect_to_a_Server_Anonymously_and_Non-anonymously_at_the_Same_Time|server anonymously and non-anonymously]] at the same time.
|-
! scope="row"| Torbutton
| Use the Torbutton [[Tor_Browser/Advanced_Users#New_Identity_Design|"New Identity"]] and [[Tor_Browser/Advanced_Users#New_Tor_Circuit_Design|"New Tor Circuit for this Site"]] functions and expect complete anonymity in the following browsing session.
|-
! scope="row"| Updates
| Ignore [[#Download_Confirmation_Notification|download]] and/or [[#Installation_Confirmation_Notification |installation]] confirmation notifications or warnings when updating Tor Browser. <br /> Use an [[#Update_Tor_Browser|outdated version]] of Tor Browser.
|-
! scope="row" | User Mentality
| Feel invincible running Tor Browser (irrespective of the platform), due to [[Tor_Browser/Advanced_Users#Tor_Browser_Adversary_Model|significant adversary capabilities]] and interest in unmasking or infecting Tor users.
|}

= Whonix Tor Browser Differences =
The regular Tor Browser Bundle and Whonix Tor Browser slightly differ. The reason is Tor Browser must be adjusted by Whonix to work behind Whonix-Gateway. Despite environmental variable adjustments, the network and browser fingerprint remain the same.

The main Whonix Tor Browser differences can be summarized as follows:

* [[Tor_Browser/Advanced_Users#tor-launcher|tor-launcher]] (Tor connection wizard) will not be shown in Whonix-Workstation Tor Browser. Instead, there is [[Anon Connection Wizard]] on Whonix-Gateway.
* The Tor Circuit View and Open Network Settings functions have been [[Tor_Browser/Advanced_Users#Disabled_Torbutton_Functions|disabled]] in Torbutton. The former is [[unsupported]] for security reasons, <ref>This is so Whonix-Workstation does not have access to the information about which Tor middle relay or Tor entry guard [or bridge] are being used. See also: [[Dev/Control_Port_Filter_Proxy#Indicator_for_current_Circuit_Status_and_Exit_IP]]</ref> while the latter would have no effect since Tor must be configured in the Whonix-Gateway.
* The default landing page upon Tor Browser start is set to use a local Whonix resource. <ref>The default Tor Browser Bundle uses <i>about:tor</i> as the landing page. See: https://trac.torproject.org/projects/tor/ticket/13835</ref>

Whonix does <i>not</i>:

* Change Tor Browser's [[#Tor_Browser_Internal_Updater|Internal Updater checking mechanism]].
* Affect the safe operation of Tor. There is no [[DoNot#Allow_Tor_over_Tor_Scenarios|Tor over Tor scenario]] in the Whonix environment.
* Modify Tor Browser's startup script, default settings and so on. <ref>In Whonix-Workstation, rinetd listens on {{Code2|127.0.0.1}} {{Code2|9150}} and {{Code2|9151}} (Tor Browser's default ports) and forwards them to Whonix-Gateway {{Code2|10.152.152.10 9150}} (where a Tor SocksPort is listening) and {{Code2|9151}} (where [[Dev/CPFP|Control Port Filter Proxy]] is listening). Tor does not get started by the {{Code2|[https://gitweb.torproject.org/tor-launcher.git tor-launcher]}} Firefox add-on because the {{Code2|[https://trac.torproject.org/projects/tor/ticket/6009 TOR_SKIP_LAUNCH]}} environment variable has been set set to {{Code2|1}}. See also [[Dev/anon-ws-disable-stacked-tor]].</ref>
* [[Tor_Browser/Advanced_Users#Proxy_Settings|Change or remove proxy settings]] by default.

== Tor Browser Functionality on Different Platforms ==
{{mbox
| type      = notice
| image   = [[File:Ambox_notice.png|40px|alt=Info]]
| text       = It is not [http://forums.whonix.org/t/just-curious-why-no-warning-to-not-maximize-your-window-whilst-using-whonix-browsers/3932/9 valid to make a comparison] between the Windows version of TBB and the Whonix Tor Browser concerning functionality, for instance why the warning message does not appear in Whonix when maximizing the browser window. <ref>No changes have been made to Whonix code to prevent such a warning.</ref>
}}


The reason is this comparison includes a host of platform-specific differences which confound the result. For example, a more valid comparison would be the differences between:

* TBB on Debian (real Debian, not in Qubes) vs Tor Browser on [[Non-Qubes-Whonix]].
* TBB in a Qubes AppVM based on a Debian TemplateVM vs Tor Browser on Qubes-Whonix.

Similarly, if a user wanted to help with TBB (non-Whonix) development, then these comparisons would be useful:

* TBB on Debian (real Debian, not in Qubes) vs TBB on Windows.
* TBB on different Linux distributions.
* TBB on different Windows platforms.

= Glossary and Key Terminology =
== Glossary ==
It is recommended to familiarize yourself with terms regularly used by The Tor Project and Whonix. One useful resource is the [https://trac.torproject.org/projects/tor/wiki/doc/community/glossary v1.0 Tor glossary] which is now available on The Tor Project community wiki page.

== Key Terminology ==
=== Tor vs Tor Browser ===

[[Tor]] is an anonymizer developed by The Tor Project. Tor Browser is a web browser developed by the Tor Project which is optimized for privacy. Please do not confuse {{Code2|Tor}} with {{Code2|Tor Browser}} when conversing about Whonix topics.

=== Tor Browser Transparent Proxying ===

The Tor Browser "transparent proxying" feature <ref>https://trac.torproject.org/projects/tor/wiki/doc/TransparentProxy</ref> and/or the environment variable <code>TOR_TRANSPROXY=1</code> often cause confusion. It was an unfortunate naming decision by The Tor Project. This feature actually <u>[[Tor_Browser/Advanced_Users#Remove_Proxy_Settings|removes proxy settings]]</u>. With no proxy set, the user's system reverts to its default configuration. The effect of this decision is that Tor Browser will work identically to an unconfigured Firefox browser. 

This is potentially dangerous when done outside of Whonix because Tor Browser's transparent proxying feature could result in clearnet traffic; for instance if the gateway does not have a transparent torification feature (like Whonix-Gateway). In the case of Whonix, even if the transparent proxying feature is set, Whonix-Gateway will "torify" traffic and force it through Tor. Similarly, if transparent proxying is set and happens to use a JonDo-Gateway, traffic will be forced through JonDo.

One downside of the transparent proxying feature is that even when it is used inside Whonix, it breaks Tor Browser's [https://trac.torproject.org/projects/tor/ticket/3455 top level isolation for each separate tab].

Transparent proxying should not be confused with:

* Tor's <code>TransPort [address:]port|auto [isolation flags]</code> [https://www.torproject.org/docs/tor-manual.html.en setting].
* Tor's [https://trac.torproject.org/projects/tor/wiki/doc/TorifyHOWTO/IsolatingProxy IsolatingProxy].

TODO: expand.

{{Anchor|tb-updater postinst}}

= Advanced Users =
Refer to [[Tor_Browser/Advanced_Users|this wiki entry]] if any of the following advanced topics are of interest:

* Tor Browser and Torbutton design.
* Tor Browser without Tor.
* Setting a custom homepage.
* A custom Whonix configuration or Workstation is in use.
* Changes to proxy settings are required.
* The difference between tor-launcher and tor-browser launcher.
* Qubes-Whonix topics:
** Split Tor Browser.
** Tor Browser in a DisposableVM.
** Tor Browser in a Qubes DVM Template.
* Tor Browser debugging is required.

= Footnotes / References =
{{reflist|close=1}}

= License =
<pre>Whonix Tor Browser wiki page Copyright (C) Amnesia <amnesia at boum dot org>
Whonix Tor Browser wiki page Copyright (C) 2012 - 2018 ENCRYPTED SUPPORT LP <adrelanos@riseup.net>

This program comes with ABSOLUTELY NO WARRANTY; for details see the wiki source code.
This is free software, and you are welcome to redistribute it
under certain conditions; see the wiki source code for details.</pre>

{{Footer}}

[[Category:Documentation]]
