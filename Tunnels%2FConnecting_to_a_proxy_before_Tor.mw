{{Header}}
{{Title|
title=Connecting to a proxy before Tor
}}
{{#seo:
|description=Instructions on how to connect to a proxy before Tor (User -> proxy -> Tor -> Internet)
|image=https://www.whonix.org/w/images/2/2c/Lightning-199651640.jpg
}}
{{Tunnels_Introduction}}
'''User -> proxy -> Tor -> Internet'''
----
__FORCETOC__
__TOC__
----
=== Proxy Warning ===
{{mbox
| image   = [[File:Ambox_warning_pn.svg.png|40px|alt=Whonix first time users warning]]
| text       = '''<u>Warning!</u>'''
There are issues you should be aware of when using standard, common http(s)/socks4(a)/5 proxies. (Anonymizers that only use http(s)/socks4(a)/5 as an interface<ref>Such as the Tor, [[JonDonym]] or [[I2P]] software.</ref> are exempt.)
* Most problems with these proxies are not caused by Whonix.
* ISP-level adversaries can still determine that the user is connecting to the Tor network.
* Be especially careful with http(s) proxies. Some of them send the "[https://trac.torproject.org/projects/tor/wiki/doc/TorPlusVPN#VPNSSHversusProxy http forwarded for]" header which discloses your IP. Http(s) proxies that do not send this header are sometimes called "elite" or "anonymous" proxies.
* When using "http forwarded for" http(s) proxies, Tor entry guards and Tor [[Bridges|bridges]] can determine your IP.
See also: [[Comparison_Of_Tor_with_CGI_Proxies,_Proxy_Chains,_and_VPN_Services|Comparison Of Tor with CGI Proxies, Proxy Chains, and VPN_Services]].
}}

----

=== Have Proxy Configuration Handy ===
Where is the proxy running?

* On proxy software (such as [[lantern]]) that creates a proxy tunnel on your local computer?
** [[Qubes-Whonix]]: There is are examples, [[lantern]] and [[JonDonym#Connecting_to_JonDonym_before_Tor|JonDonym]].
** [[Non-Qubes-Whonix]]: This is not yet fully documented for [[Non-Qubes-Whonix]]. Please [[contribute]]. You would have to run the proxy software under the linux user account <code>tunnel</code> on Whonix-Gateway.
*** [[Undocumented]]: how to autostart your custom software after reboot. (systemd etc.)
*** Undocumented: Custom proxy software setup example.
* Or on a remote computer? Great, the is easier to set up.

<br />
What is the IP and the port of the proxy?

* You know the proxy IP? Great!
* Or you want to run a custom proxy software on Whonix-Gateway? Then your proxy IP probably <code>127.0.0.1</code>.
<br />
Which type of proxy you are using?

* HTTPProxy?
* HTTPSProxy?
* Socks4Proxy?
* Socks5Proxy
* Proxy requires username?
* Proxy requires password?

----

=== Configure Whonix-Gateway ===
'''User -> proxy -> Tor -> Internet'''

Tor natively supports proxy settings and only requires editting the torrc file.

{{Open /etc/tor/torrc}}

Depending on your proxy configuration, add the settings you'll need to your {{Code2|/etc/tor/torrc}}. For more information on these settings, have a look in the [https://www.torproject.org/docs/tor-manual.html.en Tor manual] and read the [https://trac.torproject.org/projects/tor/wiki/doc/TorFAQ#MyInternetconnectionrequiresanHTTPorSOCKSproxy. FAQ].

<pre>
HTTPProxy host[:port]
HTTPProxyAuthenticator username:password
HTTPSProxy host[:port]
HTTPSProxyAuthenticator username:password

Socks4Proxy host[:port]

Socks5Proxy host[:port]
Socks5ProxyUsername username
Socks5ProxyPassword password

FascistFirewall 0|1 

ReachableAddresses ADDR[/MASK][:PORT]… 
ReachableDirAddresses ADDR[/MASK][:PORT]… 
ReachableORAddresses ADDR[/MASK][:PORT]… 
</pre>

'''Note:''' You need to use the IP instead of the hostname (proxy.example.com). If you don't know the IP of your proxy, please run {{Code|nslookup proxy.example.com}} (replace proxy.example.com with the hostname of your actual proxy) in a terminal (Konsole) on your host operating system. Using IP instead of hostname might cause subtle fingerprinting issues, see <ref>https://github.com/Whonix/Whonix/issues/94</ref> for more information.

----

= Footnotes =
<references />

{{Footer}}

[[Category:Documentation]]
