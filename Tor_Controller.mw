{{Header}}
{{#seo:
|description=Using a Tor Controller with Whonix. Arm. Vidalia. Change your Tor circuit. Monitor Tor.
|image=https://www.whonix.org/w/images/5/54/Screenshot_arm_page1_cropped.png
}}
{{Title|
title=Controlling and Monitoring Tor
}}

{{Sd-start-short}}
= Tor Controller =
[[image:0brand_Arm_Controller-1.png|Arm Tor Controller|thumb]]

Users have two options: [[#Arm|Arm]] or [[#tor-ctrl|tor-ctrl]]. Both programs come {{Code2|pre-installed}} in Whonix, but [[#Arm|Arm]] is {{Code2|recommended}}.

Note: [[#Vidalia|Vidalia]] has been deprecated and is no longer packaged in Debian.

= Arm =
== Arm Usage ==
Arm is '''recommended'''. It is already pre-installed on Whonix-Gateway. <ref>Since [[#Vidalia]] is [[#Vidalia_recommended_against|recommended against]].</ref>

{{Start_Arm}}

To receive a new circuit, press:

<pre>
n
</pre>

To exit arm, press:

<pre>
q
q
</pre>

== Arm FAQ ==

{| class="wikitable" style="background-color: #fff;text-align: left"

! '''Message / Question'''
! '''Response'''

|-
| {{Code2|arm vs nyx?}}
| Previously called arm. New name will be nyx. <ref>http://tor.stackexchange.com/tags/nyx/info</ref>

|-
| <u>{{Code2|Should any of the following Arm messages concern me?}}</u>
| No, and below is explained why not. See also [[FAQ#Should_I_be_concerned_about..._.3F|FAQ entry, Should I be concerned about... ?]].

|-
| <u>{{Code2|Am I compromised? Does Arm report leaks?}}</u>
| Arm is conceptually not a tool to find out about serious issues such as compromise or leaks. <ref>

Arm works on a different level. It is a Tor Controller. It talks to Tor using Tor's ControlPort. It is an interface to show what Tor thinks. Neither Tor nor Arm implement anything such as virus detection, compromise detection, leak detection etc. Messages by Arm are interesting and useful but usually no reason for grave concern.

For leak testing, see [[Dev/Leak_Tests|leak tests]].
</ref>

|-
| {{Code2|Tor is preventing system utilities like netstat and lsof from working. This means that arm can't provide you with connection information. You can change this by adding 'DisableDebuggerAttachment 0' to your torrc and restarting tor. For more information see... https://trac.torproject.org/3313}}
| If you want to learn about the technical details, read https://trac.torproject.org/3313.

|-
| DisableDebuggerAttachment even when running as root.
| This is a [https://trac.torproject.org/projects/tor/ticket/7709 bug] in arm.

|-
| {{Code2|man page (GENERAL OPTIONS and COMMAND-LINE OPTIONS)}}
| This is a [https://trac.torproject.org/projects/tor/ticket/9679 bug] in arm.

|-
| {{Code2|[WARN] Socks version 71 not recognized. (Tor is not an http proxy.)}}
| 
This is caused by [[whonixcheck]] (by function {{Code2|check_tor_socks_port_reachability}}). It checks if a Tor SocksPort is reachable by trying to fetch it using curl. <ref>
{{CodeSelect|code=
{{Curl_Plain}} 10.152.152.10:9100
}}
</ref> It will not report anything if it worked, but would complain if it failed.


|-
| {{Code2|[WARN] Socks version 71 not recognized. (This port is not an HTTP proxy; did you want to use HTTPTunnelPort?)}}
| Similar to above.

|-
| {{Code2|[WARN] Rejecting request for anonymous connection to private address [scrubbed] on a TransPort or NATDPort.  Possible loop in your NAT rules?}}
| This happens for example if you run "curl 192.168.0.15", because when you type "curl", by default in Whonix, you are not directly using curl, but a uwt wrapped (stream isolated) [https://www.whonix.org/wiki/Stream_Isolation Stream Isolation] curl. It would not try to directly connect to 192.168.0.15, but to connect to 192.168.0.15 through Tor and this is what Tor is mentioning. It only means, that you attempted something, that will not work that way. Deactivate the curl stream isolation wrapper or use the non-wrapped version (see [https://www.whonix.org/wiki/Stream_Isolation Stream Isolation]).

|-
| {{Code2|[NOTICE] You configured a non-loopback address '10.152.152.10:9179' for SocksPort. This allows everybody on your local network to use your machine as a proxy. Make sure this is what you wanted. [1 duplicate hidden]}} (Or other port number or DnsPort or TransPort.)
| Tor really listens on that IP/port. It is Whonix-Gateway's network interface, that is only available to Whonix-Workstations, because it is an internal network with Whonix-Workstation and because Whonix-Gateway is firewalled (see ''{{WhonixFirewall}}'' or in Whonix source code).

|-
| {{Code2|[NOTICE] New control connection opened. [2 duplicates hidden]}} (Or more duplicates.)
| This is caused by [[whonixcheck]]'s Tor Bootstrap Status Test, which uses Tor's ControlPort or [[Dev/CPFP|CPFP]].

|-
| {{Code2|[NOTICE][ARM_WARN] The torrc differ from what tor's using. You can issue a sighup to reload the torrc values by pressing x. Configuration value is missing from the torrc: RunAsDaemon}}
| Arm usability bug. <ref>https://trac.torproject.org/projects/tor/ticket/16459</ref>

|-
| {{Code2|"192.168.0.1 UNKNOWN 1 / Guard" in circuit information}}
| This indicates that you are connecting to the Tor network with a [[Bridges|Tor Bridge]].

If you are directly connecting to the public Tor network (without using a Tor Bridge), you should see the real IP and Nickname of the Guard instead. <ref>https://forums.whonix.org/t/how-to-check-if-i-configured-bridges-correctly-and-the-bridges-are-working-properly/4371/5</ref>

|}

{{mbox
| type    = notice
| image   = [[File:Ambox_notice.png|40px|alt=Info]]
| text    = This was the [[#Recommended|recommended]] version of this page. For more, see [[#Alternatives|alternatives]].
}}

== Arm Footnotes ==
{{reflist|close=1}}
{{Sd-end-short-start-detailed}}
__TOC__

= tor-ctrl =
== On Whonix-Gateway ==
tor-ctrl <ref>https://github.com/Whonix/tor-ctrl</ref> comes with Whonix by default.

Example usage to get a new circuit, on Whonix-Gateway:

{{CodeSelect|code=
tor-ctrl -a /var/run/tor/control.authcookie -c "signal newnym"
}}

{{CodeSelect|code=
tor-ctrl -v -a /var/run/tor/control.authcookie -c "signal newnym"
}}

See also:

{{CodeSelect|code=
man tor-ctrl
}}

== On Whonix-Workstation ==
=== Example: Get a New Identity using Whonix-Workstation Terminal ===
Do this every time you want a new circuit. Run {{Code2|tor-ctrl}} (installed by default) with {{Code2|signal newnym}}.

{{CodeSelect|code=
bash -x tor-ctrl -p notrequired -c "signal newnym"
}}

If you see at the bottom of the output.

<pre>
+ sendcmd signal newnym
+ echo signal newnym
+ sleep 1
+ sendcmd QUIT
+ echo QUIT
+ sleep 1
+ STR='Trying 127.0.0.1...
Connected to 127.0.0.1.
Escape character is '\''^]'\''.
250 OK
250 OK'
+ vecho 'Trying 127.0.0.1...
Connected to 127.0.0.1.
Escape character is '\''^]'\''.
250 OK
250 OK'
+ '[' 0 -ge 1 ']'
+ echo 'Trying 127.0.0.1...
Connected to 127.0.0.1.
Escape character is '\''^]'\''.
250 OK
250 OK'
++ grep -c '^250 '
+ '[' 2 = 3 ']'
+ exit 1
</pre>

Then it succeeded. ({{Code2|exit 1}} is a bug in {{Code2|tor-ctrl}}, because it doesn't understand the double {{Code2|250 OK}}.)

= tor-prompt =
On Whonix-Gateway.

'''For advanced users.'''

<pre>
tor-prompt 
</pre>

<pre>
Welcome to Stem's interpreter prompt. This provides you with direct access to
Tor's control interface.

This acts like a standard python interpreter with a Tor connection available
via your 'controller' variable...

  >>> controller.get_info('version')
  '0.2.5.1-alpha-dev (git-245ecfff36c0cecc)'

You can also issue requests directly to Tor...
                                                                                                                                                                                    
  >>> GETINFO version                                                                                                                                                               
  250-version=0.2.5.1-alpha-dev (git-245ecfff36c0cecc)                                                                                                                              
  250 OK                                                                                                                                                                            
                                                                                                                                                                                    
For more information run '/help'.                                                                                                                                                   
                                                                                                                                                                                    
>>> 
</pre>

= netcat =
'''For advanced users.'''

A handy way to send Tor ControlPort protocol commands to Tor's ControlPort. <ref>Or depending on if you are doing this from Whonix-Workstation only to [[Dev/CPFP|Control Port Filter Proxy]].</ref>

Do once. Install netcat.

{{CodeSelect|code=
sudo apt-get install netcat-openbsd
}}

On Whonix-Gateway or Whonix-Workstation. Connect to Tor's ControlPort. <ref>This works also on Whonix-Workstation, because the [https://github.com/Whonix/anon-ws-disable-stacked-tor anon-ws-disable-stacked-tor] package has set up rinetd listening for connections on localhost and forwarding them Tor Whonix-Gateway's, where [[Dev/CPFP|Control Port Filter Proxy]] is listening.</ref>

{{CodeSelect|code=
nc 127.0.0.1 9051
}}

Example command to change your Tor circuit.

{{CodeSelect|code=
signal newnym
}}

Should reply.

<pre>
250 OK
</pre>

= Vidalia =
'''[[#Vidalia_recommended_against|Recommended against]].'''
{{Anchor|Vidalia_recommended_against}}
Vidalia is recommended against because:

* Vidalia is unmaintained (no one is working on it anymore).
** Vidalia was removed from Tor Browser Bundle 3.5 by The Tor Project. <ref>https://tor.stackexchange.com/questions/1075/what-happened-to-vidalia</ref> <ref>As noted by Tor developer Roger Dingledine: <br />
<blockquote>Cammy is right -- we've removed the bridge/relay/exit bundles from the download page too, since Vidalia has been unmaintained for years and pointing people to unmaintained software is dangerous. I'd love to have enough developers to do everything at once, but we don't.</blockquote>
</ref>
** Vidalia was removed from all Debian variants (stretch, sid etc.) by Debian developers.
** Therefore this project has ceased.
* Vidalia has issues with controlling Tor, i.e. Vidalia can't stop the Tor which comes from the Debian package, which is started as user "debian-tor". It also can not edit {{Code2|/usr/local/etc/torrc.d/50_user.conf}}. Not sure if control commands such as New Identity are correctly processed (easy to find out).
* Vidalia does not understand obfuscated bridges.
* Which overall makes a pretty bad and confusing user experience. Therefore recommended against.
* However, if it is Vidalia's nice network map you're after, that will work.

Better use [[#Arm]].

(If you want to use Vidalia anyhow, see [[Vidalia]].)

= Footnotes =
{{reflist|close=1}}

This was the [[#Alternatives|alternative]] version of this page. For the recommend version, see [[#Recommended|recommended]].
{{Sd-end-detailed}}

= License =
<font size="-3">
Thanks to [https://www.torproject.org/projects/arm.html.en| torproject.org] for the arm screenshot, which is under [http://creativecommons.org/licenses/by/3.0/us/ Creative Commons Attribution 3.0 United States License].; [http://www.atagar.com/arm/screenshots.php Other screenshots of Arm]; [https://www.torproject.org/projects/arm.html.en Arm project page]</font>

{{Footer}}

[[Category:Documentation]]
