{{Title|title=VirtualBox Guest Additions and Shared Folders}}
{{Header}}
{{#seo:
|description=Instructions for installing VirtualBox Guest Additions in {{project_name}}. Shared Folders, Clipboard Sharing, Mouse Integration and more.
|image=https://www.whonix.org/w/images/d/de/Cd-699786640.jpg
}}
[[image:Cd-699786640.jpg|thumb]]
= Introduction = 

{{mbox
| image   = [[File:Ambox_warning_pn.svg.png|40px]]
| text    = '''Warning:''' the procedures in this section are unrecommended due to security and anonymity risks.
}}

With respect to clipboard sharing:
* Bidirectional clipboard sharing is currently disabled by default in {{project_name}} VirtualBox VMs. <ref>https://forums.whonix.org/t/host-whonix-gateway-clipboard-sharing-enable-by-default/894</ref> There are security reasons to disable clipboard sharing, for example to prevent the accidental copying of something (non-)anonymous and pasting it in its (non-)anonymous counter part such as a browser, which would lead to identity correlation. 
* For {{gateway_product_name}}, one directional clipboard sharing from the host to {{gateway_product_name}} is allowed. This is <u>not</u> insecure, because {{gateway_product_name}} is not supposed to be used as a workstation. No internet-facing client application are in use there, meaning whatever "leaked" to {{gateway_product_name}} stays there because users do not run browsers or similar applications.

Shared folders are also discouraged because it weakens isolation between the guest and the host. Providing a mechanism to access files of the host system from within the guest system via a specially defined path necessarily enlarges the attack surface and provides a potential pathway for malicious actors to compromise the host. <ref>To learn more about VirtualBox shared folders, see: [https://www.virtualbox.org/manual/ch04.html#sharedfolders VirtualBox Manual - Chapter 4. Guest Additions].</ref>

= Clipboard Sharing =

To change the clipboard sharing setting:
# Power off the virtual machine. <ref name=poweroff>Because otherwise you cannot change VirtualBox VM settings.</ref>
# Navigate to <code>VirtualBox machine settings</code> &rarr; <code>General</code> &rarr; <code>Advanced</code> &rarr; <code>Shared Clipboard</code>
# Set the preferred configuration: <code>Disabled</code>, <code>Guest to Host</code>, <code>Host to Guest</code> or <code>Bidirectional</code>.
# Power on the virtual machine again.

To learn more, see: [https://www.virtualbox.org/manual/ch03.html#generalsettings VirtualBox Manual - Chapter 3. Configuring Virtual Machines].

= Shared Folder =

== {{project_name}}-Default ==

<u>Note</u>:
* From VirtualBox v6 and above, it is no longer necessary to power off the virtual machine.
* For better usability, package [https://github.com/Whonix/shared-folder-help shared-folder-help] has already added user <code>user</code> to group <code>vboxsf</code>. <ref>Using [https://github.com/Whonix/shared-folder-help/blob/master/lib/systemd/system/mnt-shared-vbox.service /lib/systemd/system/mnt-shared-vbox.service].</ref>

{{Box|text=
# Navigate to the shared folder settings of the virtual machine: <code>VirtualBox</code> &rarr; <code>right-click the virtual machine</code> &rarr; <code>Settings</code> &rarr; <code>Shared Folder</code>
# Click the folder icon that has a <code>+</code> symbol in the upper right-hand section of the screen.
# <code>Folder Path</code> &rarr; Navigate to the folder you want to share.
# <code>Folder Name</code> &rarr; Type: <code>shared</code>. A different folder name can be utilized, but <code>shared</code> is recommended so it is the same as the example documented below -- do <u>not</u> use <code>share</code> (without the trailing <code>d</code>)!
# Check <code>Read-only</code> if you do not want to write to that folder from within the guest.
# Check <code>Auto-mount</code>. <ref name=vboxversiondependent>
If the option is unavailable, upgrade VirtualBox.
</ref>
# <code>Mount Point</code> &rarr; Leave as is (leave it empty and do not make any changes). <ref>
Alternatively folder <code>/home/user/shared</code> can be chosen. The VirtualBox default means that folder would be owned by owner <code>root</code> and group <code>vboxsf</code>.
</ref>
# Check <code>Make Permanent</code> (if that option exists). <ref>
This is specific to the VirtualBox version; newer versions do not have this option anymore.

Check <code>Make Permanent</code> if this setting should persist after restart of the virtual machine. Otherwise this setting will be temporary.
</ref>
# Press <code>OK</code> to close shared folder dialog.
# Press <code>OK</code> to close VirtualBox settings.
# The process is now complete and the shared folder can be used.

VirtualBox shared folders are found inside the virtual machine in folder <code>/media/</code>.

By default, VirtualBox uses the prefix <code>sf_</code>.

In the above example, the <code>shared</code> folder will become <code>/media/sf_shared</code>. It can be opened using a file manager like Thunar. To open it using the the command line, run.

{{CodeSelect|code=
cd /media/sf_shared
}}
}}

== {{custom workstation product name}} ==
{{Anchor|For {{project_name}} versions below 14:}}
<div class="toccolours mw-collapsible mw-collapsed">
<u>If you are using a [[Other Operating Systems|{{custom workstation product name}}]]</u> you need to do this manually, please click on expand on the right.
<div class="mw-collapsible-content">
Two options. Automatic mounting or manual mounting. Automatic mounting is described below. For automatic mounting see https://www.virtualbox.org/manual/ch04.html#sharedfolders - This is VirtualBox question, unspecific to Whonix as per [[Free Support Principle]].

1) Install VirtualBox guest additions inside the VM. <ref>Required. Quote https://www.virtualbox.org/manual/ch04.html#sharedfolders

<blockquote>
With the shared folders feature of Oracle VM VirtualBox, you can access files of your host system from within the guest system. This is similar to how you would use network shares in Windows networks, except that shared folders do not require networking, only the Guest Additions.
</blockquote>
</ref>

2) Add the user supposed to use shared folders from inside the VM to group <code>vboxsf</code>.

{{CodeSelect|code=
sudo addgroup user vboxsf
}}

3) Reboot required to make group changes take effect.

4) Follow instructions below.
</div>
</div>

{{Anchor|For {{project_name}} 14 and above}}

= VirtualBox Guest Additions =

== Installed by Default ==
VirtualBox Guest Additions are installed by default. <ref>
* package <code>virtualbox-guest-x11</code>
* [https://forums.whonix.org/t/installing-virtualbox-guest-addition-by-default/700 Installing VirtualBox Guest Addition by Default?]
</ref>

== Installation from VirtualBox CD ==
Discouraged?

If you must, consider https://packages.debian.org/virtualbox-guest-additions-iso instead.

== virtualbox-guest-additions-iso ==
TODO: document

/usr/sbin/vbox-uninstall-guest-additions

=== Debugging ===
{{CodeSelect|code=
cat /var/log/vboxadd-install.log
}}

{{CodeSelect|code=
sudo systemctl status vboxadd
}}

{{CodeSelect|code=
sudo systemctl status vboxadd-service.service
}}

{{CodeSelect|code=
ls -la /opt/VBoxGuestAdditions-*/init/
}}

== Issue ==
Short link https://www.whonix.org/wiki/ga links here. <ref>
https://www.whonix.org/w/index.php?title=Ga&action=edit
</ref>

[https://gitlab.com/whonix/vm-config-dist/-/blob/master/usr/bin/vbox-guest-installer <code>vbox-guest-installer</code>]: VirtualBox guest additions from package virtualbox-guest-additions-iso installation helper by Whonix developers

TODO

=== Non-Issues ===
During kernel upgrade.

<pre>
/etc/kernel/postinst.d/vboxadd:
VirtualBox Guest Additions: Building the modules for kernel 5.6.0-0.bpo.2-amd64.
Failed to rename process, ignoring: Operation not permitted
update-initramfs terminated by signal TERM.
</pre>

== Security ==
The article [http://www.phoronix.com/scan.php?page=news_item&px=OTk5Mw The VirtualBox Kernel Driver Is Tainted Crap] <ref>http://www.webcitation.org/6HqJVN0br</ref> is talking about the kernel driven (on the host), not guest additions. Opposite statements: [http://lists.debian.org/debian-devel/2013/08/msg00112.html one] / [http://lists.debian.org/debian-devel/2013/08/msg00116.html two].

== Alternatives ==
* For file exchange with {{project_name}} without installing guest additions, see [[File Transfer]] and [[File Sharing]].
* To get a higher screen resolution without installing guest additions, see [[VirtualBox/Higher Screen Resolution without installing VirtualBox Guest Additions]]
* To get mouse integration without installing guest additions, use USB tablet in VirtualBox settings. Recommended against, because it requires adding USB controller to VirtualBox. (VirtualBox &rarr; Right click on Virtual Machine &rarr; Settings &rarr; System &rarr; Enable absolute pointing device)

= See Also =
* [[Dev/Virtualization_Platform#VirtualBox]]
* [[Dev/VirtualBox]]
* [[Dev/VirtualBox#VirtualBox_Guest_Additions_ISO_Freedom_vs_Non-Freedom|VirtualBox Guest Additions ISO Freedom vs Non-Freedom]]

= Footnotes =
{{reflist|close=1}}

{{Footer}}

[[Category:Documentation]]
