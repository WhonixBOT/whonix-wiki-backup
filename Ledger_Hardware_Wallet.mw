{{Header}}
{{#seo:
|description=HowTo: Ledger Hardware Wallet with Qubes
}}
{{Title|
title=HowTo: Ledger Hardware Wallet with Qubes
}}
{{mbox
| type      = notice
| image   = [[File:Ambox_notice.png|40px|alt=Info]]
| text       = These instructions are still in development. [[Qubes-Whonix]] testers only!
}}

= Introduction =
[https://www.ledgerwallet.com/ Ledger wallets] are a special type of commercial bitcoin wallet whereby a user's private keys are stored in a secure hardware device. Other commercial alternatives include Pi Wallet, TREZOR, BWALLET, KeepKey, Opendime, CoolWallet and others.

The major advantages of hardware wallets over software wallets include: <ref>https://en.bitcoin.it/wiki/Hardware_wallet</ref>

* Usually private keys are stored in a protected area of a microcontroller, and cannot be transferred out of the device in plaintext.
* Resistance to computer viruses that target theft from software wallets.
* More secure and interactive than paper wallets that require importation to software.
* Usually software on the device is open source.


The main principle is that cryptographic secrets (private keys) are fully isolated from easy-to-hack computers or smartphones. Ledger wallets use secure chips that are similar to the technology used in chip and PIN payment cards or SIM cards. <ref>https://ledger.zendesk.com/hc/en-us/articles/115005198485-Hardware-wallets-FAQ</ref>

= Security Risks =
{{mbox
| image   = [[File:Ambox_warning_pn.svg.png|40px]]
| text       = '''Warning:''' Hardware wallets are not bulletproof. The user must be sure to purchase a good-quality, authentic device manufactured by a trustworthy and technically competent company with a good reputation in security.
}}


Potential risks of hardware wallets include: <ref>https://en.bitcoin.it/wiki/Hardware_wallet</ref>

*  Malware swapping recipient Bitcoin addresses. Malware on a PC could potentially trick the user into sending Bitcoin to the wrong address. Multi-factor confirmation of a recipient's Bitcoin address mitigates this risk.
* Insecure RNG (Random Number Generator). Security is reliant on true randomness being generated by the source of entropy for the RNG, since it generates the wallet's private keys. This is hard to verify, and attackers may be able to recreate wallet keys if the RNG is insecure. <ref>The attacker generates psuedo-randomness that is indistinguishable from true randomness, but is still predictable.</ref>
* Imperfect implementation. If bugs are present in the software, firmware or hardware, then attackers may be able to gain unauthorized access to the hardware wallet. 
* Compromised production process. Hardware backdoors could be introduced via intentional or unintentional actions that leaves security holes in the final product.
* Device interdiction. No hardware wallet solution can deal with the threat of government programs that intercept hardware and modify them in transit to introduce backdoors.


Despite these risks, hardware wallets are considered a higher security solution than software wallets, since the latter must make private keys available in plain text in the computer's memory when transactions are signed - any compromise by Bitcoin-targeting malware would enable theft of Bitcoins. <ref>https://ledger.zendesk.com/hc/en-us/articles/115005198485-Hardware-wallets-FAQ</ref>

= Installation =
{{mbox
| type      = notice
| image   = [[File:Ambox_notice.png|40px|alt=Info]]
| text       = If using the Nano S, Nano or HW1 ledger hardware wallets, a USB port is required.
}}

== Chromium Installation ==
Chromium is required to use the run the Chrome applications ledger bitcoin and ledger ethereum. No additional software installation or account creation is needed.

In Qubes TemplateVM.

Open a terminal (konsole). 

{{Update}}

{{CodeSelect|code=
sudo apt-get update
}}

Install Chromium.

{{CodeSelect|code=
sudo apt-get install chromium
}}

== udev Rules ==
In Qubes TemplateVM.

Open a terminal (konsole). <ref>Further research is required to confirm this step is required.</ref>

{{CodeSelect|code=
sudo adduser user plugdev
}}

{{Open with root rights
|filename=60-ledger.rules
}}

Add. <ref>
https://ledger.groovehq.com/knowledge_base/topics/ledger-wallet-is-not-recognized-on-linux
</ref>

{{CodeSelect|code=
SUBSYSTEMS=="usb", ATTRS{idVendor}=="2581", ATTRS{idProduct}=="1b7c", MODE="0660", OWNER="user", GROUP="plugdev"
SUBSYSTEMS=="usb", ATTRS{idVendor}=="2581", ATTRS{idProduct}=="2b7c", MODE="0660", OWNER="user", GROUP="plugdev"
SUBSYSTEMS=="usb", ATTRS{idVendor}=="2581", ATTRS{idProduct}=="3b7c", MODE="0660", OWNER="user", GROUP="plugdev"
SUBSYSTEMS=="usb", ATTRS{idVendor}=="2581", ATTRS{idProduct}=="4b7c", MODE="0660", OWNER="user", GROUP="plugdev"
SUBSYSTEMS=="usb", ATTRS{idVendor}=="2581", ATTRS{idProduct}=="1807", MODE="0660", OWNER="user", GROUP="plugdev"
SUBSYSTEMS=="usb", ATTRS{idVendor}=="2581", ATTRS{idProduct}=="1808", MODE="0660", OWNER="user", GROUP="plugdev"
SUBSYSTEMS=="usb", ATTRS{idVendor}=="2c97", ATTRS{idProduct}=="0000", MODE="0660", OWNER="user", GROUP="plugdev"
SUBSYSTEMS=="usb", ATTRS{idVendor}=="2c97", ATTRS{idProduct}=="0001", MODE="0660", OWNER="user", GROUP="plugdev"

KERNEL=="hidraw*", SUBSYSTEM=="hidraw", MODE="0660", OWNER="user", GROUP="plugdev", ATTRS{idVendor}=="2c97"
KERNEL=="hidraw*", SUBSYSTEM=="hidraw", MODE="0660", OWNER="user", GROUP="plugdev", ATTRS{idVendor}=="2581"
}}

Save.

Shut down Qubes TemplateVM.

Restart ledger AppVM.

== Ledger App Installation ==
<div class="toccolours mw-collapsible mw-collapsed" style="width:800px">
For graphical user interface instructions, which are easier but less secure, click on expand on the right.
<div class="mw-collapsible-content">
'''Ledger Manager'''

https://chrome.google.com/webstore/detail/ledger-manager/beimhnaefocolcplfimocfiaiefpkgbf

'''Ledger Wallet Bitcoin'''

https://chrome.google.com/webstore/detail/ledger-wallet-bitcoin/kkdpmhnladdopljabkgpacgpliggeeaf

'''Ledger Wallet Ethereum'''

https://chrome.google.com/webstore/detail/ledger-wallet-ethereum/hmlhkialjkaldndjnlcdfdphcgeadkkm

'''Ledger Wallet Ripple'''

[[Undocumented]]. Please refer to command line instructions below or to instructions on the ledger hardware wallet homepage.

https://www.ledgerwallet.com/apps/ripple
</div>
</div>

<div class="toccolours mw-collapsible mw-collapsed" style="width:800px">
For graphical user interface instructions, which are easier but less secure, click on expand on the right.
<div class="mw-collapsible-content">
'''Ledger Manager'''

Run.

{{CodeSelect|code=
chromium --host-rules="MAP * 127.0.0.1, EXCLUDE chrome.google.com" https://chrome.google.com/webstore/detail/ledger-manager/beimhnaefocolcplfimocfiaiefpkgbf
}}

'''Ledger Wallet Bitcoin'''

Run.

{{CodeSelect|code=
chromium --host-rules="MAP * 127.0.0.1, EXCLUDE chrome.google.com" https://chrome.google.com/webstore/detail/ledger-wallet-bitcoin/kkdpmhnladdopljabkgpacgpliggeeaf
}}

'''Ledger Wallet Ethereum'''
Run.

{{CodeSelect|code=
chromium --host-rules="MAP * 127.0.0.1, EXCLUDE chrome.google.com" https://chrome.google.com/webstore/detail/ledger-wallet-ethereum/hmlhkialjkaldndjnlcdfdphcgeadkkm
}}

'''Ledger Wallet Ripple'''

{{Open a Whonix-Workstation Terminal}}

Run.

{{CodeSelect|code=
curl {{Curl_Secure}} --location --remote-name https://apps.ledgerwallet.com/ripple/download/linux_deb_64.deb
}}
</div>
</div>

= Usage =
Connect ledger.

Enter the PIN.

{{mbox
| type      = notice
| image   = [[File:Ambox_notice.png|40px|alt=Info]]
| text       = Qubes won't detect ledger before the PIN has been entered. Guest: ledger does not announce itself before that.
}}

Connect to ledger VM.

Using Graphical user Interface

<div class="toccolours mw-collapsible mw-collapsed" style="width:800px">
For graphical user interface instructions, which are easier but less secure, click on expand on the right.
<div class="mw-collapsible-content">
'''Ledger Manger / Ledger Wallet Bitcoin / Ledger Wallet Ethereum'''
Start chromium.

Click apps.

Choose a ledger app and start it.

You can also refer to the instructions on the ledger hardware wallet website.

https://www.ledgerwallet.com/apps

'''Ledger Wallet Ripple'''

[[Undocumented]]. Please refer to command line instructions below or to instructions on the ledger hardware wallet homepage.
</div>
</div>

Using Command Line

<div class="toccolours mw-collapsible mw-collapsed" style="width:800px">
For command line instructions, which have worse usability but are more secure, click on expand on the right.
<div class="mw-collapsible-content">
'''Ledger Manager'''

Run. <ref>
Using <code>--host-rules="MAP * 127.0.0.1, EXCLUDE 127.0.0.1"</code> won't work.
</ref>

{{CodeSelect|code=
chromium --app-id=beimhnaefocolcplfimocfiaiefpkgbf
}}

'''Ledger Wallet Bitcoin'''
Run.

{{CodeSelect|code=
chromium --app-id=kkdpmhnladdopljabkgpacgpliggeeaf
}}

'''Ledger Wallet Ethereum'''
Run.

{{CodeSelect|code=
chromium --app-id=hmlhkialjkaldndjnlcdfdphcgeadkkm
}}

'''Ledger Wallet Ripple'''
Run.

{{CodeSelect|code=
sudo dpkg -i linux_deb_64.deb
}}
</div>
</div>

= Troubleshooting =
{{CodeSelect|code=
qvm-usb
}}

<pre>
BACKEND:DEVID  DESCRIPTION               USED BY
sys-usb:2-1.1  Logitech_USB_Keyboard     
sys-usb:2-1.2  PixArt_USB_Optical_Mouse  
sys-usb:2-1.4  Ledger_Nano_S_0001        
</pre>

{{CodeSelect|code=
qvm-usb attach ledger-debian-stretch sys-usb:2-1.4
}}

See also [[Dev/Ledger Hardware Wallet]].

= Footnotes =
<references />

{{Footer}}

[[Category:Documentation]]
