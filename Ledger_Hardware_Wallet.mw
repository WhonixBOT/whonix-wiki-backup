{{Header}}
{{#seo:
|description=How-to: Ledger Hardware Wallet with Qubes
|image=https://www.{{project_clearnet}}/w/images/1/13/Hardware-159264640.png
}}
{{Title|
title=How-to: Ledger Hardware Wallet in Qubes
}}
[[image:Hardware-159264640.png|thumb]]
{{#widget:Expand or Collapse All}}

= Introduction =
{{mbox
| type    = notice
| image   = [[File:Ambox_notice.png|40px|alt=Info]]
| text    = [[{{q project name short}}|{{q project name}}]] testers only!
}}
{{mbox
| image   = [[File:Ambox_warning_pn.svg.png|40px]]
| text    = The concepts in this chapter are still valid but the applications and corresponding installation instructions may have changed in the meantime.
}}

[https://www.ledgerwallet.com/ Ledger wallets] are a special type of commercial bitcoin wallet whereby a user's private keys are stored in a secure hardware device. Other commercial alternatives include Pi Wallet, TREZOR, BWALLET, KeepKey, Opendime, CoolWallet and others.

The major advantages of hardware wallets over software wallets include: <ref>https://en.bitcoin.it/wiki/Hardware_wallet</ref>

* Usually private keys are stored in a protected area of a microcontroller, and cannot be transferred out of the device in plaintext.
* Resistance to computer viruses that target theft from software wallets.
* More secure and interactive than paper wallets that require importation to software.
* Usually software on the device is open source.

The main principle is that cryptographic secrets (private keys) are fully isolated from easy-to-hack computers or smartphones. Ledger wallets use secure chips that are similar to the technology used in chip and PIN payment cards or SIM cards. <ref>https://ledger.zendesk.com/hc/en-us/articles/115005198485-Hardware-wallets-FAQ</ref>

= Security Factors =
== Essentials ==
* What is a seed phrase?
* [https://blog.kraken.com/post/6746/ledger-phishing-scam-targets-crypto-hardware-wallet-users/ Ledger Phishing Scam Targets Crypto Hardware Wallet Users]
* 
{{mbox
| image   = [[File:Ambox_warning_pn.svg.png|40px]]
| text    = Never enter the seed phrase on any electronic device except the hardware wallet!
}}

== Security Risks ==

{{mbox
| image   = [[File:Ambox_warning_pn.svg.png|40px]]
| text    = '''Warning:''' Hardware wallets are not bulletproof. The user must be sure to purchase a good-quality, authentic device manufactured by a trustworthy and technically competent company with a good reputation in security.
}}

Potential risks of hardware wallets include: <ref>https://en.bitcoin.it/wiki/Hardware_wallet</ref>

* <u>Compromised production process</u>: Hardware backdoors could be introduced via intentional or unintentional actions that leaves security holes in the final product.
* <u>Device interdiction</u>: No hardware wallet solution can deal with the threat of government programs that intercept hardware and modify them in transit to introduce backdoors.
* <u>Imperfect implementation</u>: If bugs are present in the software, firmware or hardware, then attackers may be able to gain unauthorized access to the hardware wallet. 
* <u>Insecure Random Number Generator (RNG)</u>: Security is reliant upon true randomness being generated by the source of entropy for the RNG, since it generates the wallet's private keys. This is hard to verify, and attackers may be able to recreate wallet keys if the RNG is insecure. <ref>The attacker generates psuedo-randomness that is indistinguishable from true randomness, but is still predictable.</ref>
*  <u>Malware swapping recipient Bitcoin addresses</u>: Malware on a PC could potentially trick the user into sending Bitcoin to the wrong address. Multi-factor confirmation of a recipient's Bitcoin address mitigates this risk.

Despite these risks, hardware wallets are considered a higher security solution than software wallets, since the latter must make private keys available in plain text in the computer's memory when transactions are signed -- any compromise by Bitcoin-targeting malware would enable theft of Bitcoins. <ref>https://ledger.zendesk.com/hc/en-us/articles/115005198485-Hardware-wallets-FAQ</ref>

== Seed Backup Security ==

It is definitively safer to have at least two ledger hardware wallets. During initial setup the ledger does not verify all words of the seed; it only verifies two words of the 24-word seed. This means if one word is mistyped, it will be difficult later on to regain access to personal coins. On the other hand, two ledgers using the same seed should generate the same addresses, which proves the seed was correctly backed up.

Seed testing applications are available like [https://github.com/parkerhoyes/bolos-app-seedutility BOLOS Seed Utility App]. <ref><blockquote>This repository contains an application for the Ledger Nano S that allows the user to verify the backup of their BIP 39 mnemonic by comparing it to the master seed stored on the device.</blockquote></ref> <ref>https://www.reddit.com/r/ledgerwallet/comments/6ez4qs/ledger_nano_s_seed_utility_app_released/</ref> It is probably safer to avoid these tools since they are maintained by a third party and this adds complexity to the procedure.

Another alternative is to:
# note some generated addresses
# reset the ledger
# re-setup with the seed and see if it still uses the same addresses

== Wallet Testing Security ==

Before storing any significant funds in a wallet, it is recommended to first test sending a small amount there and then trying to send it back. The reason is software bugs could potentially lead to the presentation of an address where the user does not own the corresponding private key.

The threat of losing funds due to software bugs is not just hypothetical. For instance, [https://www.reddit.com/r/ethereum/comments/48rt6n/using_myetherwalletcom_just_burned_me_for/ this user] <ref>[http://www.webcitation.org/6ucscCGxX Web citation].</ref> utilizing MyEtherWallet.com lost over one thousand dollars due to a historical bug in the Ethereum Javascript implementation.

== Threat Model ==
{{mbox
| image   = [[File:Ambox_warning_pn.svg.png|40px]]
| text    = Highly recommended reading: [[Hardware Wallet Security]]
}}

= Installation =
{{mbox
| type      = notice
| image   = [[File:Ambox_notice.png|40px|alt=Info]]
| text    = A USB port is required if using the Nano S, Nano or HW1 ledger hardware wallets.
-----
This comes with some technical challenges, although it is easier to use in combination with Qubes. First learn how to pass a USB device to an AppVM and attempt that procedure in order to iron out any eventual Qubes USBVM issues.
}}

== Qubes USB Proxy Installation ==

This step is mandatory for [[Qubes]] users.

Install Qubes USB Proxy. <ref>See:
[https://github.com/QubesOS/qubes-issues/issues/2473#issuecomment-273634599 Problem with adding USB device to a VM].
</ref>

{{Install_Package|package=
qubes-usb-proxy
}}

== Electrum Installation ==

This step is optional and only necessary if you intend to use Electrum.

[[Electrum]] is installed by default in {{Workstation product name}}, but several dependencies are required for a hardware wallet. <ref>https://electrum.readthedocs.io/en/latest/hardware-linux.html</ref> <ref>Broken link: 
https://ledger.groovehq.com/knowledge_base/topics/how-to-setup-electrum-nano-slash-nano-s
</ref>

{{Install_Package|package=
libudev-dev libusb-1.0-0-dev python3-btchip
}}

<ref>
This is probably outdated:

* Was not required. <code>ln -s /lib/x86_64-linux-gnu/libudev.so.1 /lib/x86_64-linux-gnu/libudev.so</code>
* https://github.com/spesmilo/electrum/issues/3422#issuecomment-348063118
* Install <code>python3-btchip</code> (<code>btchip-python</code> ?). Unfortunately it is not available from Debian's repository. Therefore we have to install it using python-pip.

TODO: bug report against https://packages.debian.org/buster/python-btchip ?

python-pip warning: See [[Install_Software#Avoid_Third_Party_Package_Managers|Avoid Third Party Package Managers]]!

{{CodeSelect|code=
python3 -m pip install btchip-python
}}
</ref>

== udev Rules ==
{{Box|text=
'''1.''' Open a terminal in Qubes TemplateVM.

Open a terminal (konsole). <ref>Further research is required to confirm if this step is still necessary. The issue appears to have been fixed, see: [https://github.com/spesmilo/electrum/issues/3947 Ledger Nano S not detected on Linux].</ref>

{{CodeSelect|code=
sudo adduser user plugdev
}}

{{Open with root rights
|filename=/etc/udev/rules.d/20-hw1.rules
}}

'''2.''' Add the following settings. <ref>
* https://support.ledger.com/hc/en-us/articles/115005165269-Fix-connection-issues
* https://github.com/LedgerHQ/udev-rules
* https://github.com/LedgerHQ/udev-rules/blob/master/20-hw1.rules
* https://github.com/LedgerHQ/udev-rules/blob/master/add_udev_rules.sh
* https://github.com/LedgerHQ/udev-rules/blob/master/LICENSE
</ref>

{{CodeSelect|code=
# HW.1 / Nano
SUBSYSTEMS=="usb", ATTRS{idVendor}=="2581", ATTRS{idProduct}=="1b7c|2b7c|3b7c|4b7c", TAG+="uaccess", TAG+="udev-acl"
# Blue
SUBSYSTEMS=="usb", ATTRS{idVendor}=="2c97", ATTRS{idProduct}=="0000|0000|0001|0002|0003|0004|0005|0006|0007|0008|0009|000a|000b|000c|000d|000e|000f|0010|0011|0012|0013|0014|0015|0016|0017|0018|0019|001a|001b|001c|001d|001e|001f", TAG+="uaccess", TAG+="udev-acl"
# Nano S
SUBSYSTEMS=="usb", ATTRS{idVendor}=="2c97", ATTRS{idProduct}=="0001|1000|1001|1002|1003|1004|1005|1006|1007|1008|1009|100a|100b|100c|100d|100e|100f|1010|1011|1012|1013|1014|1015|1016|1017|1018|1019|101a|101b|101c|101d|101e|101f", TAG+="uaccess", TAG+="udev-acl"
# Aramis
SUBSYSTEMS=="usb", ATTRS{idVendor}=="2c97", ATTRS{idProduct}=="0002|2000|2001|2002|2003|2004|2005|2006|2007|2008|2009|200a|200b|200c|200d|200e|200f|2010|2011|2012|2013|2014|2015|2016|2017|2018|2019|201a|201b|201c|201d|201e|201f", TAG+="uaccess", TAG+="udev-acl"
# HW2
SUBSYSTEMS=="usb", ATTRS{idVendor}=="2c97", ATTRS{idProduct}=="0003|3000|3001|3002|3003|3004|3005|3006|3007|3008|3009|300a|300b|300c|300d|300e|300f|3010|3011|3012|3013|3014|3015|3016|3017|3018|3019|301a|301b|301c|301d|301e|301f", TAG+="uaccess", TAG+="udev-acl"
# Nano X
SUBSYSTEMS=="usb", ATTRS{idVendor}=="2c97", ATTRS{idProduct}=="0004|4000|4001|4002|4003|4004|4005|4006|4007|4008|4009|400a|400b|400c|400d|400e|400f|4010|4011|4012|4013|4014|4015|4016|4017|4018|4019|401a|401b|401c|401d|401e|401f", TAG+="uaccess", TAG+="udev-acl"
}}

Save.

'''3.''' Shut down Qubes TemplateVM.

'''4.''' Start the VM which is supposed to interact with the ledger hardware wallet, which we will call <code>ledger VM</code>.
}}

== Ledger Live Application Installation ==
=== Download and Digital Software Verification ===
==== Introduction ====
{{always verify signatures reminder}}

At time of writing, [https://github.com/LedgerHQ/ledger-live-desktop/issues/2525 ledger did not provide OpenPGP (<code>gpg</code>) digital software signatures]. Performing digital software signature verification for the ledger live software requires <code>openssl</code> which is an even more cumbersome process than using <code>gpg</code>. Digital software signature verification is however highly recommended.

As always, do your own research on what is a legitimate domain name versus a scam domain name! Related: https://t.me/s/Whonix_All_News/10

* https://www.ledger.com/ledger-live/lld-signatures
* https://validate.live.ledger.com/lld-signatures

<ref>
* https://github.com/LedgerHQ/ledger-live-desktop/issues/2877
* https://github.com/LedgerHQ/ledger-live-desktop/blame/develop/src/main/updater/ledger-pubkey.js
</ref>

Store all downloaded files in the same folder for simplicity. <ref>
Otherwise file paths need to be manually adjusted by the user.
</ref> User home folder would be most simple. <ref>
Other prior <code>cd /path/to/folder</code> required.
</ref>

{{mbox
| image   = [[File:Ambox_warning_pn.svg.png|40px]]
| text    = Do not continue if verification fails! This risks using infected or erroneous files! The whole point of verification is to confirm file integrity. This warning is strongly related to [[Verifying Software Signatures]] page.
}}

{{mbox
| image   = [[File:Ambox_notice.png|40px]]
| text    =
These Ledger Live digital signature verification instructions are alternative. Can be seen as inspiration. A compilation of various information available on the internet. The user is free to question and ignore anything written here. In case of issues, refer to the information from the official Ledger homepage. Support requests should be directed at Ledger, not {{project name}}. See also [[Free Support Principle]].
}}

{{mbox
| image   = [[File:Ambox_warning_pn.svg.png|40px]]
| text    = If the wiki page [[Verifying Software Signatures|digital software signature verification]] was read and understood, it should be clear by now, that anything written here conceptually cannot be trusted and should be independently verified by the user.
}}

==== Ledger Developer OpenPGP Public Key ====
Key was found here:

* https://keybase.io/nicolab
* https://keybase.io/nicolab#show-public
* https://keybase.io/nicolab/pgp_keys.asc
* [https://github.com/LedgerHQ/ledger-live-desktop/issues/3601 publish Ledger developer OpenPGP (gpg) key on ledger.com]

Key fingerprint was found here:

* https://www.reddit.com/r/KeybaseProofs/comments/3ef1l4/my_keybase_proof_redditbtchip_keybasenicolab/

Open a new file <code>~/ledger-developer-public-key.asc</code> in a text editor.

<pre>
-----BEGIN PGP PUBLIC KEY BLOCK-----
Version: GnuPG v1.4.11 (GNU/Linux)

mQENBFRcc7kBCADPzzR0VK6tPTUmPSz0L2t56idtdGglW67GIcdl4pH2qI8p4ZQO
qWv3r2ICjTBRsgU895UjvldfR9NM9pUHm7+LWrrCOwlwshoI6D8uY07jJ0ghzN+o
UyR7kZXI/Fy0AzcpXYllcSZstNWv4vQvFbEK6ygIa5RnoxS6tBCh/bzgXjEb3W+N
AsI1HbBJWTGRDOG0hCs5RIzi3Cdu84noYvR+jb1elmIWWPj7sNkjA9il5zNghoWN
1IKFWu7wpXdyMZU2z55D/IZhSiLVUu8a/ck+WApC4mYEKxmGXsxqUAhjq7O1WTkp
bNUk+rsXmkrSXIEYTD3bG+I/whJjr0vE/vefABEBAAG0Kk5pY29sYXMgQmFjY2Eg
KExlZGdlcikgPG5pY29sYXNAbGVkZ2VyLmZyPokBOAQTAQIAIgUCVFxzuQIbAwYL
CQgHAwIGFQgCCQoLBBYCAwECHgECF4AACgkQaD15ON9VFc4IQQf/XROBFfPzH5R4
uXGFXJx7NNf3woGXLTKWJizjvaYXEfIA45X6ku/PJ2EKtVrLkmAiF3lMumEgOmLP
+t4CAJq6xUHGXXSq/S9Jgt6G5jo942pocYKHy0m/GK5l90j0gLlFTp3fPNP0DhMy
P98gWBeBlY2Eu2I517COKDgVMk5HEBV0r1QicHo0OPpvbfLuv2hurKOSI9iGNS0G
wu9/inks7BiaEZoFr54R1Yhdku4MPxnvc4sQ5gcM/EJ3UKrGLJOwea4Tqtc74zVd
gBonleHhrJ9X68fQya2YeNuAhdV3Ei5AYZHETNqa7gcF4pWcogongHkKOrWB0o7w
/igsNEYOWLkBDQRUXHO5AQgA20UcIKTjG2IfqZpuNw74j3WbBjnqDB1J3rzwOJ5Z
QgWvWf18ybxYHM0GlZVRaXuf+H8FV0unMeNoyUt+N66SXdr4S5wdeJZO3D5QQ+xy
GlD+c969lOTZQTMBpoM6ETmA7OC5Hf2wowKcPvbvcrkG3r9PRjgcvdYfzTb1JoZ0
juEnzgSLQEAU3lxRbw6+HNCQdXyXToHHOTMqAzEBq8Q859y+tzHhYP2KoKSSmCfK
QF8wnLRfJaYRfWGL/DUSLMfGa0JImg1PXaNAvwNqJB1hjB8d8zyuZpOlMhnA1ab/
C7KrnayXtFZvyKVNKT0luW/7TPw3+CqpSdHXhcC1sUd+EQARAQABiQEfBBgBAgAJ
BQJUXHO5AhsMAAoJEGg9eTjfVRXO2Z8H/AxSIQMokp+S0BfHNESx5UuM9WnacDgJ
VMg1mwg32g9aw0jyUfslLgwd31/Z1NxxL1D8af5gNV5iWPoyRXP4pJZVuDHvmJE2
ULkKZgABiIazpDD3zL7aKBZ6/URY6XWrXs3b47ea2cvNctJdqjsiAPXEHGKMMoaQ
CfMhI0+7OKjjt6rFCEW8ZwhN2Xntjj7GqZhii23tgAPrrFzsVignrCogc3IGjowi
dd38UQcg/GxtF69gD56uB15opOr/1JddNga2xYAMzIUbJ81H7VVASg8N1lqdOGCM
zUy4DRfdLm3aWve2n4/cJQ857cpqWowvU7KKk5CE9gOuQddGRhqmnoc=
=UP/G
-----END PGP PUBLIC KEY BLOCK-----
</pre>

{{CodeSelect|code=
gpg --import ~/ledger-developer-public-key.asc
}}

Following message was shown to the author of this wiki page:

<pre>
gpg: key 0x683D7938DF5515CE: public key "Nicolas Bacca (Ledger) <nicolas@ledger.fr>" imported
gpg: Total number processed: 1
gpg:               imported: 1
</pre>

{{CodeSelect|code=
gpg --fingerprint BAE88B19F6E323236DEB1AC7683D7938DF5515CE
}}

Following message was shown to the author of this wiki page:

<pre>
pub   rsa2048/0x683D7938DF5515CE 2014-11-07 [SC]
      Key fingerprint = BAE8 8B19 F6E3 2323 6DEB  1AC7 683D 7938 DF55 15CE
uid                   [ unknown] Nicolas Bacca (Ledger) <nicolas@ledger.fr>
sub   rsa2048/0xF8EBDECDBA9631CA 2014-11-07 [E]
</pre>

==== Ledger OpenSSL Public Key Verification Message ====
Open a new file <code>~/ledger-key-verification-message.asc</code> in a text editor.

Paste.

<pre>
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

- -----BEGIN PUBLIC KEY-----
MFYwEAYHKoZIzj0CAQYFK4EEAAoDQgAEN7qcsG6bogi1nkD3jnMWS813wWguYEcI
CRcijSvFskSFjHB5la4xUt+Omb2t6iUwop+JRy+EUhy0UQ9p/cPsQA==
- -----END PUBLIC KEY-----

is the correct public key used for Ledger Live releases

-----BEGIN PGP SIGNATURE-----

iQFGBAEBCgAwFiEEuuiLGfbjIyNt6xrHaD15ON9VFc4FAl+1WXESHG5pY29sYXNA
bGVkZ2VyLmZyAAoJEGg9eTjfVRXOzkIH/1SThfewrwo78bykaFM6aOdafaD5L7Ao
rnwTsyt8ipgoolEd+j4gC2fdphhw4Zde5M1YXbLH/K+QC99HsDR2GmD7oAPsccQC
dmst47lhSnyULUhAOfzC5USUs7jwFuNqX6TCf5B2Knym9f3CiyPKbKTZU894AH7d
jJmQUp05aU5f6Tp9ivcaJMUjPGT1l78fI3NR6UxqYkRKS9U3uFeMUBl3Y5QLkfMI
RrrVGciv05i7lkQl3pUX/t7luLKCFrnBqhHzLnOQujxOwLUUFEUeYiju9Ye8VdwY
oMcJSgRBhvTwgvL/WNi86yHE33B3IOxjEVMpDO5rlvHk6L2VRa4gZ60=
=M6VP
-----END PGP SIGNATURE-----
</pre>

Save.

Verify the Ledger OpenSSL Public Key Verification Message.

{{CodeSelect|code=
gpg --verify ledger-key-verification-message.asc
}}

Following message was shown to the author of this wiki page: 

<pre>
gpg: Signature made Wed 18 Nov 2020 12:27:13 PM EST
gpg:                using RSA key BAE88B19F6E323236DEB1AC7683D7938DF5515CE
gpg:                issuer "nicolas@ledger.fr"
gpg: Good signature from "Nicolas Bacca (Ledger) <nicolas@ledger.fr>" [unknown]
gpg: WARNING: This key is not certified with a trusted signature!
gpg:          There is no indication that the signature belongs to the owner.
Primary key fingerprint: BAE8 8B19 F6E3 2323 6DEB  1AC7 683D 7938 DF55 15CE
</pre>

==== Ledger OpenSSL Public Key ====
Open a new file <code>~/ledgerlive.pem</code> in a text editor.

Paste <code>Ledger Live's OpenSSL public key (ECDSA)</code>.

<pre>
-----BEGIN PUBLIC KEY-----
MFYwEAYHKoZIzj0CAQYFK4EEAAoDQgAEN7qcsG6bogi1nkD3jnMWS813wWguYEcI
CRcijSvFskSFjHB5la4xUt+Omb2t6iUwop+JRy+EUhy0UQ9p/cPsQA==
-----END PUBLIC KEY-----
</pre>

Make sure that the actual key part <code>MFYwEAYHKoZIzj0CAQYFK4EEAAoDQgAEN7qcsG6bogi1nkD3jnMWS813wWguYEcI
CRcijSvFskSFjHB5la4xUt+Omb2t6iUwop+JRy+EUhy0UQ9p/cPsQA==</code> matches from [[#Ledger OpenSSL Public Key Verification Message|Ledger OpenSSL Public Key Verification Message]].

Save.

Unfortunately Ledger OpenSSL Public Key does not exactly match Ledger OpenSSL Public Key Verification Message.

<code>- -----BEGIN PUBLIC KEY-----</code> versus <code>-----BEGIN PUBLIC KEY-----</code>.

<code>- -----END PUBLIC KEY-----</code> versus <code>- -----END PUBLIC KEY-----</code>.

The extraneous space and dash <code>- </code> was introduced by gpg during Ledger OpenSSL Public Key Verification Message creation of the Ledger developer. To verify that for yourself, create your own gpg signing key, clearsign a file containing <code>-</code> and have a look the the containing gpg clearsigned file. Original, unsigned <code>-</code> becomes <code>- -</code> in clearsigned file.

Another source for the Ledger OpenSSL Public Key:

https://github.com/LedgerHQ/ledger-live-desktop/blame/develop/src/main/updater/ledger-pubkey.js

It is mentioned here:

https://github.com/LedgerHQ/ledger-live-desktop/issues/2877#issuecomment-729835953

==== Download Ledger Live AppImage ====

{{mbox
| image   = [[File:Ambox_notice.png|40px]]
| text    =
These instructions where written for Ledger Live version <code>{{version_ledger_live}}</code>. If another version is used or newer versions are released meanwhile, replace <code>{{version_ledger_live}}</code> with the actual version number being downloaded.

In that case, feel free to suggest an update to [[Template:version_ledger_live]]. (Scammers note: Do not bother attempting to add malicious contents as all wiki edits are moderated by wiki admins before these go live.)
}}

[[Secure_Downloads|Download]] the Ledger Live AppImage.

{{CodeSelect|code=
scurl-download https://github.com/LedgerHQ/ledger-live-desktop/releases/download/v{{version_ledger_live}}/ledger-live-desktop-{{version_ledger_live}}-linux-x86_64.AppImage
}}

==== sha512 Hashes File Download ====
Download the Ledger Live sha512 Hashes file.

https://validate.live.ledger.com/lld-signatures &rarr; <code>ledger-live-desktop-{{version_ledger_live}}.sha512sum</code> &rarr; right click &rarr; Save link as...

==== sha512sum Hashes file Signature Download ====
Download the signature of sha512sum hashes file.

https://validate.live.ledger.com/lld-signatures &rarr; <code>ledger-live-desktop-{{version_ledger_live}}.sha512sum.sig</code> &rarr; right click &rarr; Save link as...

==== Verify sha512 Hashes File Signature ====
Verify the ledger live sha512 Hashes file.

{{CodeSelect|code=
openssl dgst -sha256 -verify ledgerlive.pem -signature ledger-live-desktop-{{version_ledger_live}}.sha512sum.sig ledger-live-desktop-{{version_ledger_live}}.sha512sum
}}

Should show:

<pre>
Verified OK
</pre>

==== Verify Ledger Live ====
Verify Ledger Live by verifying the Ledger Live sha512 hashes file.

{{CodeSelect|code=
sha512sum --check ledger-live-desktop-{{version_ledger_live}}.sha512sum
}}

Should show:

<pre>
ledger-live-desktop-2.21.3-linux-x86_64.AppImage: OK
sha512sum: ledger-live-desktop-2.21.3-mac.dmg: No such file or directory
ledger-live-desktop-2.21.3-mac.dmg: FAILED open or read
sha512sum: ledger-live-desktop-2.21.3-mac.zip: No such file or directory
ledger-live-desktop-2.21.3-mac.zip: FAILED open or read
sha512sum: ledger-live-desktop-2.21.3-win.exe: No such file or directory
ledger-live-desktop-2.21.3-win.exe: FAILED open or read
sha512sum: WARNING: 3 listed files could not be read
</pre>

Alternatively one could run the following command.

{{CodeSelect|code=
sha512sum ledger-live-desktop-{{version_ledger_live}}-linux-x86_64.AppImage
}}

And then compare the actual sha512 hash with the sha512 hash as in Ledger Live sha512 hashes file.

=== Installation ===
This chapter requires that chapter [[#Ledger Live Application Installation|Ledger Live Application Installation]] has already been completed. At minimum, file <code>ledger-live-desktop-{{version_ledger_live}}-linux-x86_64.AppImage</code> needs to have been already downloaded and residing in current working folder.

{{CodeSelect|code=
chmod +x ledger-live-desktop-{{version_ledger_live}}-linux-x86_64.AppImage
}}

= Usage =

{{mbox
| type      = notice
| image   = [[File:Ambox_notice.png|40px|alt=Info]]
| text    = Qubes will not detect ledger before the PIN has been entered. This is probably because ledger does not announce itself before that.
}}

# Physically connect the ledger hardware wallet to a USB port.
# Enter the PIN.
# Start the <code>ledger VM</code>.

== Ledger Live ==
TODO: document

== Electrum ==

An Electrum wallet will only show legacy bitcoin addresses and their balances or segwit wallet bitcoin addresses and their balances, not both. It is possible to have multiple Electrum wallets and switch between them.

Electrum will ask for <code>derivation path</code>.

* The default is <code>m/44'/0'/0'</code> for legacy bitcoin addresses.
* You should use <code>m/49'/0'/0'</code> for segwit bitcoin addresses.

= Troubleshooting =
== Qubes R4 ==

The Qubes R4 USB widget formerly had bugs such as showing the USB device was connected to a VM while <code>qvm-usb</code> -- the command line authority whose judgment should be trusted more -- disagreed or showed the same USB device more than once in the menu. <ref>
[https://github.com/QubesOS/qubes-issues/issues/3266 USB devices shown multiple times in devices popup menu #3266]
</ref>

If similar issues re-emerge, follow these steps.

{{Box|text=
'''1.''' Physically connect the ledger hardware wallet to a USB port. <br />
'''2.''' Run the following command to get an overview of USB devices detected by Qubes.

{{CodeSelect|code=
qvm-usb
}}

'''3.''' Check the output is similar to the following.

<pre>
BACKEND:DEVID  DESCRIPTION               USED BY
sys-usb:2-1.1  Logitech_USB_Keyboard     
sys-usb:2-1.2  PixArt_USB_Optical_Mouse  
sys-usb:2-1.4  Ledger_Nano_S_0001        
</pre>

'''4.''' Use the following command to connect the ledger hardware wallet to the preferred VM. 

Replace <code>ledger-debian-buster</code> with the actual name of the VM.

{{CodeSelect|code=
qvm-usb attach ledger-debian-buster sys-usb:2-1.4
}}
}}

== BIOS ==

The USB device might be passed to the <code>ledger VM</code>, but ledger applications may not recognize the ledger hardware wallet. If that occurs, try the following in BIOS settings:

* disable <code>Legacy USB Support</code>
* disable <code>XHCI Pre-Boot Mode</code>
* attempt flipping other USB-related BIOS options

It is unnecessary to reinstall Qubes.

== Ledger ==

To troubleshoot Ledger problems, try the following:

* attempt to connect to Ledger Manager first
* update the firmware of the Ledger hardware wallet by connecting it to a non-Qubes Linux computer (where connections are possibly using Ledger Manager)

See also: [[Dev/Ledger Hardware Wallet]].

= Donations =
After setting up a hardware wallet, please consider making a [[Donate|donation]] to {{project name}} to keep it running for many years to come.

{{Pay_Bitcoin_Specific}}

{{Pay_Monero_Specific}}

= Footnotes =
{{reflist|close=1}}

{{Footer}}

[[Category:Documentation]]
