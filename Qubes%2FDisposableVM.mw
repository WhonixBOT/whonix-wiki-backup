{{Header}}
{{#seo:
|description=How to use DisposableVM with Qubes-Whonix
|image=https://www.whonix.org/w/images/5/55/Qubes-logo-icon.png
}}

== Advanced Users Only! ==
{{mbox
| image   = [[File:Ambox_warning_pn.svg.png|40px]]
| text       = 
Warning!

A [[#Warnings|few usability issues]] in DisposableVMs affect anonymity. If the risks are unknown to the user, either: carefully read and understand this page, or wait until Qubes R4.0 is released <ref>Significant improvements are planned for DisposableVMs in Qubes R4.0. See: https://github.com/QubesOS/qubes-issues/issues/866#issuecomment-220495485</ref> before using Qubes DisposableVMs for anonymity purposes. <ref>[https://forums.whonix.org/t/advertisement-tracking-real-threat-to-whonix-project/3200/7 At least one user] has reported the [[#Warning: Do not use Firefox from Qubes DisposableVM default start menu|"do not use Firefox from Qubes DisposableVM default start menu"]] issue when attempting to use Tor Browser.
</ref>
}}

__TOC__

----

== What are DisposableVMs? ==
In the Qubes TemplateVM model, <ref>[https://www.qubes-os.org/getting-started AppVMs (qubes) and TemplateVMs]</ref> any changes made to a [https://github.com/QubesOS/qubes-issues/issues/2489 TemplateBasedVM's root filesystem] are lost upon reboot. This is advantageous for several reasons: it saves time and disk space, and allows faster, centralized updates for applications that are usually found inside the root filesystem. However, certain directories are designed to persist between reboots in order to store files and settings. These directories are stored in <i>/rw/</i> and include <i>/home/user</i> as well as additional directories defined by "bind directory" settings. <ref>[https://www.qubes-os.org/doc/bind-dirs/ How to make any file in a TemplateBasedVM persistent using bind-dirs]</ref>

Qubes does not have a built-in snapshot capability like VirtualBox that can completely revert all changes back to a previous VM state. <ref>
Apart from [https://www.qubes-os.org/doc/dom0-tools/qvm-revert-template-changes/ qvm-revert-template-changes] which can only revert to the state existing before the last shutdown of the TemplateVM.
</ref> <ref>
[https://forums.whonix.org/t/qubes-vm-snapshots-using-git-svn Qubes VM snapshots using git / SVN].
</ref> In other words, no method exists within AppVMs to reverse changes made to the persistent file system  without implementing some type of custom solution. To ensure that '''all''' filesystem changes are discarded after a session, Qubes offers DisposableVMs. When a DisposableVM is shutdown, the VM is removed from Qubes and all related VM images are deleted from the host filesystem. This method is [[Qubes/Disposable_VM#Warning:_Disposable_VMs_are_not_amnesic|not yet amnesic]] and should not be relied upon for anti-forensics!

While DisposableVMs ensure that files do not persist without user intervention, the downside is the user can no longer decide whether or not the current VM state should be kept or destroyed. Users must choose beforehand to use a standard AppVM or a DisposableVM; this decision cannot be changed after the fact.

===== The Two-Layered DisposableVM System =====
Qubes currently uses a two-layered approach to DisposableVMs. At the core of the system is a ''TemplateVM'' upon which a ''DisposableVM-Template'' is based. Every time a new DisposableVM is launched, it is based on the ''DisposableVM-Template'' - hence, two layers. In a standard Qubes-Whonix installation:

* The base TemplateVM is <code>whonix-ws</code>. 
* The DisposableVM-Template is called <code>whonix-ws-dvm</code>.
* Each new DisposableVM (<code>disp1, disp2, ...</code>) is based on <code>whonix-ws-dvm</code>. 


Once a DisposableVM-Template is created, its <i>/home/user/</i> directory can be customized <ref>
https://www.qubes-os.org/doc/dispvm-customization/
</ref> independently of the base TemplateVM. In this special case, the DisposableVM-Template will continue to inherit changes from the base TemplateVM's root filesystem (for example, package updates), but user files in <i>/home/user/</i> will persist independently.

===== DisposableVM Traffic is Stream Isolated from Other VMs =====
DisposableVMs work especially well with Whonix-Gateway because each VM is assigned a unique internal IP address. In this way, all traffic from a DisposableVM is [[Stream_Isolation | stream isolated]] from all other traffic arising from VMs running in paralell.

----

== Warnings ==
==== Warning: Do not Use Firefox from Qubes' DisposableVM Default Start Menu ====
{{mbox
| image   = [[File:Ambox_warning_pn.svg.png|40px]]
| text       = 
Do '''not''' expect anonymity when selecting <code>Qubes Start Menu</code> -> <code>DisposableVM</code> -> <code>Firefox</code>! <br /> <br />Using any browser other than Tor Browser is strongly discouraged if anonymity is desired, see [[Tor Browser]]. The default Qubes start menu option is best not used at all, unless the [[#Edit Qubes DisposableVM start menu|menu entry is manually edited]] to launch Tor Browser in place of Firefox. <ref>Instructions are provided later under chapter [[#Setup]].</ref>
}}

==== Warning: Use Caution when Spawning DisposableVMs from Other VMs  ====
{{mbox
| image   = [[File:Ambox_warning_pn.svg.png|40px]]
| text       = 
If a DisposableVM is created from within a VM that is not connected to Whonix-Gateway, the new DisposableVM may route its traffic over clearnet. <ref>DisposableVMs are created in one of two ways: 
* <code>Open in DisposableVM</code>. On the command line (domU): <code>qvm-open-in-dvm</code> 
* <code>Run in DisposableVM</code>. On the command line (domU): <code>qvm-run --dispvm</code></ref> This is because DisposableVMs inherit their NetVMs from the calling VM, or the calling VM's <code>dispvm_netvm</code> setting if different. <br /><br /> The <code>dispvm_netvm</code> setting can be configured per VM via: <br />
<code>dom0</code> -> <code>Qubes VM Manager</code> -> <code>VM Settings</code> -> <code>Advanced</code> -> <code>NetVM for DisposableVM</code> <ref> On the command line (dom0): <code>qvm-prefs -s vmname dispvm_netvm sys-whonix</code> </ref> <br /><br /> If the calling VM is connected to Whonix-Gateway, this step is not necessary and the DisposableVM's traffic will be routed over Tor.
}}

<ref>[https://github.com/QubesOS/qubes-issues/issues/1954 Whonix default NetVM settings fixes]</ref>

==== Warning: DisposableVMs are not Amnesic ====
{{mbox
| image   = [[File:Ambox_warning_pn.svg.png|40px]]
| text       = 
All changes to a DisposableVM's file system are discarded upon shutdown. However, DisposableVMs are similar to snapshots insofar as they can leave traces of their activity on storage and in memory. <u>These traces may be later recoverable through data forensics.</u> This is further justification for using full disk encryption on the Qubes host and completely shutting down the system when it is not in use. Laptop users may wish to remove batteries to ensure that power to the RAM is indeed disconnected.
}}

<ref>[[Warning#Whonix_is_not_amnesic | Whonix is not amnesic.]]</ref> <ref>[[FAQ#Is_there_a_substitute_for_Whonix.27s_lack_of_an_Amnesic_feature_.2F_Live_CD.2FDVD.3F_Forensics.3F | Is there a substitute for Whonix's lack of an Amnesic feature?]]</ref> 
<ref>[https://groups.google.com/d/topic/qubes-devel/QwL5PjqPs-4/discussion DisposableVMs do not run entirely in RAM.]</ref> 
<ref>[https://github.com/QubesOS/qubes-issues/issues/904 DisposableVMs: support for in-RAM execution only (for anti-forensics) #904]</ref>

==== Warning: DisposableVMs may be Linkable to other VMs Connected to the Same Whonix-Gateway ====
{{mbox
| image   = [[File:Ambox_warning_pn.svg.png|40px]]
| text       = 
The Tor Project developer Teor has stated that Tor caches {{Code|DNS, HS descriptors, pre-emptive circuits, etc.}} <ref>https://lists.torproject.org/pipermail/tor-dev/2016-October/011591.html</ref> which may lead to linkability between AppVMs and DisposableVMs sharing the same gateway. The extent to which this is a threat for Whonix users is currently under investigation. <ref>[https://phabricator.whonix.org/T567 Multi GW Documentation.]</ref>
}}

==== Warning: Check the Tor Browser Version ====
{{mbox
| image   = [[File:Ambox_warning_pn.svg.png|40px]]
| text       = 
Keeping Tor Browser updated in a (customized) DisposableVM can be [https://forums.whonix.org/t/using-whonix-workstation-as-a-disposablevm-dispvm/2461/21 difficult] for [https://forums.whonix.org/t/qubes-dispvm-technical-discussion/3232/11 several reasons], but it is necessary. To learn about  recent Tor Browser versions, follow https://blog.torproject.org or look at raw data for the latest [https://www.torproject.org/projects/torbrowser/RecommendedTBBVersions Recommended TBB Versions].
<br />
When using DisposableVMs, use the [[Tor_Browser#Tor_Browser_Internal_Updater|Tor Browser Internal Updater]] daily to check the browser is up to date. Tor Browser's version number can also be checked manually: <code>Tor Browser</code> -> <code>Menu</code> -> <code>? (next to customize)</code> -> <code>About Tor Browser</code>. See [[Qubes/Disposable_VM#Updating_Tor_Browser]] for more information.
}}

----

== Setup ==
{{mbox
| image   = [[File:Ambox_warning_pn.svg.png|40px]]
| text       = 
These instructions are current as of Qubes 3.2. Updated documentation will be required for Qubes 4.0 since it is anticipated it will bring major changes to the DisposableVM implementation.<ref>[https://github.com/QubesOS/qubes-issues/issues/1335 Home folder of template not inherited by DisposableVM #1335]</ref>
}}
<br />
'''Note:''' All examples below reference GUI actions whenever possible. The equivalent command line interface commands are listed in the footnotes.

==== Creating a New DisposableVM-Template Based on Whonix-Workstation ====
<div class="toccolours mw-collapsible mw-collapsed" style="width:800px">
'''Note for advanced users:''' If you wish to install the alpha or sandboxed version of Tor Browser, click on Expand on the right.
<div class="mw-collapsible-content">
'''Option #1: Use a non-customized DisposableVM-Template''' 

This template will use a stock image based on <code>whonix-ws</code> and will not preserve any changes that are made to it.

Step 1: Disable <code>tb-updater</code>'s functionality which automatically updates during apt-get inside the Qubes TemplateVM. <ref>[[Tor_Browser#tb-updater_in_Qubes_TemplateVM]]</ref> 

This prevents the preferred Tor Browser version being overwritten by the stable version.

In whonix-ws terminal, run.

{{CodeSelect|code=
echo "tb_install_follow=false" | sudo tee -a /etc/torbrowser.d/50_user.conf
}}

Step 2: Install the preferred version of Tor Browser to TemplateVM by launching Tor Browser Downloader by Whonix and following the instructions. <ref name=hide_gtk_warnings /> <ref name=noaskstart /> <ref name=cli_noaskstart />

In whonix-ws terminal, run.

{{CodeSelect|code=
noaskstart=true update-torbrowser --input gui >/dev/null 2>&1
}}

Step 3: Create a DisposableVM-Template based on the <code>whonix-ws</code> TemplateVM.

In dom0 terminal, run.

{{CodeSelect|code=
qvm-create-default-dvm whonix-ws
}}

When a new version of Tor Browser is released, repeat the previous two steps to update the TemplateVM and  DisposableVM-Template.

'''Option #2: Use a Customized DisposableVM-Template.''' 

Note: This template can be further customized by following the instructions [[#Customizing a DisposableVM-Template|below]].

Step 1: Delete the existing DisposableVM-Template.

In dom0 terminal, run. 

{{CodeSelect|code=
qvm-remove <oldDisposableVM-Template>
}}

Step 2: Create a new DisposableVM-Template based on the <code>whonix-ws</code> TemplateVM.

In dom0 terminal, run.

{{CodeSelect|code=
qvm-create-default-dvm whonix-ws
}}

Step 3: Configure Whonix-Gateway as the NetVM for the DisposableVM-Template.

In dom0 terminal, run.

{{CodeSelect|code=
qvm-prefs -s whonix-ws-dvm netvm sys-whonix
}}

Step 4: Launch a DisposableVM-Template terminal.

In dom0 terminal, run. 

{{CodeSelect|code=
qvm-run -a whonix-ws-dvm konsole
}}

Step 5: Enable a customized flag in the DisposableVM-Template.

In the DisposableVM-Template terminal, run.

{{CodeSelect|code=
touch /home/user/.qubes-dispvm-customized
}}

Step 6: Use update-torbrowser to download and install the preferred TorBrowserBundle.

In the DisposableVM-Template terminal, run.

{{CodeSelect|code=
noaskstart=true update-torbrowser --input gui >/dev/null 2>&1
}}

Step 7: Shutdown the DisposableVM-Template.

In the DisposableVM-Template terminal, run.

{{CodeSelect|code=
sudo poweroff
}}

Step 8: Regenerate the DisposableVM-Template.

In dom0 terminal, run.

{{CodeSelect|code=
qvm-create-default-dvm whonix-ws
}}

Do not forget to [[Qubes/Disposable_VM#Warning:_Check_your_Tor_Browser_Version|check your Tor Browser version]]!

----
</div>
</div>

'''Create and Configure a DisposableVM-Template'''

Open a dom0 terminal.

<code>
Qubes App Launcher (blue/grey "Q") -> System Tools -> Konsole or Xfce Terminal
</code>

Create a DisposableVM-Template.

<code>
qvm-create-default-dvm whonix-ws
</code>

Enable showing your DisposableVM-Template in Qubes VM Manager (QVMM).

<code>
dom0 -> Qubes VM Manager -> (menu) View -> enable 'Show/Hide internal VMs'
</code>

<code>
dom0 -> Qubes VM Manager -> enable 'Show/Hide inactive VMs'
</code>

Configure Whonix-Gateway as your NetVM.<ref>cli:dom0: <code>qvm-prefs -s whonix-ws-dvm netvm sys-whonix</code></ref>

<code>
dom0 -> Qubes VM Manager -> right click on 'whonix-ws-dvm' -> VM Settings -> NetVM -> sys-whonix 
</code>

If you intend to spawn DisposableVMs from other VMs, configure your NetVM for DisposableVM setting, see [[Qubes/Disposable_VM#Warning:_Use_caution_when_spawning_DisposableVMs_from_other_VMs|Warning: Use caution when spawning DisposableVMs from other VMs]].

Your DisposableVM is now ready for use and is configured with all of the applications present in your Whonix-Workstation template, including Tor Browser.

Also follow the next step [[#Edit Qubes DisposableVM start menu]] to make sure you will not be accidentally starting Firefox which is discouraged!

===== Edit Qubes DisposableVM start menu  =====
Do the following to work around [[#Warning: Do not use Firefox from Qubes DisposableVM default start menu]].

In Qubes dom0.

<code>alt + F3 -> on the left side, click DisposableVM -> right click on 'Firefox' -> edit -> </code>

* Name: <code>DisposableVM: Tor Browser</code>
* Command: <code>sh -c 'echo torbrowser | /usr/lib/qubes/qfile-daemon-dvm qubes.VMShell dom0 DEFAULT red'</code>

<code>click 'Save'</code>

While you are at it, you might want to also edit the xterm entry and change to konsole, however that is not important for security, that is just an optional matter of taste.

==== Deleting a DisposableVM-Template ====
Deleting a DisposableVM-Template is not usually necessary, since only one DisposableVM-Template is allowed (up to Qubes 3.2). Creating a new DisposableVM-Template will overwrite the existing one. However, if you've customized the template, you may need to delete the existing one to start with a fresh unmodified DisposableVM-Template.

A DisposableVM-Template can be deleted in the same manner as other VMs:

<code>
dom0 -> Qubes VM Manager -> right click on 'whonix-ws-dvm' -> click 'Remove VM'
</code>
<ref>cli:dom0: <code>qvm-remove <vmname></code></ref>

==== Customizing a DisposableVM-Template ====
Extra caution must be exercised when customizing a DisposableVM-Template. <ref>Qubes documentation: [https://www.qubes-os.org/doc/dispvm-customization DisposableVM Customization]</ref> From a privacy perspective, one would ideally want to have a DisposableVM-Template that is indistinguishable from any other Whonix-Workstation. If changes are made to the DisposableVM-Template, such as the installation of obscure programs or the setting of unique configurations or the placement of unique data files, those may serve to link all of your DisposableVMs via a unique fingerprint should they be compromised independently. It is also good to remember that your DisposableVM will likely be exposed to your greatest threats.

Tor Browser specifically is largely designed to be used in its stock configuration in order to preserve as big an anonymity (fingerprint) set as possible. Many changes can result in the alteration of its fingerprint so it is advisable to only change what you are knowledgeable about. Some changes, like disabling JavaScript by default, may make sense to you in terms of trade-offs. Additionally, minor cosmetic changes, like the UI layout, or the placement of buttons, may be considered harmless to your privacy while enhancing your own personal usability.

Please remember that only files in <code>/home/user/</code> can be customized in a DisposableVM-Template.<ref>[https://github.com/QubesOS/qubes-issues/issues/1335 home folder of template not inherited by DisposableVM #1335]</ref>

As stated previously, the following steps to customize the DisposableVM are completely optional.

'''Tell Qubes to preserve your custom changes.'''

Open a terminal in the DisposableVM-Template.<ref>cli:dom0: <code>qvm-run -a whonix-ws-dvm konsole</code></ref>

<code>
dom0 -> Qubes VM Manager -> right click on 'whonix-ws-dvm' -> click 'Run command in VM' -> type 'konsole'
</code>

<code>
touch /home/user/.qubes-dispvm-customized
</code>

'''Launch the application you would like to customize.'''<ref>cli:dom0: <code>qvm-run -a whonix-ws-dvm <name of application></code></ref>

<code>
dom0 -> Qubes VM Manager -> right click on 'whonix-ws-dvm' -> click 'Run command in VM'
</code>

Enter the name of the application. For example, <code>torbrowser, libreoffice, konsole, dolphin, okular, kgpg, etc</code>

'''Finalize the DisposableVM-Template'''

Once you are satisfied with your changes, shutdown the DisposableVM-Template.<ref>cli:dom0: <code>qvm-shutdown <vmname></code></ref>

<code>
dom0 -> Qubes VM Manager -> right click on 'whonix-ws-dvm' -> click 'Shutdown VM'
</code>

Regenerate the DisposableVM-Template.

Open a dom0 terminal.

<code>
Qubes App Launcher (blue/grey "Q") -> System Tools -> Konsole or Xfce Terminal
</code>

<code>
qvm-create-default-dvm whonix-ws
</code>

All of your changes to <code>/home/user/</code> in the DisposableVM-Template should now persist whenever you re-create the template.

==== Updating a DisposableVM-Template ====
Changes to the underlying TemplateVM (whonix-ws) are detected automatically and the DisposableVM-Template is updated without user intervention. That means package updates that are applied to whonix-ws are also applied to the whonix-ws-dvm.

===== Updating Tor Browser =====
Tor Browser presents a special situation because of the fact that it is installed in a user's home directory. As a result, the TemplateVM (whonix-ws) never updates existing Tor Browser installations.

'''For ''non-customized'' DisposableVM-Templates''': The simplest method to obtain the latest Tor Browser is to use Whonix's built-in Tor Browser downloader functionality. Simply update [[Tor_Browser#Tor_Browser_Downloader_by_Whonix|Tor Browser Downloader by Whonix (tb-updater)]] in whonix-ws while performing your usual maintenance [https://www.qubes-os.org/doc/whonix/update/ upgrading] via <code>sudo apt-get update</code> and <code>sudo apt-get dist-upgrade</code>.

Then, create a new DisposableVM to overwrite the existing one.

Open a dom0 terminal.

<code>
Qubes App Launcher (blue/grey "Q") -> System Tools -> Konsole or Xfce Terminal
</code>

Create a new DisposableVM-Template using the updated whonix-ws TemplateVM.

<code>
qvm-create-default-dvm whonix-ws
</code>

'''For ''customized'' DisposableVM-Templates''': Users may choose to use [[Tor_Browser#Tor_Browser_Downloader_by_Whonix|Tor Browser Downloader by Whonix (tb-updater)]] ({{Code2|update-torbrowser}}) or to use [[Tor_Browser#Tor_Browser_Internal_Updater|Tor Browser's internal updater]].

'''''Option #1:''' Use ({{Code2|update-torbrowser}}) and download a new copy of Tor Browser''

<code>
dom0 -> Qubes VM Manager -> right click on 'whonix-ws-dvm' -> click 'Run command in VM' -> type 'konsole'
</code><ref>cli:dom0: <code>qvm-run -a whonix-ws-dvm konsole</code></ref>

Launch Tor Browser Downloader by Whonix and follow the instructions. <ref name=hide_gtk_warnings>
Using <code>>/dev/null 2>&1</code> to hide some useless and confusing GTK warnings.
</ref> <ref name=noaskstart>
Using <code>noaskstart="true"</code> to prevent [[Tor_Browser#Running_Tor_Browser_in_Qubes_TemplateVM]].
</ref> <ref name=cli_noaskstart>
Or for CLI version, simply use.
<br />
<code>noaskstart="true" update-torbrowser</code>
</ref>

<code>
noaskstart=true update-torbrowser --input gui >/dev/null 2>&1
</code>

Shutdown the DisposableVM-Template<ref>
cli:dom0: <code>qvm-shutdown whonix-ws-dvm</code><br />
or<br />
DisposableVM-Template cli:domU: <code>sudo poweroff</code>
</ref>

<code>
dom0 -> Qubes VM Manager -> right click on 'whonix-ws-dvm' -> click 'Shutdown VM'
</code>

Regenerate the DisposableVM-Template.

Open a dom0 terminal.

<code>
Qubes App Launcher (blue/grey "Q") -> System Tools -> Konsole or Xfce Terminal
</code>

<code>
qvm-create-default-dvm whonix-ws
</code>

'''''Option #2:''' Use Tor Browser's internal updater and download new updates only''

<code>
dom0 -> Qubes VM Manager -> right click on 'whonix-ws-dvm' -> click 'Run command in VM' -> type 'torbrowser'</code><ref>cli:dom0: <code>qvm-run -a whonix-ws-dvm torbrowser</code></ref>

Use Tor Browser's Internal Updater by clicking TorButton and selecting <code>Check for Tor Browser Update</code>. Close and restart Tor Browser.

Shutdown the DisposableVM-Template<ref>cli:dom0: <code>qvm-shutdown whonix-ws-dvm</code></ref>

<code>
dom0 -> Qubes VM Manager -> right click on 'whonix-ws-dvm' -> click 'Shutdown VM'
</code>

Regenerate the DisposableVM-Template.

Open a dom0 terminal.

<code>
Qubes App Launcher (blue/grey "Q") -> System Tools -> Konsole or Xfce Terminal
</code>

<code>
qvm-create-default-dvm whonix-ws
</code>

----

== Usage ==
DisposableVMs lend themselves well to being used for risky, largely independent activities, like web browsing or opening untrusted files; while AppVMs might be better suited when file persistence is necessary (for example: an email client with local email storage). Qubes' VM integration tools, like secure file copy<ref>Qubes documentation: [https://www.qubes-os.org/doc/copying-files/ Copying and Moving Files Between Domains]</ref> and secure clipboard<ref>Qubes documentation: [https://www.qubes-os.org/doc/copy-paste Copying and Pasting Text Between Domains]</ref>, mean that clean, trusted files and text can be easily transferred to your trusted VMs should it be necessary and safe.

==== Tips ====
* Remember that a DisposableVM is shutdown when the '''first''' user-launched process is terminated. If you create a new DisposableVM by launching Tor Browser and then proceed to compose text in an editor, all of your work will be lost if you close Tor Browser. To avoid this, you may want to launch a DisposableVM via a terminal and launch additional applications from the command line. When you are ready to destroy the DisposableVM, you can simply exit from the terminal.

* In Qubes, it is never a good idea to store valuable information in an untrusted VM. This is further enforced by the fact that Tor Browser doesn't remember bookmarks or credentials. A best practice for storing this type of information is to use a password manager in an offline vault VM. @rustybird has announced a new "split-tor-browser"<ref>[https://github.com/rustybird/qubes-split-browser Github: Split Browser]</ref> package that can retrieve urls and credentials from a trusted VM for use in a DisposableVM's web browser. (This package has not yet been tested or endorsed by Whonix.)

* Sometimes it is useful to have a non-networked DisposableVM for opening untrusted files that may try to use the network maliciously. Like all Qubes VMs, the NetVM for a DisposableVM can be changed dynamically while the VM is running. Simply set the NetVM to 'none' using the Qubes VM Manager or the CLI.<ref>cli:dom0: <code>qvm-prefs -s disp<1 | 2 | ...> netvm none</code></ref> '''Warning:''' If you decide to re-establish network connectivity, use utmost caution in doing so, since there is no mechanism in place to prevent you from connecting to a clearnet NetVM.

* DisposableVMs can be created directly by launching programs from the application menu using shortcuts. ([[#Adding_shortcuts_to_application_menus.5B28.5D | See below for instructions.]]) They can also be spawned by using context-menus or CLI commands in other AppVMs. See [https://www.qubes-os.org/doc/dispvm/ Qubes dispVM documentation] for different methods. Once again, be sure to heed the [[#Warning:_Use_caution_when_spawning_DisposableVMs_from_other_VMs_.5B3.5D | relevant warning]] in the Warnings section..

----
==== Adding a Desktop Shortcut ====
===== Qubes 3.2 / XFCE4 =====
To create a desktop shortcut that starts Tor Browser inside a DisposableVM, you could do the following.

<code>
Right click anywhere on the free space of the desktop. -> Create Launcher
</code>

* Name: <code>DispTB</code>
* Command: <code>sh -c 'echo torbrowser | /usr/lib/qubes/qfile-daemon-dvm qubes.VMShell dom0 DEFAULT red'</code>

<code>
Click Create
</code>

Double click the newly created desktop shortcut to start it.

At first start, you can safely click "Mark Executable".

You might like using XFCE workspace switcher to switch to another empty virtual desktop so you do not have to minimize existing windows in order to see the desktop shortcuts.

----

==== Start Tor Browser in a DisposableVM ====
For example use a shortcut above (or use some other way to start it). Then remember to [[Qubes/Disposable_VM#Warning:_Check_your_Tor_Browser_Version|check your Tor Browser version]]!

----
==== Adding Shortcuts to Application Menus ====
<ref>Qubes feature request WIP: [https://github.com/QubesOS/qubes-issues/issues/1339 have DisposableVMs inherit launcher shortcuts like other TemplateBasedVMs #1339]</ref>
===== Qubes 3.2 / XFCE4 (untested) =====

Make a <code>.desktop</code> file for every DisposableVM shortcut you would like to add to your menus.<ref>Official documentation: [https://specifications.freedesktop.org/desktop-entry-spec/desktop-entry-spec-latest.html Desktop entry specifications]</ref> These .desktop files must be placed in <code>~/.local/share/applications/</code>.

Open a terminal in your DisposableVM-Template.

<code>
dom0 -> Qubes VM Manager -> right click on 'whonix-ws-dvm' -> click 'Run command in VM' -> type 'konsole'
</code><ref>cli:dom0: <code>qvm-run -a whonix-ws-dvm konsole</code></ref>

{{CodeSelect|code=
mkdir -p ~/.local/share/applications/
}}

Use your favorite text editor to create and open each .desktop file. Name each one as you prefer.

{{CodeSelect|code=
kwrite ~/.local/share/applications/dvm-torbrowser.desktop
}}

Add to the .desktop file the following entries and substitute fields as appropriate. In the Exec field, substitute <code>torbrowser</code> with the CLI command used to launch each application you would like a shortcut for. Examples: <code>konsole, kwrite, libreoffice, kgpg, okular, dolphin</code>

<!-- EDITORS NOTE: '{{!}}' is a magic word for '|'.-->
{{CodeSelect|code=
[Desktop Entry]
Name=Tor Browser
Comment=Launch Tor Browser in DisposableVM
Type=Application
Terminal=false
Exec=sh -c 'echo torbrowser {{!}} /usr/lib/qubes/qfile-daemon-dvm qubes.VMShell dom0 DEFAULT red'
}}

Icon= & Category= are also useful fields. Feel free to research the .desktop specification using the footnote above.

Once the .desktop files have been created, they need to be added to your Applications menu. Use a text editor to edit the following file.

{{CodeSelect|code=
kwrite ~/.config/menus/xfce-applications.menu
}}

Find the menu entry associated with your DisposableVM-Template. (Help!)

{{CodeSelect|code=
<Menu>
    <Name>DisposableVMTemplate</Name>
}}

In the <Include> subsection add the appropriately named .desktop file.

{{CodeSelect|code=
<Filename>dvm-torbrowser.desktop</Filename>
}}

===== Qubes 3.2 / XFCE4: MenuLibre (untested) =====

<div class="toccolours mw-collapsible mw-collapsed" style="width:800px">
Currently not recommended unless you want to experiment and know how to fix the application menu in case it breaks. Click on expland on the right if you are interested.
<div class="mw-collapsible-content">
menulibre removes Qubes System Tools start menu entry

https://groups.google.com/forum/m/#!msg/qubes-users/rxI8lNOD7p0/p9Va5Vg9BwAJ

adrelanos: I was using git to manage my whole home folder so I was able to:

* undo any changes menulibre is doing
* remove any newly created files by menulibre

so I could restore my Qubes System Tools start menu entry.

<code>
sudo qubes-dom0-update menulibre
</code>

<code>
Qubes Start Menu -> System Tools -> Menu Editor
</code>
</div>
</div>

===== Qubes 3.1 / KDE4 =====
<code>
dom0 -> right-click Application Launcher Menu -> click `Edit Applications`
</code>

Select DisposableVM from VM entries on the left panel. Press the arrow button to expand the menu.
    
Click New Item on the Toolbar.
    
Type in a Name for the shortcut.
    
Type in the Command to launch the program in the DisposableVM.

    Examples:
    Tor Browser
    sh -c 'echo torbrowser | /usr/lib/qubes/qfile-daemon-dvm qubes.VMShell dom0 DEFAULT red'
    Konsole
    sh -c 'echo konsole | /usr/lib/qubes/qfile-daemon-dvm qubes.VMShell dom0 DEFAULT red'
    Dolphin
    sh -c 'echo dolphin | /usr/lib/qubes/qfile-daemon-dvm qubes.VMShell dom0 DEFAULT red'

Click on the square in the upper right if you'd like to choose an icon. (Custom application icons are stored in /var/lib/qubes/<type of vm>/<vm name>/apps.icons/)
    
Click Save.

----

==== cli ====
If you want for example to open konsole or Tor Browser in a DisposableVM.

Open a dom0 terminal.

<code>
echo konsole | /usr/lib/qubes/qfile-daemon-dvm qubes.VMShell dom0 DEFAULT red
</code>

<code>
echo torbrowser | /usr/lib/qubes/qfile-daemon-dvm qubes.VMShell dom0 DEFAULT red
</code>

----

== Footnotes ==
<references />

{{Footer}}
[[Category:Documentation]]
