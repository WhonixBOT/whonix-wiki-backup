{{Header}}
{{#seo:
|description=Design Documentation about Redistribution of Whonix
}}

== Introduction ==
Developers only!

These are notes for producing official [[Download|downloadable]] binary Whonix images.

== Pre Building ==
{{Box|text=
'''Only required if you want to redistribute (official) Whonix builds.'''

{{Box|text=
* check if https://github.com/Whonix/whonix-base-files/blob/master/etc/whonix_version needs update
* [[Dev/Maintenance]]

Clean source code

* <ref>
get rid of .directory files inside the source code:

<code>dolphin</code> -> <code>preferences</code> -> <code>general</code> -> <code>behavior</code> -> <code>use common view properties for all folders</code>

</ref>
* <ref>
Get rid of <code>~backup</code> files. In other words, get rid of files starting with <code>~</code>.

{{CodeSelect|code=
find ./ -name '*~' {{!}} xargs trash-put
}}
</ref>
* You can get a list of unwanted files with <code>git clean -dfxn</code> and remove them with <code>Code|git clean -dfx</code>.

* Update Whonix debian package repository.

* add your own <code>default-key</code> to your own <code>/home/user/.gnupg/gpg.conf</code>.

* Check that all packages point to a signed git commit and signed git tag.

{{CodeSelect|code=
~/Whonix/packages/whonix-developer-meta-files/debug-steps/packaging-helper-script pkg_verify_signed_commit_and_tag
}}

* push the source code to github

{{CodeSelect|code=
git push origin master
}}

* Check, that the current git commit is a signed. <ref>
You might wish using a <code>git</code> or <code>bash</code> alias to safe typing.
</ref>

{{CodeSelect|code=
git log --show-signature HEAD^..HEAD
}}

Or use the generic makefile as a shortcut.

{{CodeSelect|code=
make git-commit-verify
}}

* Create an OpenPGP signed git tag. This will also be used as Whonix version number.

{{CodeSelect|code=
git tag -s version
}}

* Make sure the current git head is a signed git commit and signed git tag.

To simplify this, you could use the generic makefile.

{{CodeSelect|code=
make git-verify
}}

* Push the OpenPGP signed git tag to github.

{{CodeSelect|code=
git push origin version
}}

* Enable Whonix stable repository by default.

{{CodeSelect|code=
export WHONIX_APT_REPOSITORY_OPTS='--enable --repository stable'
}}

* And use <code>sudo -E</code> so above environment is kept.
}}
}}

== Building ==
To enable Whonix repository by default, set <code>WHONIX_APT_REPOSITORY_OPTS</code> environment variable.

{{CodeSelect|code=
export WHONIX_APT_REPOSITORY_OPTS='--enable --repository stable'
}}

Using <code>sudo -E</code> to preserve environment variables (<code>WHONIX_APT_REPOSITORY_OPTS</code>).

Build Whonix-Gateway. For example Whonix-Gateway with XFCE for VirtualBox.

{{CodeSelect|code=
sudo -E ./whonix_build --build --target virtualbox --flavor whonix-gateway-xfce
}}

Build Whonix-Workstation. For example Whonix-Workstation with XFCE for VirtualBox.

{{CodeSelect|code=
sudo -E ./whonix_build --build --target virtualbox --flavor whonix-workstation-xfce
}}

For other options and platforms also see [[Dev/Build_Documentation|build documentation]].

== Post Building ==
{{Box|text=
'''Only required if you want to redistribute (official) Whonix builds.'''

{{Box|text=
* [[Dev/APT Repository]]
}}
}}

{{Box|text=
'''Image Signing'''

* '''A)''' <u>own</u> custom builds: '''Optionally''' sign the images.
* '''B)''' <u>official</u> Whonix builds: '''Mandatory''' sign the images.

{{Box|text=
* OpenPGP sign the images.

{{CodeSelect|code=
~/Whonix/packages/whonix-developer-meta-files/release/prepare_release --flavor whonix-gateway --target virtualbox --build
}}

{{CodeSelect|code=
~/Whonix/packages/whonix-developer-meta-files/release/prepare_release --flavor whonix-workstation --target virtualbox --build
}}

{{CodeSelect|code=
~/Whonix/packages/whonix-developer-meta-files/release/prepare_release --flavor whonix-custom-workstation --target virtualbox --build
}}
}}
}}

{{Box|text=
{{Box|text=
'''Only required if you want to redistribute (official) Whonix builds.'''
}}
* Upload the images.

{{CodeSelect|code=
~/Whonix/packages/whonix-developer-meta-files/release/upload_images
}}
}}

=== Testing ===
* {{CodeSelect|code=
/usr/share/whonix-ws-firewall/unit_tests/stream_isolation_test
}}
* At least a few testers should test final releases before posting a news. Testers may be found by posting a news.
* [[LeakTests]]!
* [[Test]] the images before final release! (Testers-only releases can be uploaded straight away.)

=== Wiki Page Updates ===
{{Box|text=
'''Only required if you want to redistribute (official) Whonix builds.'''

{{Box|text=
* Check, if [[Manually Downloading Tor Browser]] is still up to date. (If not, fixing is task of coders, not release manager.)
* Update [[Download#Download_Whonix|Download Table]].
* See if the download table works in a fresh browser. (Check for caching issues.)
* Update [[Known Issues]].
* See if [[Documentation]] still makes sense.
* Search the wiki for [[Special:WhatLinksHere/Template:Stable]] and [[Special:WhatLinksHere/Template:Testing]] and act accordingly. (Can also be done by coders, not release manager.)
* Update links on the [[Dev/Build Documentation]] page.
* Update [[Features]].
* Update [[Template:Version]] (or [[Template:VersionNew]]).
* Update [[Template:VersionShort]].
* Incorporate new documentation which has been prepared on the page: [[Next]].
* [[Template:Stable_Whonix_based_on_Debian_codename]]
* [[Template:Debian_Codename_Stable]]
* [[Template:Debian_Codename_Testing]]
}}
}}

=== Misc ===
{{Box|text=
'''Only required if you want to redistribute (official) Whonix builds.'''

{{Box|text=
* See https://github.com/Whonix?utf8=%E2%9C%93&q=deprecated&type=&language= for deprecated repositories to be deleted.
* https://www.qubes-os.org/doc/supported-versions/#templatevms
* ask for an announcement on https://www.qubes-os.org/news/
** (similar to https://www.qubes-os.org/news/2018/08/07/whonix-14-has-been-released/)
** (similar to https://github.com/QubesOS/qubes-posts/blob/master/2018-08-07-whonix-14-has-been-released.md)
** (similar to https://github.com/QubesOS/qubes-issues/issues/4193)
}}

=== Announcement ===
{{Box|text=
'''Only required if you want to redistribute (official) Whonix builds.'''

{{Box|text=
==== Contents ====
* introduction (what is Whonix) (The release announcement may be the first thing that new people who learn about Whonix see.)
* similar to https://forums.whonix.org/t/whonix-14-has-been-released
* deprecation notice of old Whonix version with date of deprecation

==== Where ====
* Finally announce: Post a news. (Not nagging external lists. Common sense. Mostly only final releases.)


** In Whonix Important and Feature Blog.


** http://lists.debian.org/debian-derivatives/
*** debian-derivatives@lists.debian.org

** https://lists.torproject.org/pipermail/tor-talk/
*** tor-talk@lists.torproject.org

** https://whonix.org/cgi-bin/mailman/listinfo/whonix-devel
*** whonix-devel@whonix.org

** https://nmap.org/mailman/listinfo/fulldisclosure
*** 	fulldisclosure@seclists.org

** https://mailman.stanford.edu/mailman/listinfo/liberationtech
*** liberationtech@lists.stanford.edu

** Also this will do the job as well: 
*** [[Official_Whonix_Online_Profiles#Whonix_Forums_Profiles|Whonix Forums Profiles]]
}}
}}

= Footnotes =
{{reflist|close=1}}

{{Footer}}

[[Category:Development]] [[Category:Design]]
