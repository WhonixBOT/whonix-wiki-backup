{{Header}}
{{#seo:
|description=Troubleshooting Installation and Network Issues with Whonix
}}

= Installation and Network Issues =
== Introduction ==
This introduction is a summary of the basic troubleshooting instructions. It will be described below in greater details. This basically boils down to:

# If you haven't already done, verify the Whonix virtual machine images.
# Make sure you have imported the Virtual Machines into a supported virtualizer.
# Check if the [https://www.torproject.org/download/download-easy.html.en Tor Browser Bundle] works for you on the host.
# Check if other virtual machines, ones you created yourself or from a different vendor have working internet.

Include all these information in a support request or bug report.

== Before you start ==
[[Verify_the_Whonix_images|Verify the Whonix virtual machine images]].

== On the host ==
=== General ===
Always test first, if your host internet connection is working. (ping 8.8.8.8, ping google.com, etc). On your host:

{{CodeSelect|code=
ping google.com
}}

Check time.

{{CodeSelect|code=
date
}}

{{Code2|sudo dpkg-reconfigure -a}} must not show any errors. Will take a while...

{{CodeSelect|code=
sudo dpkg-reconfigure -a
}}

{{Code2|sudo dpkg --configure -a}} must be silent, i.e. not show any errors, must show output at all. Will take a while...

{{CodeSelect|code=
sudo dpkg --configure -a
}}

Get all updates:

{{CodeSelect|code=
sudo apt-get update
}}
{{CodeSelect|code=
sudo apt-get dist-upgrade
}}

Get the Tor Browser Bundle from [https://www.torproject.org/download/download-easy.html.en torproject.org] and test if it's working.

<pre>
## If you can not get the Tor Browser Bundle to work,
## you will most certainly not get Whonix to work either.
##
## In the Whonix Documentation it is recommended to have a current
## copy of the Tor Browser Bundle at all times.
##
## The Tor Browser Bundle is great for testing if you live in a
## censored area or not, if Tor is blocked by your ISP or not.
## When you need (private) (obfuscated) bridges for the Tor Browser Bundle,
## you will need them for Whonix as well.
</pre>

=== No network inside Whonix? ===
# Please install some operating system in one of your own virtual machine or download a regular image without Tor enforcement elsewhere.
# Try if networking is functional in the freshly downloaded non-Whonix virtual machine.
# If it's not working: then Whonix won't work either. You need to sort that out first. Try re-installing your virtualizer. Reboot. Try again.
# If it's working: add this to your support request or bug report, that networking in other non-Whonix VMs is working.

== On the Gateway ==
=== As user {{Code2|user}} ===
Login as user {{Code2|user}}.

{{CodeSelect|code=
sudo su user
}}

Check your <code>route</code> command, make sure the network 10.152.128.0 is associated with eth1.

{{CodeSelect|code=
route
}}

Check if Tor is running with 'pgrep tor -l', this should return something like "103 tor". If not try 'sudo service tor start' and check for any errors.

{{CodeSelect|code=
pgrep tor -l
}}

Check the status of Tor.

{{CodeSelect|code=
sudo service tor status | less
}}

Should reply with.

<pre>
tor is running.
</pre>

Restart Tor.

{{CodeSelect|code=
sudo service tor restart | less
}}

Tor should show only notices, no errors.

Verify Tor configuration is valid:

{{CodeSelect|code=
sudo tor --verify-config | less
}}

You should see confirmation:

<pre>
Configuration was valid
</pre>

Ping the Whonix-Workstation.

{{CodeSelect|code=
ping 10.152.152.11 
}}

Should show {{Code2|Packet filtered}}.

nslookup should NOT work.

{{CodeSelect|code=
nslookup google.com
}}

Should show timeout.

=== As user {{Code2|clearnet}} ===
'''The following test might reveal, that you are a Whonix user. Omit them, if that is of concern for you.'''

Try if a non-torified, non-anonyomus, direct connection to check.torproject.org is possible. <ref>
Only uses TCP, no DNS.
</ref>

{{CodeSelect|code=
sudo -u clearnet {{Curl Plain}} {{Curl Secure}} -H 'Host: check.torproject.org' -k https://{{Check.torproject.org IP}} | grep IP
}}

== Tests on both Virtual Machines ==
Run the following tests on Whonix-Gateway and on Whonix-Workstation.

Login as user {{Code2|user}}.

{{CodeSelect|code=
sudo su user
}}

Check time.

{{CodeSelect|code=
date
}}

{{Code2|sudo dpkg-reconfigure -a}} must not show any errors. Will take a while...

{{CodeSelect|code=
sudo dpkg-reconfigure -a
}}

{{Code2|sudo dpkg --configure -a}} must be silent, i.e. not show any errors, must show output at all. Will take a while...

{{CodeSelect|code=
sudo dpkg --configure -a
}}

Test update-grub.

{{CodeSelect|code=
sudo update-grub
}}

Run 'locale'. Must not report any error.

{{CodeSelect|code=
locale
}}
{{CodeSelect|code=
sudo locale
}}

Restart networking:

{{CodeSelect|code=
sudo service networking restart | less
}}

Apt-get must be fully functional.

{{CodeSelect|code=
sudo apt-get update
}}
{{CodeSelect|code=
sudo apt-get dist-upgrade
}}

Test whonixcheck.

{{CodeSelect|code=
whonixcheck
}}

Test whonixcheck with debugging.

{{CodeSelect|code=
whonixcheck --verbose
}}

Check the timezone.

{{CodeSelect|code=
cat /etc/timezone
}}

Must be {{Code2|Etc/UTC}}.

= Clock Fix =
On the host.

Make sure your host clock is set to the correct time.

Find out the time in UTC. For example, run the following command on the host. (In Qubes terms: in dom0)

<pre>
date -u
</pre>

Should how something like the following.

<pre>
Mon Mar 14 17:48:38 UTC 2016
</pre>

In Whonix-Gateway.

Set the correct time in Whonix-Gateway. (You still need to adjust it.)

<pre>
sudo date --set "Mon Mar 14 17:48:38 UTC 2016"
</pre>

Tor should work now. You can test that using [[whonixcheck]].

Restart sdwdate.

<pre>
sudo service sdwdate restart
</pre>

If Tor does not work yet, try restarting Tor.

<pre>
sudo service tor restart
</pre>

<references />

= Qubes specific =
== Connectivity Issue ==
Shut down sys-whonix. Set sys-whonix NetVM setting from sys-firewall to sys-net. Restart sys-whonix. Perhaps that helps. This should not be considered a final solution. Contribute to the Qubes bug report: https://github.com/QubesOS/qubes-issues/issues/2141 

https://github.com/QubesOS/qubes-issues/issues/2141

{{Footer}}

[[Category:Documentation]]
