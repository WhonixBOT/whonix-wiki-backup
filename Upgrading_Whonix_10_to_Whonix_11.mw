{{Header}}
{{#seo:
|description=How to Upgrade from Whonix 10.x to Whonix 11.x
}}

{{mbox
| type      = critical
| image   = [[File:Ambox_warning_pn.svg.png|40px|alt=Whonix first time users warning]]
| text       = Unfinished! Repository not yet ready! Instructions not yet tested! Work in progress.
}}

= Before you start =
== If you want to upgrade Whonix-Gateway as well as Whonix-Workstation ==
1. Backup your data. (Ideally have a copy of your VM, so you can try again.) <br />
2. Consider running the optional [[#Sanity Tests]]. <br />
3. Upgrade Whonix-Workstation. <br />
4. Power off Whonix-Workstation. <br />
5. Upgrade Whonix-Gatway. <br />
6. Restart Whonix-Gateway. <br />
7. Restart Whonix-Workstation <br />

== If you only want to upgrade Whonix-Workstation ==
1. Backup your data. (Ideally have a copy of your VM, so you can try again.) <br />
2. Consider running the optional [[#Sanity Tests]]. <br />
3. Upgrade Whonix-Workstation. <br />
4. Power off Whonix-Workstation. <br />
5. [[Download|Get]] Whonix-Gatway 9.x. <br />
6. Start Whonix-Gateway. <br />
7. Start Whonix-Workstation <br />

You can ignore the following errors.

== Non-Critical Errors / Warnings ==
TODO: fill out

<pre>
[Jun 09 15:39:42] WARNING torsocks[18737]
</pre>

Other warnings / errors should be reported.

= Sanity Tests =
<pre>
sudo dpkg --audit ; echo $?
</pre>

Expected output.

<pre>
0
</pre>

<pre>
sudo dpkg --configure -a ; echo $?
</pre>

Expected output:

<pre>
0
</pre>

<pre>
sudo apt-get update
</pre>

<pre>
sudo apt-get dist-upgrade
</pre>

Test wise install python-qt4.

<pre>
sudo apt-get install python-qt4 ; echo $?
</pre>

<pre>
## ... successful installation of python-qt4 ...
0
</pre>

= Known Issues =
TODO: any?

Should only happen after first boot after upgrading. If this errors persists for you, please post in [https://www.whonix.org/forum/index.php/board,1.0.html Whonix support forums].

= Upgrading Whonix-Workstation =
'''[[Download|Downloading]] a new Whonix-Workstation will be probably easier than applying the following instructions for upgrading.'''

Consider doing the [[#Sanity Tests]] described above. They'll check if your system is affected by obvious grave issues, that you must fix before attempting to upgrade. If your package manager is broken, for example because you mixed packages from Debian stable with packages from Debian testing, then the upgrade may fail in the middle leaving your system in a difficult to resolve situation.

Consider keeping the full terminal (Konsole) log. Even if everything apparently worked, there might be issues after reboot. In case of a bug report in the forums you would be asked to share the upgrading log so the issue can be investigated.

Make sure you read [[#Known Issues]] above.

Become root.

Do a usual [[Security_Guide#Updates|upgrade]] of your system's packages from Debian.

<pre>
sudo su
</pre>

Enable Whonix's {{Code2|jessie}} repository.

<pre>
## Not yet. Soon.
whonix_repository --enable --codename jessie

## During testing.
whonix_repository --enable --codename developers
</pre>

Switch Debian sources from {{Code2|wheezy}} to {{Code2|jessie}}.

<pre>
sed -i "s/wheezy/jessie/g" /etc/apt/sources.list.d/debian.list
</pre>

Switch Torproject sources from {{Code2|wheezy}} to {{Code2|jessie}}.

<pre>
sed -i "s/wheezy/jessie/g" /etc/apt/sources.list.d/torproject.list
</pre>

Enable extensive debugging so reporting eventual bugs becomes easier.

<pre>
export DEBDEBUG=1
</pre>

Set environment variable TORSOCKS_LOG_LEVEL=1 to reduce unnecessary torsocks warnings. <ref>
Disable torsocks warning spam such as.<br />
[May 20 11:45:27] WARNING torsocks[2645]: [syscall] Unsupported syscall number 224. Denying the call (in tsocks_syscall() at syscall.c:165)<br />
https://phabricator.whonix.org/T317
</ref>
<pre>
export TORSOCKS_LOG_LEVEL=1
</pre>

Update your package lists.

<pre>
apt-get update
</pre>

Let's upgrade torsocks and uwt first so we see fewer torsocks warning. <ref>Due to transition from torsocks 1.x to torsocks 2.x.</ref>
<pre>
apt-get install torsocks uwt
</pre>

Upgrade.

<pre>
apt-get dist-upgrade
</pre>

It is recommended to have the {{Code2|whonix-workstation}} package installed to make sure nothing is broken. (If you like to uninstall it later as per [[Whonix_Debian_Packages]], you're free to do so. Still, it is recommended to re-install it before removal to make sure you're as close to official package selection as possible.)
<pre>
apt-get install whonix-workstation
</pre>

Get rid of old packages.

<pre>
apt-get autoremove
</pre>

Remember to store the terminal (Konsole) log. (File -> Save Output As)

Power off.

<pre>
poweroff
</pre>

<s>Your upgraded Whonix-Workstation will not be able to connect yet, because that requires either an upgraded Whonix-Gateway or a Whonix-Gateway 11.x. As soon you upgraded your Whonix-Gateway or downloaded a Whonix-Gateway 11.x, you should be able to connect.</s>

= Upgrading Whonix-Gateway =
'''[[Download|Downloading]] a new Whonix-Gateway will be probably easier than applying the following instructions for upgrading.'''

Become root.

Do a usual [[Security_Guide#Updates|upgrade]] of your system's packages from Debian.

<pre>
sudo su
</pre>

Enable Whonix's {{Code2|jessie}} repository.

<pre>
whonix_repository --enable --codename jessie
</pre>

Enable extensive debugging so reporting eventual bugs becomes easier.

<pre>
export DEBDEBUG=1
</pre>

Upgrade. <ref name=aptupgrade>
Not all packages are strictly required. For example the ...-build-... packages won't do anything. However, they don't hurt either. We're mimicking the behavior of the [https://github.com/Whonix/Whonix/blob/master/build-steps.d/1700_install-packages 1700_install-packages] build step here to end up with a system that is as similar to Whonix 11.x as possible. This is useful to make eventual issues / differences of upgraded Whonix 11.x systems vs Whonix 11.x as unlikely as possible.
</ref>

<pre>
apt-get install whonix-gateway
</pre>

Dist-upgrade.

<pre>
apt-get dist-upgrade
</pre>

Remember to store the terminal (Konsole) log. (File -> Save Output As)

Reboot required.

<pre>
reboot
</pre>

= Grub Fix =
== Introduction ==
Applying this fix is recommended after upgrading from Whonix 10 to Whonix 11.

Recommended for users of:

* VirtualBox
* [[KVM]]

Probably not required for users of:

* [[Qubes]]
* [[Physical Isolation]]

The following instructions differ for 686-pae and 486 kernel users.

Are you are 686-pae kernel kernel or 486 kernel user?
* If you previously did not choose any options right after starting Whonix in the grub boot menu, if you don't know what this is about, then you're very likely a 686-pae kernel user.
* If you are used to picking the 486 kernel as per [[Starting_Whonix#Boot_Options|Starting Whonix#Boot Options]], then you already know, that you're a 486 kernel user.

== 686-pae Kernel Users ==
Remove the 486 and 586 kernel meta packages.

<pre>
sudo apt-get remove linux-image-*-486 linux-image-*-586
</pre>

Remove the 486 and 586 kernel packages.

<pre>
sudo apt-get remove linux-image-3.*-486 linux-image-3.*-586
</pre>

Make sure a kernel is installed.

<pre>
sudo apt-get install linux-image-686-pae
</pre>

Proceed with [[#Install Grub]] chapter!

== 486 Kernel Users ==
Remove the 686-pae kernel meta packages.

<pre>
sudo apt-get remove linux-image-686-pae
</pre>

Remove the 686-pae kernel packages.
<pre>
sudo apt-get remove linux-image-3.*-686-pae
</pre>

Make sure a kernel is installed.

<pre>
sudo apt-get install linux-image-486
</pre>

Proceed with [[#Install Grub]] chapter!

== Install Grub ==
* VirtualBox users: <code>sudo grub-install /dev/sda ; echo $?</code>
* [[KVM]] users: <code>sudo grub-install /dev/vda ; echo $?</code>
* [[Qubes]] users: Probably not required.
* [[Physical Isolation]] users: Probably not required.

= Footnotes =
<references />

[[Category:Documentation]]

{{Footer}}
