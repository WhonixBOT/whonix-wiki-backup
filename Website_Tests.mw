{{Title|title=
Website Tests / Server Tests
}}
{{Header}}
{{#seo:
|description=Testing the {{project name}} server with test websites such as hardenize.com / securityheaders.com / Mozilla Observatory / SSL Labs / hstspreload.org.
|image=https://www.{{project_clearnet}}/w/images/0/0d/Websitetest.jpg
}}
[[image:Websitetest.jpg|thumb]]
= Introduction =

Security is not a checklist, nor is it simply about having website tests show a lot green or positive results for features like:
<div style="column-count:2;-moz-column-count:2;-webkit-column-count:2">
* SSL certificate
* HTTP Strict Transport Security (HSTS)
* Certification Authority Authorization (CAA) Policy
* Expect-CT header
* Domain Name System Security Extensions (DNSSEC)
* Content Security Policy (CSP)
* Feature-Policy
* Mail Transfer Agent Strict Transport Security (MTA-STS)
* SMTP TLS Reporting (TLS-RPT)
* DNS-based Authentication of Named Entities (DANE)
* Sender Policy Framework (SPF)
* DomainKeys Identified Mail (DKIM)
* Domain-based Message Authentication, Reporting and Conformance (DMARC)
* Frame Options
* Cross-Site Scripting (XSS) Protection
* Content Type Options
</div>

While it is nice to have these website or server security features, in a similar fashion to [[Browser Tests]] the context is important and there are many false positives.

Website test sites like <code>hardenize.com</code> are helpful tools for website owners to check various security features, but these tests say little about the server's actual security. For instance, tests cannot check if: the kernel, operating system and web applications are fully up-to-date or neglected; SSH is configured for public key authentication only; the server is [[Kicksecure]]-hardened; and whether backups are being made and so forth.

For example, at the time of writing the Microsoft website recorded a "C" rating at <code>securityheaders.com</code>. Further, they did not have a CSP and neither DNSSEC nor DANE were configured. Despite this, the Microsoft website is not routinely hacked so malicious software can be uploaded by unauthorized third parties. <ref>
* https://web.archive.org/web/20201213150857/https://www.hardenize.com/report/microsoft.com/1607820284
* https://web.archive.org/web/20201213145224/https://securityheaders.com/?q=microsoft.com&followRedirects=on
</ref>

As elaborated in the [[#Content-Security-Policy CSP|CSP]] entry on this page, the threat models are nuanced and {{project_name}} does not engage in security theater. While imperfections exist, reasonable efforts are made to improve website security despite constrained resources and developer time. A [[#Comparison_with_Others|Comparison of Test Results with Others]] also helps to put this information into perspective.

For further information on this topic, see:

* [https://signal.org/ Signal project]'s blog post [https://signal.org/blog/certifiably-fine/ Certifiably "F"ine]
* [[Privacy Policy Technical Details]]
* [[Privacy Policy Technical Details#website|Privacy on the {{project_name}} Website]] 
* [[Trust#Trusting_the_{{project_name}}_.E2.84.A2_Website|Trusting the {{project_name}} Website]] 
* [[Trust#Distrusting_Infrastructure|Distrusting Infrastructure]]

= hardenize.com =
https://www.hardenize.com/report/whonix.org/1607868311

https://forums.whonix.org/t/no-clean-hsts-preload-dnssec/10255

https://forums.whonix.org/t/expect-ct-security-header-for-whonix-org/10286

See also [[#Email DANE|Email DANE]].

= SSL Labs =
https://www.ssllabs.com/ssltest/analyze.html?d={{project_clearnet}}

= hstspreload.org =
https://hstspreload.org/?domain={{project_clearnet}}

= Email DANE =
<blockquote>Email DANE (SMTP)

DNS-based Authentication of Named Entities (DANE) is a bridge between DNSSEC and TLS. In one possible scenario, DANE can be used for public key pinning, building on an existing publicly-trusted certificate. In another approach, it can be used to completely bypass the CA ecosystem and establish trust using DNSSEC alone.
Feature not implemented or disabled
Your server doesn't support this feature.</blockquote>

The <code>{{project_clearnet}}</code> website doesn't offer free or paid e-mail accounts. The extend in which <code>{{project_clearnet}}</code> uses e-mail:

* Sends e-mails to wiki editors who signed up to be notified about changes.
* Forum e-mail sign-up and notifications.
* [[Mailing Lists]]
* Developer accounts.

Even if e-mail security was "perfected", even if the DANE test would pass on website tests, it should not be relied on DANE. Better use end-to-end encryption such as [[OpenPGP]] or even better such as [[codecrypt]].

= Website DANE =
See [[Dev/About_Infrastructure#DANE_TLSA|DANE TLSA References]]. Quote [https://forums.whonix.org/t/dane-tlsa-dns-based-authentication-of-named-entities-for-whonix-org/10218 DANE TLSA (DNS-based Authentication of Named Entities) for whonix.org]:

<blockquote>For now decided not to implement it due to:

* low adaption
* no support in major browsers
* complex, maintenance demanding setup</blockquote>

= Content-Security-Policy CSP =
== Threat Model ==
So what is a CSP? CSP stands for <u>C</u>ontent <u>S</u>ecurity <u>P</u>olicy. "Something about server security." More detailed below. It follows a [https://owasp.org/www-community/attacks/Content_Security_Policy Quote from OWASP] which sounds accurate but too abstract to make head or tail of it.

<blockquote>Is a W3C specification offering the possibility to instruct the client browser from which location and/or which type of resources are allowed to be loaded. To define a loading behavior, the CSP specification use “directive” where a directive defines a loading behavior for a target resource type.

Directives can be specified using HTTP response header (a server may send more than one CSP HTTP header field with a given resource representation and a server may send different CSP header field values with different representations of the same resource or with different resources) or HTML Meta tag, the HTTP headers below are defined by the specs:</blockquote>

One use of a CSP is for a web server software (such as nginx) to tell the visitor's browser (such as Mozilla Firefox) what resources (speak HTML, JavaScript, images) to load from which authorized sources. This is an interesting, nuanced threat model. How can the CSP, something running on the web server software, provide additional security for the very web server software it is running on? At first sight, this seems impossible. However, there is a point. Webapps nowadays are very complex, speak prone to software bugs and security vulnerabilities. It might be the case that a webapps is functioning unexpected due to a bug or even compromised because an attacker exploited a vulnerability in the webapp. However, a compromised webapp doesn't necessarily equal web server software (such as nginx) compromise, let alone whole server (root) compromise. The webapp might be functioning unexpected or be compromised, but the web server software might still be functioning according to specifications. Under such conditions, the CSP can limit what the webapp (or rather the results of the output of the webapp processed by the visitor's browser) can do. For example the CSP as enforced by the web server software can prohibit<ref>
The CSP is actually a recommendation for the browser. However, writing the following would be confusing.
<blockquote>For example the CSP as enforced by the web server software can recommend the browser to not load content from external websites and the browser would honor this advice.</blockquote>
</ref> the browser from loading content from third party websites. In some cases, some webapp vulnerabilities might be made less useful or even be rendered useless. A CSP aims to contain faulty or compromised webapps.

You see how nuanced the threat model is. A faulty or compromised webapp being contained. Wouldn't it be better to avoid faulty or web app compromise to being with? Of course.

A good use case of a CSP is for webmail, i.e. reading e-mail in the browser. For better security and privacy, no contents should be load from third party websites, i.e. contents from websites other than the e-mail provider. [[E-Mail#Webmail| However, even better to avoid webmail entirely as recommended]], using an e-mail client and disabling HTML and scripts (text-only mails). Again, rely on the server to implement CSP or use local e-mail clients with plaintext only. The latter is much better.

Forum discussion: [https://forums.whonix.org/t/content-security-policy-now-deployed-on-whonix-websites/5494 Content-Security-Policy now deployed on Whonix websites]

== {{project_name_short}} ==
<code>{{project_clearnet}}</code> has an essential CSP. It is useful for <code>{{project_clearnet}}</code> onion domain to avoid loading resources from <code>{{project_clearnet}}</code> clearnet domain to avoid browser mixed content warnings. It is helpful to avoid clearnet connections for visitors who prefer using the onion version of {{project name}} website because modern webapps are not designed for being used on multiple domain names with the same database backend and/or use for with onion domains generally.

<code>{{project_clearnet}}</code> however doesn't have yet a CSP without 'unsafe-inline', 'unsafe-eval' eval for all webapps yet.

<blockquote>
* This policy contains 'unsafe-inline' which is dangerous in the script-src directive.
* This policy contains 'unsafe-eval' which is dangerous in the script-src directive.
* This policy contains 'unsafe-inline' which is dangerous in the style-src directive.</blockquote>

Users who have NoScript in their browser enabled are unaffected.

Users are advised to use secure browsers, compartmentalize browsing in different virtual machines (VMs), [[System Hardening Checklist|harden]] their operating system, use [[Kicksecure]], use NoScript, rather than relying on websites to deploy CSP. Widespread, perfect deployment of CSP will probably not happen anytime soon. [[Kicksecure]] and [[Whonix]] are real efforts for security and privacy. Resources are, developer time is limited. Efforts spent on CSP are limited to reasonable efforts, not security theater.

== Homepage ==
[https://securityheaders.com/?q=whonix.org&followRedirects=on Quote securityheaders.com] for {{project name}} website component, homepage.

== Forums ==
[https://securityheaders.com/?q=forums.whonix.org&followRedirects=on Quote securityheaders.com for {{project name}} website component, discourse forums].

CSP is implemented by the developers of the webapp, discourse. (Feature request for [https://meta.discourse.org/t/mitigate-xss-attacks-with-content-security-policy/104243/24 Discourse Forums Permissions-Policy].)

([https://securityheaders.com/?q=meta.discourse.org&followRedirects=on Quote securityheaders.com for upstream meta.discourse.org])

== Phabricator ==
[https://securityheaders.com/?q=https%3A%2F%2Fphabricator.whonix.org%2F&followRedirects=on phabricator]

([https://securityheaders.com/?q=https%3A%2F%2Fsecure.phabricator.com%2F&followRedirects=on Quote securityheaders.com for upstream phabricator])

== Wiki ==
<ref>
Under consideration:
<s>[https://www.mediawiki.org/wiki/Manual:$wgCSPHeader <code>$wgCSPHeader</code>] is enabled.

<blockquote>It is not compatible with $wgUseFileCache</blockquote>

Wiki users which are not logged in have 1 CSP, the essential CSP (by nginx). (Except for visitors of pages which are not yet cached.)

Wiki users which are logged in have 2 CSPs, the essential CSP and on top of it the CSP generated by the mediawiki webapp setting <code>$wgCSPHeader</code>.</s>

* [https://phabricator.wikimedia.org/T270095 add Widgets extension compatibility with $wgCSPHeader CSP Content Security Policy]
* [https://phabricator.wikimedia.org/T270099 add $wgCSPHeader CSP Content Security Policy compatibility with $wgUseFileCache file cache]
</ref>

[https://securityheaders.com/?q=https%3A%2F%2Fwww.whonix.org%2Fwiki%2FMain_Page&followRedirects=on {{project name}} website component, wiki]

([https://securityheaders.com/?q=mediawiki.org&followRedirects=on securityheaders.com for upstream mediawiki.org] / [https://securityheaders.com/?q=wikipedia.org&followRedirects=on securityheaders.com for wikipedia.org])

[https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy#Multiple_content_security_policies Quote Mozilla Developer Network, Multiple content security policies]

<blockquote>Adding additional policies can only further restrict the capabilities of the protected resource</blockquote>

= gzip =
Not security relevant. Performance only.

https://onionheaders.website shows gzip is disabled but checking with <code>curl</code> shows it is actually enabled. As per [https://davidwalsh.name/check-gzip curl gzip test instructions].

{{CodeSelect|code=
torsocks curl -H "Accept-Encoding: gzip" --head http://dds6qkxpwdeubwucdiaord2xgbbeyds25rbsgr73tbfpqpt4a6vjwsyd.onion/wiki/Documentation
}}

Output includes.

<blockquote>Content-Encoding: gzip</blockquote>

= Comparison with Others =
Before demanding what <code>{{project_clearnet}}</code> website ought to implement, and might not do yet due to lack of resources, please compare with much better funded organizations for a fair comparison.

* [https://www.hardenize.com/report/microsoft.com/1607820284 multi billion company, Microsoft, hardenize.com]
* [https://securityheaders.com/?q=microsoft.com&followRedirects=on multi billion company, Microsoft, securityheaders.com]
* [https://www.hardenize.com/report/torproject.org/1607868814#www_hsts The Tor Project, hardenize.com]
* [https://securityheaders.com/?q=wikipedia.org&followRedirects=on Wikipedia, securityheaders.com]
* [https://securityheaders.com/?q=mediawiki.org&followRedirects=on mediawiki.org, securityheaders.com]
* [https://securityheaders.com/?q=https%3A%2F%2Fmeta.discourse.org&followRedirects=on Discourse, securityheaders.com]

= See Also =
* [[Privacy Policy Technical Details]]
* [[Privacy Policy Technical Details#website|Privacy on the {{project_name}} Website]]
* [[Trust#Trusting_the_{{project_name}}_.E2.84.A2_Website|Trusting the {{project_name}} Website]]
* [[Trust#Distrusting_Infrastructure|Distrusting Infrastructure]]
* [https://signal.org/blog/certifiably-fine/ Certifiably "F"ine]

= Footnotes  =
{{reflist|close=1}}

{{Footer}}

[[Category:Documentation]]
