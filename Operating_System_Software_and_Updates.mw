{{Header}}
{{#seo:
|description=Operating System Software and Updates
|image=https://www.whonix.org/w/images/3/34/Operatingsystemupdated234234.jpg
}}

= APT Security Update - DSA 4371-1 =
{{mbox
| image   = [[File:Ambox_warning_pn.svg.png|40px]]
| text    = Special instructions are required to update due to '''APT security update [https://lists.debian.org/debian-security-announce/2019/msg00010.html DSA 4371-1]'''
}}
{{mbox
| image   = [[File:Ambox_notice.png|40px]]
| text    = This procedure is <u>not</u> required for {{project name}} 14.0.1.3.8 or above. <ref>
Because that version comes with the upgraded APT version which includes the security fix.
</ref>
}}


Using [[Onionizing Repositories|onion sources]] <u>might</u> provide protection against this vulnerability. <ref>
[https://lists.debian.org/debian-security-announce/2019/msg00010.html Debian's security announcement] does not mention [https://onion.torproject.org Debian onion sources]: <br /> <blockquote>The code handling HTTP redirects in the HTTP transport method doesn't properly sanitize fields transmitted over the wire. This vulnerability could be used by an attacker located as a man-in-the-middle between APT and a mirror to inject malicous content in the HTTP connection. This content could then be recognized as a valid package by APT and used later for code execution with root privileges on the target machine.</blockquote> Redirects might also be used by onion mirrors. The {{project name}} project is unaware of any Debian announcement regarding where their onion sources are hosted. Since onion sources are also just a mirror, and mirrors may also be in a position to attempt a [[Warning#Man-in-the-middle_Attacks|man-in-the-middle attack]], these instructions are recommended in all cases.</ref> The special instructions below should be safe for {{project name}} users; minor modifications are necessary for Debian platforms. <ref>This is because {{project name}} uses <code>/etc/apt/sources.list.d/debian.list</code>, while Debian and Qubes' Debian templates depend upon <code>/etc/apt/debian.list</code>.
</ref>

'''1.''' Move <code>/etc/apt/sources.list.d/debian.list</code> to a temporary location.

{{CodeSelect|code=
sudo mv /etc/apt/sources.list.d/debian.list /etc/apt/debian.list
}}

'''2.''' Create an apt sources list that works without redirections.

{{CodeSelect|code=
echo "deb http://cdn-fastly.deb.debian.org/debian-security stable/updates main" {{!}} sudo tee /etc/apt/sources.list.d/debian.list
}}

'''3.''' Securely update the package lists using the <code>-o Acquire::http::AllowRedirect=false</code> workaround.

{{CodeSelect|code=
sudo apt-get -o Acquire::http::AllowRedirect=false update
}}

'''4.''' Securely upgrade apt-get using the <code>-o Acquire::http::AllowRedirect=false</code> workaround.

{{CodeSelect|code=
sudo apt-get -o Acquire::http::AllowRedirect=false upgrade
}}

'''5.''' Verify the installed <code>apt</code> version has been upgraded.

{{CodeSelect|code=
dpkg -l {{!}} grep "commandline package manager"
}}

This command should show.

<pre>
ii  apt                                            1.4.9                                      amd64        commandline package manager
</pre>

The output above shows <code>apt</code> version <code>1.4.9</code>, which includes the security fix.

'''6.''' Delete the temporary <code>/etc/apt/sources.list.d/debian.list</code>.

{{CodeSelect|code=
sudo rm /etc/apt/sources.list.d/debian.list
}}

'''7.''' Restore the original <code>/etc/apt/sources.list.d/debian.list</code>.

{{CodeSelect|code=
sudo mv /etc/apt/debian.list /etc/apt/sources.list.d/debian.list
}}

'''8.''' Perform the [[Operating_System_Software_and_Updates#Standard_Upgrade_Steps|Standard Upgrade Steps]].

The procedure is now complete.

Forum discussion:<br />
https://forums.whonix.org/t/special-instructions-required-to-securely-update-because-of-apt-security-update-dsa-4371-1/6721

= End-of-life Software =
{{End of life software}}

= Installing Additional Software =
See [[Install Software]].

{{Anchor|Recommendation to install latest security updates on all systems}}
= Updates =
{{mbox
| image   = [[File:Ambox_warning_pn.svg.png|40px]]
| text    = '''All packages must stay up-to-date for security and anonymity purposes.'''
}}

* '''[[Qubes|Qubes Whonix]]:''' Follow the [[Qubes/Update|[[{{q_project_name_short}}|{{q_project_name}}]] Update Guide]].
* '''All other {{project name}} OS builds:''' Follow the update instructions below.

== Standard Upgrade vs Release Upgrade ==

This procedure is for standard ("everyday") upgrading of {{non_q_project_name_short}} and will not perform a [[Release Upgrade]].

{{Release Upgrade}}

Before applying a release upgrade, it is useful to first complete a standard upgrade as documented below.

== Standard Upgrade Steps ==

{{Operating_System_Updates}}

= Non-functional Onion Services =
{{Non-functional Onion Services}}

= Updating with Extra Care =
See [[Install_Software#How-to:_Install_or_Update_with_Utmost_Caution|How-to: Install or Update with Utmost Caution]].

= Footnotes =
{{reflist|close=1}}

{{Footer}}

[[Category:Documentation]]
