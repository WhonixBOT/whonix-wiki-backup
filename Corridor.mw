{{Header}}
{{Title|
title=Using corridor, a Tor traffic whitelisting gateway with Whonix
}}
{{#seo:
|description=Using corridor, a Tor traffic whitelisting gateway with Whonix
}}
__forcetoc__

= Introduction =
corridor is a Tor traffic whitelisting gateway. It is a filtering gateway. Not a proxying gateway.

https://github.com/rustybird/corridor

It can also be used as a [https://trac.torproject.org/projects/tor/wiki/doc/TorifyHOWTO/BridgeFirewall BridgeFirewall].

= Connecting to corridor before Tor =
'''UNFINISHED'''

Testers only!

It is possible to configure Whonix-Gateway (sys-whonix) to use corridor as <u>local</u> proxy to establish the following tunnel:<br />
'''User -> corridor -> Tor > Internet'''

This is not necessarily more anonymous. It is an additional fail-save Tor traffic whitelisting firewall that would protect from accidental clearnet leaks (hypothetical clearnet leak bugs in Whonix). As [https://github.com/rustybird/corridor corridor's project description] states, quote "it cannot prevent malware on a client computer from finding out your clearnet IP address". corridor is mostly useful for developers and auditors of Whonix, perhaps also for advanced users who would like to have an additional safety net.

It does not increase the tunnel length, i.e. it does not add more relays between you and the destination, if you are interested in that, see [[Tunnels/Introduction]].

If you want to do this, apply the following instructions.

[[Qubes-Whonix]] only! [[Non-Qubes-Whonix]] is [[unsupported]].

Credits: The author of corridor is [https://github.com/rustybird rustybird]. The author of [https://en.wikipedia.org/wiki/Fork_%28software_development%29 fork] of [https://github.com/adrelanos/corridor corridor for Debian] which will be used in this instructions is [https://github.com/adrelanos Patrick Schleizer].

The following instructions should be applied in a [https://www.qubes-os.org Qubes] using a [https://www.qubes-os.org/doc/templates/debian/ Debian template].

{{mbox
| image   = [[File:Ambox_warning_pn.svg.png|40px]]
| text       = 
The following instructions will result by default in:

* the [https://packages.debian.org/jessie/tor Debian tor package] being installed
* and thereby automatically connecting to the [https://www.torproject.org Tor] public network.
* Downloading corridor from [[Whonix-APT-Repository]].
* This may not be what you want if you want to [[Hide_Tor_and_Whonix_from_your_ISP|hide Tor and Whonix from your ISP]].
* If you are already using Whonix, which you are most likely doing when reading this page, in running a second instance of [[Tor]] which is independent from the one running inside Whonix-Gateway. From the perspective of your ISP you will have a different network [[Fingerprint]].
}}

Create a new standalone ProxyVM called {{Code2|sys-corridor}} based on Debian-8 template.

<code>Qubes VM Manager -> Create AppVM -> enable 'Standalone' -> name: {{Code2|sys-corridor}} -> template: Debian-8 -> OK</code>

Enable the {{Code2|corridor}} qvm service.

<code>Qubes VM Manager -> click on {{Code2|sys-corridor}} -> right click -> VM settings -> services -> type in the field -> {{Code2|corridor}} -> press {{Code2|+}} -> press OK</code>

Start {{Code2|sys-corridor}} and open a terminal using Qubes start menu.

Inside {{Code2|sys-corridor}}...

{{Whonix-APT-Repository-Add}}

[[Update]] your package lists.

{{CodeSelect|code=
sudo apt-get update
}}

Install corridor.

{{CodeSelect|code=
sudo apt-get install corridor
}}

As long as this instructions are experimental, you are advised to run the following commands to check if everything is alright.

{{CodeSelect|code=
sudo systemctl status corridor-data
sudo systemctl status corridor-init-forwarding 
sudo systemctl status corridor-init-logged 
sudo systemctl status corridor-init-snat
}}

Set sys-whonix's NetVM to {{Code2|sys-corridor}}.

<code>Qubes VM Manager -> one left click on sys-whonix -> VM-Settings -> NetVM -> {{Code2|sys-corridor}} -> OK</code>

Test.

= Footnotes =
<references/>

{{Footer}}

[[Category:Documentation]]
