{{Header}}
__NOTITLE__
{{#seo:
|description=Complete and Comprehensive Instructions to build Whonix Virtual Machine Images from Source Code. Including build configurations, such as 64 bit builds, Terminal-Only builds and so forth.
}}
{{forkme}}

== Introduction ==
This page documents how to build Whonix [[VirtualBox]] {{Code2|.ova}} or {{Code2|.qcow2}} images (for [[KVM]]). For [[Qubes-Whonix]], see [[Dev/Qubes#Build_Qubes-Whonix_Templates]].

== Host Preparation ==
<!--
EDITORS NOTE: The following host preparation text is duplicated on 3 pages.
(1) [[Physical Isolation]]
(2) [[Dev/Build Documentation]] for VM images
(3) Whonix debian packages.
When making changes here, please consider also making changes there.
(Not using a template, because it would probably require a version specific template.)
-->
* You need to build on '''Debian stretch'''. (How to obtain Debian safely: <ref>[[Debian|Debian ISO OpenPGP verification]]</ref>) <ref>The build scripts could be adapted to run on other {{Code2|*NIX}} systems as well but currently they assume {{Code2|apt-get}} and {{Code2|grml-debootstrap}} to be available.</ref>
* It is recommended to set your terminal (for example Konsole) to unlimited scrollback, so you can watch the full build log.
* You need ~ 30 GB free disk space. When you build inside a Virtual Machine using sparse files such as VirtualBox, consider assigning 100 GB free space. (Sparse files will grow as space is actually used. Won't take up space if it's not used. Easier to have the option to use more space than growing the image later.) More info: <ref>~ 25 GB might suffice as well. We haven't messured that in detail yet. Less space required, if you only want to build either Whonix-Gateway or Whonix-Workstation. Less space for Whonix-Gateway required than for Whonix-Workstation.</ref>

* <u>'''Short'''</u>: '''Don't add private files to Whonix's source code folder! [...]'''
<div class="toccolours mw-collapsible mw-collapsed" style="width:800px">
<div class="mw-collapsible-content">
''Long'': [...] Unless you know what you are doing. Technically, it would work. This is recommended against. Those files would get managed by the respective package. When you later update Whonix debian packages, your files would get deleted by the package manager. Also adding private files to Whonix's source code folder, later contributing to Whonix's development and accidentally pushing the wrong git branch would be a disaster. Better add your private files to Whonix after building Whonix. Or add a custom build step adding your files, which then get copied from a folder outside of Whonix's source folder.
</div>
</div>
<br />
* <u>'''Short'''</u>: '''Make sure there aren't any VMs in VirtualBox already called Whonix-Gateway or Whonix-Workstation!''' 
<div class="toccolours mw-collapsible mw-collapsed" style="width:800px">
<div class="mw-collapsible-content">
''Long'': <ref>Because the build script would fail, because it tries to create VMs either named Whonix-Gateway or Whonix-Workstation.</ref>
</div>
</div>
<br />
* <u>'''Short'''</u>: '''Do not try to build Whonix-Gateway and Whonix-Workstation at the same time!'''
<div class="toccolours mw-collapsible mw-collapsed" style="width:800px">
<div class="mw-collapsible-content">
''Long'': Building Whonix-Gateway and Whonix-Workstation at the same time is not supported due to limitations in the build script. In other words, do not try to run for example {{Code|sudo ~/Whonix/whonix_build --flavor whonix-gateway -- --build --target virtualbox}} and {{Code|sudo ~/Whonix/whonix_build --flavor whonix-workstation -- --build --target virtualbox}} at the same time. The build would probably fail.
</div>
</div>
<br />

* <u>'''Short'''</u>: '''Don't use images created inside Continuous Integration (CI) environments for anything besides testing!'''
<div class="toccolours mw-collapsible mw-collapsed" style="width:800px">
<div class="mw-collapsible-content">
Usually you are not using [https://en.wikipedia.org/wiki/Continuous_integration CI] environments without knowing.

You can find out if you are running inside a CI environment by running.

<pre>
echo "$CI"
</pre>

If it shows nothing, i.e.

<pre>

</pre>

Everything is fine.

Otherwise, if it were to show.

<pre>
true
</pre>
Then don't use these images for anything besides testing.

Reason:
https://github.com/Whonix/Whonix/blob/master/build-steps.d/1100_prepare-build-machine#L577
</div>
</div>
<br />

* [[Dev/Get_Whonix_Source_Code|Get Whonix source code]].
* [[Template:Build_Configuration|OPTIONAL build configuration]]

== VM Creation ==
<!--
EDITORS NOTE:
I am not sure it is a great idea to first tell builders how to build Whonix and later how to clean up to prepare for another build. Running the cleanup steps before the creation steps may be unnecessary when running these steps for the first time, but doesn't hurt either. An important thing this does archive is creating fewer support requests and bug reports from people running these steps for the second time without remembering they have to clean up first. If you want to discuss this, please open a new discussion in the development forums.
-->

Open a terminal (such as Konsole).

The following build targets are available.

<pre>
--target virtualbox
--target qcow2
--target raw
--target root
</pre>

In context of build documentation for the current page you are reading, if you are interested in,

* {{Code2|--target root}} you should look into our [[Dev/Build_Documentation/Physical_Isolation|Physical Isolation Build Documentation]] instead.
* {{Code2|.ova}} images (most likely for [[VirtualBox]] or [[VMware]]), then choose {{Code2|--target virtualbox}}
* {{Code2|.qcow2}} images (most likely for [[KVM]] or [[QEMU]]), then choose {{Code2|--target qcow2}}
* {{Code2|.raw}} images (most likely for ports), then choose {{Code2|--target raw}}

{{Code2|--target virtualbox}} can be combined with {{Code2|--target qcow2}} as well as {{Code2|--target raw}}, which is useful for redistributable builds. Note, that {{Code2|--target virtualbox}} is currently the most tested option.

Delete eventually already existing Whonix-Gateway virtual machine. '''Warning''': This will delete a virtual machine named Whonix-Gateway from VirtualBox!

<pre>
sudo ~/Whonix/whonix_build --flavor whonix-gateway --target virtualbox --clean
</pre>

Delete eventually already existing Whonix-Workstation virtual machine. '''Warning''': This will delete a virtual machine named Whonix-Workstation from VirtualBox!

<pre>
sudo ~/Whonix/whonix_build --flavor whonix-workstation --target virtualbox --clean
</pre>

Build a Whonix-Gateway virtual machine image.

<pre>
sudo ~/Whonix/whonix_build --flavor whonix-gateway --target virtualbox --build
</pre>

Build a Whonix-Workstation virtual machine image.

<pre>
sudo ~/Whonix/whonix_build --flavor whonix-workstation --target virtualbox --build
</pre>

The resulting {{Code2|.ova}}, {{Code2|.qcow2}} and/or {{Code2|.raw}} images can be found in {{Code|~/whonix_binary}} folder.

While building, you might see a few [[Dev/Expected Build Warnings|Expected Build Warnings]].

Check if all went ok.

Please report back any issues!

== Footnotes ==
<references/>

{{Footer}}

[[Category:Development]]
