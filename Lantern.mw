{{Header}}
{{#seo:
|description=Alternative Censorship Circumvention. Lantern over Tor. Combining Whonix with Lantern. Connecting to Lantern before Tor (User -> Lantern -> Tor -> Internet ). Alternative to Tor bridges.
}}

= Connecting to Lantern before Tor =
'''UNFINISHED!'''

Testers only!

It is possible to configure Tor to use Lantern as proxy to establish the following tunnel:<br />
'''User -> Lantern -> Tor -> Internet'''

Create a new standalone ProxyVM called Lantern-Gateway based on Debian-8 template.

You need to unload Qubes iptables rules in the Lantern-Gateway ProxyVM. See: [[Dev/Firewall_Unload]]

Install missing lantern dependency. (TODO: debian/control should declare a depends. Check if lantern developers are aware of this issue and report a bug if necessary.)

<pre>
sudo apt-get install libappindicator3-1
</pre>

Install socat.

<pre>
sudo apt-get install socat
</pre>

Check if the downloaded deb file is still the right file. Go to https://getlantern.org/ and check for desktop, linux downloads.

<pre>
curl --tlsv1.2 --proto =https https://s3.amazonaws.com/lantern/lantern-installer-beta-64-bit.deb --output ~/lantern-installer-beta-64-bit.deb
</pre>

Install lantern.

<pre>
sudo dpkg -i ~/lantern-installer-beta-64-bit.deb
</pre>

Start lantern.

<pre>
lantern
</pre>

<ref>
In Lantern-Gateway, check if lantern's socks port is functional.

<pre>
curl --tlsv1.2 --proto =https --socks5-hostname socks5h://127.0.0.1:8788 https://check.torproject.org
</pre>
</ref>

You must make lantern listen on all interfaces so it will be reachable from sys-whonix. TODO: Does lantern have such an option? If so, use it. If not, please post a lantern feature request. In meanwhile, we use socat as workaround.

<pre>
socat TCP-LISTEN:bind=$(qubesdb-read /qubes-ip),fork TCP:127.0.0.1:8788
</pre>

In sys-whonix. {{Open_/etc/tor/torrc}}

Add the following. 10.137.2.18 is just an example. You need to replace 10.137.2.18 with the IP of your Lantern-Gateway ProxyVM. You could run the following command within sys-whonix to find out the IP of your Lantern-Gateway ProxyVM.
<code>qubesdb-read /qubes-gateway</code>

<pre>
Socks5Proxy 10.137.2.18:8788
</pre>

{{Footer}}

[[Category:Documentation]]
