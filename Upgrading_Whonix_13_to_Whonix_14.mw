{{Header}}
{{#seo:
|description=How to Upgrade from Whonix 13.x to Whonix 14.x
}}

'''UNFINISHED! DO NOT USE YET!'''

development discussion:

* https://forums.whonix.org/t/updating-whonix-from-jessie-to-stretch-migration-to-gnome-shell-port-to-gnome-ish-applications
* https://phabricator.whonix.org/T467

{{Stub}}

= High Level Overview =
1. Backup your data. (Ideally have a copy of your VM, so you can try again.) <br />
2. Consider running the optional [[#Sanity Tests]]. <br />
3. Upgrade Whonix-Workstation. <br />
4. Power off Whonix-Workstation. <br />
5. Upgrade Whonix-Gatway. <br />
6. Restart Whonix-Gateway. <br />
7. Restart Whonix-Workstation <br />

= Sanity Tests =
<div class="toccolours mw-collapsible mw-collapsed" style="width:800px">
These are optional, but recommended. If you want to do them, please press on expand on the right.
<div class="mw-collapsible-content">
<pre>
sudo dpkg --audit ; echo $?
</pre>

Expected output.

<pre>
0
</pre>

<pre>
sudo dpkg --configure -a ; echo $?
</pre>

Expected output:

<pre>
0
</pre>

[[Security_Guide#Updates|Get package upgrades.]]

<pre>
sudo apt-get update
</pre>

<pre>
sudo apt-get dist-upgrade
</pre>

Test wise install python-qt4.

<pre>
sudo apt-get install python-qt4 ; echo $?
</pre>

<pre>
## ... successful installation of python-qt4 ...
0
</pre>
</div>
</div>

= Upgrading =
(Downloading a new Whonix-Gateway / Whonix-Workstation would be probably easier than applying the following instructions for upgrading, but this upgrade should be quite smooth.)

Backups are important as noted in above chapter [[#Before you start]].

Consider doing the [[#Sanity Tests]] described above. They'll check if your system is affected by obvious grave issues, that you must fix before attempting to upgrade. If your package manager is broken, for example because you mixed packages from Debian stable with packages from Debian testing, then the upgrade may fail in the middle leaving your system in a difficult to resolve situation.

Consider keeping the full terminal (Konsole) log. Even if everything apparently worked, there might be issues after reboot. In case of a bug report in the forums you would be asked to share the upgrading log so the issue can be investigated.

If you are using Qubes R3.0 or R3.1 as your host operating system, you are advised to upgrade your VMs and dom0 to R3.2 before proceeding. Follow the [https://www.qubes-os.org/doc/upgrade-to-r3.2/ Qubes R3.1 > R3.2 upgrade instructions on the Qubes website].

Do a usual [[Security_Guide#Updates|upgrade]] of your system's packages from Debian.

Update Whonix apt sources list. Don't use the testers repository just yet. [Wait for new information.] 

<pre>
sudo whonix_repository --enable --codename stretch
</pre>

Qubes only. Update Debian apt sources list.

<pre>
sudo sed -i "s/jessie/stretch/g" /etc/apt/sources.list.d/debian.list
</pre>

Qubes only. Update Qubes apt sources list.

<pre>
sudo sed -i "s/jessie/stretch/g" /etc/apt/sources.list.d/qubes-r3.list
</pre>

Become root.

<pre>
sudo su
</pre>

Enable extensive debugging so reporting eventual bugs becomes easier.

<pre>
export DEBDEBUG=1
</pre>

Remove the following accessibility tools unless you are using those. (You would probably know if you are using them.) TODO: Required? (Maybe that gets fixed later during Debian stretch development.)

<pre>
apt-get purge espeakup brltty
</pre>

[[Update]] your package lists.

<pre>
apt-get update
</pre>

Upgrade torsocks first.

<pre>
sudo apt-get install torsocks usability-misc
</pre>

Upgrade.

<pre>
apt-get-noninteractive dist-upgrade
</pre>

<pre>
apt-get-noninteractive install -f
</pre>

<pre>
apt-get-noninteractive dist-upgrade
</pre>

TODO: need to run apt-get dist-upgrade several times? (Maybe that gets fixed later during Debian stretch development.)

[[Update]] your package lists again. <ref>
This is required because the repository uri of Whonix repository has been upgraded to the new location by the whonix-legacy package.
</ref>

<pre>
apt-get update
</pre>

Purge packages which are deprecated in Whonix and replaced by new functionality.

<pre>
apt-get purge iceweasel firefox-esr
</pre>

Get rid of old packages.

<pre>
apt-get autoremove
</pre>

Remember to store the terminal (Konsole) log. (File -> Save Output As)

Reboot required.

<pre>
reboot
</pre>

Done.

= Qubes specific =
Optional.

VMs based upon whonix-ws TemplateVM will not inherit the default start menu unless you upgrade the following file. Either apply the following steps or manually add Tor Browser to any new TemplateBasedVM based on whonix-ws TemplateVM. <ref>This is a native Qube - not Whonix - limitation that will not be fixed due to technical difficulties. During VM upgrades, file /var/lib/qubes/vm-templates/whonix-ws/whitelisted-appmenus.list will not be upgraded.</ref>

In dom0. Open /var/lib/qubes/vm-templates/whonix-ws/whitelisted-appmenus.list with root rights.

Add. <ref>https://github.com/adrelanos/qubes-template-whonix/blob/master/appmenus_wheezy_whonix-workstation/vm-whitelisted-appmenus.list</ref>

<pre>
konsole.desktop
nautilus.desktop
whonixcheck.desktop
whonix-irc-chat-support.desktop
janondisttorbrowser.desktop
anondist-torbrowser_update.desktop
</pre>

Save.

Done.

= Footnotes =
<references />

[[Category:Documentation]]

{{Footer}}
