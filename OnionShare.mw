{{Header}}
{{#seo:
|description=Using OnionShare in {{project_name}}.
|image=https://www.{{project_clearnet}}/w/images/0/0d/OnionShare_logo.png
}}
[[Image:OnionShare_logo.png|<code>OnionShare Logo</code>|thumb|128px]]

= Introduction =

== OnionShare Functionality ==

OnionShare is an open source program that allows users to share/receive files, host a website or chat anonymously utilizing the Tor network. <ref>https://onionshare.org/</ref> The OnionShare wiki succinctly describes the design: <ref>https://docs.onionshare.org/</ref>

<blockquote>Web servers are started locally on your computer and made accessible to other people as [https://community.torproject.org/onion-services/ Tor onion services].

By default, OnionShare web addresses are protected with a random password. A typical OnionShare address might look something like this:

<code>http://onionshare:constrict-purity@by4im3ir5nsvygprmjq74xwplrkdgt44qmeapxawwikxacmr3dqzyjad.onion</code>

You’re responsible for securely sharing that URL using a communication channel of your choice like in an encrypted chat message, or using something less secure like unencrypted e-mail, depending on your [https://ssd.eff.org/module/your-security-plan threat model].

The people you send the URL to then copy and paste it into their [https://www.torproject.org/ Tor Browser] to access the OnionShare service.</blockquote>

As of OnionShare version <code>2.0</code> it is also possible to run the program in Receive mode. This means you can receive files via OnionShare after they are uploaded by Tor Browser users; this is a sort of 'SecureDrop Lite' or personal dropbox. Version <code>2.2</code> of OnionShare also permits the [https://micahflee.com/2019/10/new-version-of-onionshare-makes-it-easy-for-anyone-to-publish-anonymous-uncensorable-websites/ easy hosting of anonymous websites]: 

<blockquote>In addition to the “Share Files” and “Receive Files” tabs, OnionShare 2.2 introduces the “Publish Website” tab. You drag all of the files that make up your website into the OnionShare window and click “Start sharing.” It will start a web server to host your static website and give you a .onion URL. This website is only accessible from the Tor network, so people will need Tor Browser to visit it. People who visit your website will have no idea who you are – they won’t have access to your IP address, and they won’t know your identity or your location. And, so long as your website visitors are able to access the Tor network, the website can’t be censored.</blockquote>

Version <code>2.3</code> of OnionShare allows users to share/receive files, host websites or chat anonymously at the same time using a tabs feature. The secure, ephemeral and anonymous chat feature is particularly useful since it does not require account creation, is encrypted end-to-end and reduces the risk of messages being stored locally: <ref>https://blog.torproject.org/new-release-onionshare-23</ref>

<blockquote>Now when you open OnionShare you are presented with a blank tab that lets you choose between sharing files, receiving files, hosting a website, or chatting anonymous. You can have as many tabs open as you want at a time, and you can easily save tabs (that's what the purple thumbtack in the tab bar means) so that if you quit OnionShare and open it again later, these services can start back up with the same OnionShare addresses. ... Another major new feature is chat. You start a chat service, it gives you an OnionShare address, and then you send this address to everyone who is invited to the chat room (using an encrypted messaging app like Signal, for example). Then everyone loads this address in a Tor Browser, makes up a name to go by, and can have a completely private conversation.</blockquote>

As OnionShare is an actively developed project, it is recommended to refer to [https://docs.onionshare.org/ official documentation] for the latest features and information before use. Advanced users should also consider [https://docs.onionshare.org/2.3.1/en/advanced.html additional features] like saving of tabs, turning off passwords, scheduled start/stop times, command line operations and legacy addresses.

== Security Design ==

'''Table:''' ''OnionShare Security Design'' <ref>https://docs.onionshare.org/2.4/en/security.html</ref>

{| class="wikitable"
|-
! scope="col"| '''Protections'''
! scope="col"| '''Description'''
|-

! scope="row"| Third party access
| Third parties cannot access anything that happens in OnionShare because services are hosted directly on your computer. Filesharing does not utilise online servers, and chat rooms also use your computer as a server; trust in other computers is removed.
|-

! scope="row"| Network eavesdroppers
| Eavesdroppers cannot spy on OnionShare activities in transit because connections between Tor onions services and Tor Browser are encrypted end-to-end. Even malicious Tor nodes used for connections will only see encrypted traffic using the onion service's private key.
|-

! scope="row"| Anonymity
| OnionShare anonymity is protected by Tor. If OnionShare addresses are anonymously communicated with Tor Browser users, then eavesdroppers cannot learn the identity of the OnionShare user.
|-

! scope="row"| Onion service discovery
| Malicious actors cannot access anything just by learning about the onion service; attackers also need to guess the private key used for client authentication (access). <ref>Unless the private key feature is [https://docs.onionshare.org/2.4/en/advanced.html#turn-off-private-key turned off].</ref>
|-

|}

OnionShare cannot protect users if the OnionShare address and private key is not communicated securely. For example, do not share this information via email which can be potentially monitored by attackers. It is far safer to utilize encrypted text messages for this purpose (preferably with disappearing messages enabled), encrypted email, or in-person sharing of this information. This method is not anonymous unless a new email account or chat account is ''only'' created/accessed over Tor.

= Installation =

{{mbox
| type    = notice
| image   = [[File:Ambox_notice.png|40px|alt=Info]]
| text    = OnionShare is not yet installed by default in {{project_name}} 16. It will be considered for inclusion in a future {{project_name}} 16 update because Debian <code>bullseye</code> packages version <code>2.2-3</code> which utilizes v3 onions (v2 onions will be deprecated on 15 October, 2021). <ref>https://packages.debian.org/bullseye/onionshare</ref>
}}

Before installing OnionShare:
* [[Qubes|{{q_project_name}}]] users should consider creating a separate, cloned <code>{{whonix-ws}}-onionshare</code> Template before installing OnionShare/flatpak.
* A separate {{workstation_product_name}} ([[{{q project name short}}|{{q project name}}]]: <code>anon-onionshare</code> App Qube) is also recommended; see footnote. <ref>To clone the existing <code>anon-whonix</code> in [[{{q project name short}}|{{q project name}}]]: 
* <code>Qube Manager</code> &rarr; <code>Right-click on anon-vm</code> &rarr; <code>Select "<u>C</u>lone qube"</code> &rarr; <code>Rename to "anon-onionshare"</code></ref> The reason is the OnionShare installation will persist in this configuration and it is best practice to separate different, anonymous activities in distinct VMs (App Qubes). 
* OnionShare from the Debian stable repository is suitable for most users. Flatpak can be utilized for later OnionShare versions; v2.4 is packaged at the time of writing. <ref>https://flathub.org/apps/details/org.onionshare.OnionShare</ref>
* After installation has finished, follow the [[#Whonix_VM_Configuration|Whonix VM Configuration]] steps.

== Debian Stable Installation ==

{{Install_Package
|package=onionshare
}}

== Flatpak OnionShare Installation ==

{{Flatpak Install|package=
onionshare
}}

= {{project_name}} VM Configuration =
{{onion-grater-warning}}

{{Box|text=
{{Anchor|onion-grater}}
'''1.''' Extend the onion-grater whitelist in {{gateway_product_name}} (<code>{{gateway_product_name_vm}}</code>).

{{Control_Port_Filter_Python_Profile_Add
|filename_new=40_onionshare
}}

'''2.''' Modify the {{workstation_product_name}} (<code>anon-onionshare</code>) user firewall settings and reload them.

{{Firewall Settings Workstation}}

Add. <ref>
As per https://labs.riseup.net/code/issues/7870#note-15 OnionShare uses ports 17600 to 17659.
</ref>

{{CodeSelect|code=
EXTERNAL_OPEN_PORTS+=" $(seq 17600 17659) "
}}

Save.

{{Reload_Firewall_ws}}
}}

= Start OnionShare =

If OnionShare was installed from Debian package sources, launch it in {{workstation_product_name}} by either running the command line interface (CLI) or graphical user interface (GUI) version.

* CLI: {{CodeSelect|code=
onionshare
}}
* GUI: {{CodeSelect|code=
onionshare-gui
}}

If the flatpak version was installed, run.

{{CodeSelect|code=
flatpak run org.onionshare.OnionShare
}}

'''Figure:''' ''First Start of OnionShare v2.4 GUI''

[[Image:Onionsharehomepage.png|border]]

== OnionShare Configuration ==

{{mbox
| image   = [[File:Ambox_warning_pn.svg.png|40px]]
| text    = Do not use the bundled Tor configuration for OnionShare; this would lead to a Tor-over-Tor scenario.
}}

On the first run of OnionShare: <ref>https://docs.onionshare.org/2.3.1/en/tor.html#using-a-system-tor-in-linux</ref>

# Select the settings button/icon (cog symbol) in the GUI.
# Under “How should OnionShare connect to Tor?” choose “Connect using socket file”, and set the socket file to <code>/var/run/tor/control</code>
# Under “Tor authentication options” choose “No authentication, or cookie authentication”.

To test OnionShare is running correctly:
* Click the “Test Tor Settings” button. If all steps were completed correctly, Tor will successfully connect.
* The GUI should say it supports both ephemeral onion services and stealth onion services.

'''Figure:''' ''OnionShare Settings Window''

[[Image:Onionsharenetworktest.png|border]]

== How-to: Use OnionShare ==

Later OnionShare versions have significantly improved functionality:
* Version <code>2.0</code> provides a feature called 'Receive Mode'. With this mode, you can start an onion service and allow other users to upload files to ''you'' via Tor Browser (rather than Share Mode, in which you share files from your OnionShare to others). 
* Version <code>2.2</code> allows the hosting of static HTML websites.
* Version <code>2.3</code> allows users to set up a private, secure chat room that does not require an account and does not log activity.

A complete user guide is available, including advanced topics, hardening options <ref>Such as setting a Shutdown Timer to self-destruct shares if they are not downloaded within an acceptable time window. These topics are beyond the scope of this documentation.</ref> and development documentation; refer to the [https://docs.onionshare.org/ official website]. 

Do not change settings without fully understanding their function, otherwise onion addresses might be re-used, shares might be left open even after multiple downloads are performed, and so on.

=== Share Files ===

Once OnionShare has been installed correctly and the Tor check is successful, sharing files anonymously is easy: <ref>https://docs.onionshare.org/2.3.1/en/features.html</ref>

<blockquote>You can use OnionShare to send files and folders to people securely and anonymously. Open a share tab, drag in the files and folders you wish to share, and click “Start sharing”.
...
When you’re ready to share, click the “Start sharing” button. You can always click “Stop sharing”, or quit OnionShare, immediately taking the website down. You can also click the “↑” icon in the top-right corner to show the history and progress of people downloading files from you. <br />

Now that you have a OnionShare, copy the address and send it to the person you want to receive the files. If the files need to stay secure, or the person is otherwise exposed to danger, use an encrypted messaging app.

That person then must load the address in Tor Browser. After logging in with the random password included in the web address, the files can be downloaded directly from your computer by clicking the “Download Files” link in the corner.</blockquote>

'''Figure:''' ''Select File to Share''

[[Image:Sharefileone.png|border]]

'''Figure:''' ''Secret Onion URL for Downloaders''

[[Image:Sharefiletwo.png|border]]

'''Figure:''' ''OnionShare Download with Tor Browser'' <ref>https://micahflee.com/2018/02/onionshare-has-some-exciting-new-features/</ref>

[[Image:OnionSharereceive.png|border]]

=== Receive Files and Messages ===

Receiving files or messages is also simple: <ref>https://docs.onionshare.org/2.4/en/features.html#receive-files-and-messages</ref>

<blockquote>You can use OnionShare to let people anonymously submit files and messages directly to your computer, essentially turning it into an anonymous dropbox. Open a receive tab and choose the settings that you want.

You can browse for a folder to save messages and files that get submitted.

You can check “Disable submitting text” if want to only allow file uploads, and you can check “Disable uploading files” if you want to only allow submitting text messages, like for an anonymous contact form.</blockquote>

'''Figure:''' ''Receive Files or Messages''

[[Image:Onionsharereceivefiles.png|border]]

=== Website Hosting ===

Website hosting can be achieved in a few steps: <ref>https://docs.onionshare.org/2.4/en/features.html#host-a-website</ref>

<blockquote>To host a static HTML website with OnionShare, open a website tab, drag the files and folders that make up the static content there, and click “Start sharing” when you are ready.

If you add an index.html file, it will render when someone loads your website. You should also include any other HTML files, CSS files, JavaScript files, and images that make up the website. (Note that OnionShare only supports hosting static websites. It can’t host websites that execute code or use databases. So you can’t for example use WordPress.)</blockquote>

This functionality means content can be shared temporarily to select individuals, or it can be run as a public service if desired.

=== Anonymous Chat ===

Finally, private and secure chat rooms (without logging) are possible by: <ref>https://docs.onionshare.org/2.4/en/features.html#chat-anonymously</ref>
# Opening a chat tab and selecting "Start chat server".
# Copy the onion address and private key and send them to the intended recipients. <ref>Preferably with an encrypted messaging application.</ref>
# To join the chat room, participants cut and paste the OnionShare address into Tor Brower; JavaScript is required, so the security level must be set to "Standard" or "Safer".
# After joining, participants are assigned a random name.

The benefit of OnionShare anonymous chat is no copies of messages are left on devices or possibly on servers/databases, and account creation is unnecessary.

== OnionShare AppArmor Profiles ==

AppArmor profiles are available to better contain OnionShare, but they have not yet been tested in {{project_name}}. <ref>https://github.com/micahflee/onionshare/tree/develop/apparmor</ref> Profile development is reported to be lagging behind the master and development branches of the OnionShare git repository. Therefore, willing testers should be knowledgeable about AppArmor profiles before attempting this procedure. 

Advanced users are encouraged to help progress the [https://github.com/micahflee/onionshare/issues/686 open OnionShare AppArmor ticket] and help complete this wiki section. Successes or failures can also be reported in the [http://forums.{{project_onion}}/c/apparmor {{project name}} AppArmor forum].

TODO: Test profiles and expand this section.

= Debugging =

= Footnotes =
{{reflist|close=1}}

{{Footer}}

[[Category:Documentation]]
