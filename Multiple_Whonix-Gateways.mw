{{Header}}
{{#seo:
|description=Compartmentalization. Managing multiple Whonix-Gateways.
}}
{{Maintainer|
|status=stable
|about=About this {{Code2|{{PAGENAME}}}} Page
|difficulty=easy
|maintainer=[https://forums.whonix.org/users/0brand 0brand]
|support=[[Support]]
}}

= Introduction =

{{mbox
| type      = notice
| image   = [[File:Ambox_notice.png|40px|alt=Info]]
| text       ='''Note''': It is far safer and easier to manage multiple Whonix-Gateways when only <u>one</u> is launched for user activities, rather than running many in parallel.
}}


Multiple Whonix-Gateways can be used alongside multiple Whonix-Workstations, but this has both advantages and disadvantages. One security benefit is the isolation of separate Whonix-Gateway VM instances. In the event that one Whonix-Gateway is compromised, it is not certain the other(s) will be similarly compromised. On the downside, newly cloned Whonix-Gateway(s) will end up with a different set of Tor entry guards unless precautions are taken. <ref>Such as manually configuring identical Tor entry guards. Qube-Whonix users can [[Tor#Copy_Tor_Configuration_files_and_Settings_to_Another_sys-whonix_Instance|copy the Tor state folder to another <code>sys-whonix</code>]] instance or use the same [[Bridges]].</ref> <ref>At present, full instructions are not available for every Non-Qubes-Whonix platform.</ref> 

In this configuration ISPs are probably capable of detecting that two different Tor data folders are in use, but this is not necessarily an anonymity threat. Similarly, if multiple Tor Browsers are used with distinct Whonix-Gateways, then a different set of Tor entry guards will be used as well (unless by chance the same Tor guards are chosen for different Whonix-Gateways).

When multiple Whonix-Gateways are run in parallel, the risks explained in the [[Multiple_Whonix-Workstations#Safety_Precautions|Multiple Whonix-Workstations: Safety Precautions]] section equally apply.

= Non-Qubes-Whonix =

{{mbox
| type    = notice
| image   = [[File:Ambox_notice.png|40px|alt=Info]]
| text    ='''Note:''' These instructions only apply to Download/Default-Whonix-Workstations.
}}


{{Non-Qubes-Whonix}}

== KVM ==

In this scenario Workstations will not be able to communicate. This is recommended to keep different Tor activity profiles completely separate from each other. To run multiple Whonix-Gateways you need to clone existing machines. These steps assume an existing Whonix install.

1. Create clones of the Gateway and Workstation VMs rolled back to clean snapshots:

In Virtual Machine Manager:

<pre>
Highlight VM -> Open -> Virtual Machine -> Clone... -> Clone
</pre>

2. Export Whonix's internal network settings:

<pre>
sudo virsh net-dumpxml internal > internal2.xml
</pre>

3. Edit the network configuration to make it unique. Change the '''name''' and '''bridge name'''. Delete the '''mac address''' and '''uuid''' parameters. Alternatively, replace the configuration with the example below (This assumes the only custom networks are Whonix ones):

<pre style="white-space: pre-wrap;">
<network>
  <name>internal2</name>
  <bridge name='virbr3' stp='on' delay='0'/>
</network>
</pre>

Save and exit:

<pre>
CTRL-X
y
CTRL-M
</pre>

Note that virbr1 is assigned to the '''external''' network (NAT NIC), and virbr2 to the '''internal''' network (Whonix NIC), therefore, the network name was changed to '''internal2''' and the bridge name to '''virbr3'''.

4. Import and start the new network:

<pre>
virsh -c qemu:///system net-define internal2.xml
</pre>

<pre>
virsh -c qemu:///system net-autostart internal2
</pre>

<pre>
virsh -c qemu:///system net-start internal2
</pre>

5. Attach the Gateway and Workstation VM NICs to the new network. Make sure one Gateway NIC is attached to the external network. It is important you pay attention and match internal network interfaces to the new ones and not switch to a NIC that connects outside. To edit the VM virtual NIC settings:

<pre>
Highlight VM -> Open -> Settings -> NIC virtual hardware -> Set Network Source to: Virtual network 'internal2' : Isolated network, internal and host routing only
</pre>

Note that the network is exclusively internal and does not communicate with the host in any way.

6. Its recommended that you also [[KVM#Editing_an_imported_Machine.27s_XML_Configuration|edit]] the cloned workstation's configuration and change the pinned CPU's number to a different number (3 or 4) than used by the gateway and primary workstation. Only works if you have a quadcore system.

== VirtualBox ==

In this case, it is necessary to change the Whonix-Gateway network ''interface2'' and Whonix-Workstation network ''interface1'' from internal network <code>Whonix</code> to something else.

= Qubes-Whonix =

It is simple to create additional Whonix-Gateways (<code>sys-whonix</code> instances) in [[Qubes|Qubes-Whonix]]; see 
[[Qubes/Create_Gateway_ProxyVMs|Create Gateway ProxyVMs]].

The only requirement is that the newly created <code>sys-whonix</code> is based on the <code>{{whonix-gw}}</code> TemplateVM and has a <u>distinctive VM name</u>, so it is not confused with other VMs.

= Footnotes =
{{reflist|close=1}}

{{Footer}}

[[Category:Documentation]]
