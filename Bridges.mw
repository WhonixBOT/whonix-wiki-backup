{{Header}}
<!--
Copyright:

   Whonix Bridges wiki page Copyright (C) Amnesia <amnesia at boum dot org>
   Whonix Bridges wiki page Copyright (C) 2012 -2014 Patrick Schleizer <adrelanos@riseup.net>
   
   This program is free software; you can redistribute it and/or modify
   it under the terms of the GNU General Public License as published by
   the Free Software Foundation; either version 3 of the License, or
   (at your option) any later version.
         
   This program is distributed in the hope that it will be useful,
   but WITHOUT ANY WARRANTY; without even the implied warranty of
   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
   GNU General Public License for more details.
      
   You should have received a copy of the GNU General Public License
   along with this program; if not, write to:

    Free Software Foundation, Inc. 
    51 Franklin St, Fifth Floor
    Boston, MA 02110-1301, USA.

On Debian GNU/Linux systems, the complete text of the GNU General Public
License can be found in the /usr/share/common-licenses' directory.
The complete text of the GNU General Public License can also be found online on gnu.org <https://www.gnu.org/licenses/gpl.html>, in Whonix virtual machine images in /usr/share/common-licenses/GPL-3 file or on Github <https://github.com/Whonix/Whonix/blob/master/GPLv3>.
-->
<!--
This wiki page is a fork of the Tails Tor Bridge Mode page, from this exact source <http://git.immerda.ch/?p=amnesia.git;a=blob;f=wiki/src/doc/first_steps/startup_options/bridge_mode.mdwn;hb=b4c1868fc9d59b6a1cb6d0e956ece5c92059c653>.
-->
{{#seo:
|description=Censorship Circumvention. Get around network bans. Using Whonix with (private) (obfuscated) bridges.
}}
= What bridges are and when to use them =
When using Tor with Whonix in its default configuration, anyone who can observe the traffic of your Internet connection (for example your Internet Service Provider and perhaps your government and law enforcement agencies) can know that you are using Tor.

This may be an issue if you are in a country where the following applies:

# '''Using Tor is blocked by censorship:''' since all connections to the Internet are forced to go through Tor, this would render Whonix useless for everything except for working offline on documents, etc.
# '''Using Tor is dangerous or considered suspicious:''' in this case starting Whonix in its default configuration might get you into serious trouble.

Tor bridges, also called Tor bridge relays, are alternative entry points to the Tor network that are not all listed publicly. Using a bridge makes it harder, but not impossible, for your Internet Service Provider to know that you are using Tor.

If you are in one of the situations described above you might want to use Tor bridges in Whonix. Please also read The Tor Project's [https://www.torproject.org/docs/bridges dedicated page about bridges] to get a general idea about what bridges are. Also, learn about [https://www.torproject.org/projects/obfsproxy.html.en how obfsproxy works]. Obfsproxy is the application that Tor uses to connect bridges.

''Bridges are less reliable and tend to have lower performance than other entry points. If you live in a uncensored area, they are not necessarily more secure than entry guards.'' ''Source: [https://lists.torproject.org/pipermail/tor-talk/2012-May/024378.html bridge vs non-bridge users anonymity].''

== If using Tor is dangerous or seems suspicious in your country ==
The Tor Project's [https://www.torproject.org/docs/bridges documentation on bridges] mainly focuses on censorship circumvention (i.e. trying to get around ISP or governments from blocking Tor users). If using Tor is dangerous or considered suspicious in your country, then using bridges may be advisable to prevent you from being identified as a Tor user.

'''Note:''' 'Bridges are important tools that work in many cases but'' '''they are not an absolute protection''' ''against the technical progress that an adversary could do to identify Tor users.''

== Additional info and recommendations ==

1. When Whonix starts for the first time, it won't automatically connect to the public Tor network, which is good. Whonixsetup, which is automatically started, will guide you.

2. Only use [https://www.torproject.org/docs/bridges#PluggableTransports {{Code|obfuscated bridges}}] since they are harder to identify than other bridges.

3. The less publicly known the bridges are, the better. Unfortunately, since some bridge addresses can be obtained by anyone from the Tor website or by email, it is also possible for an adversary to get the same bridge information by the same means. The Tor Project has some protection against that, but they are far from being perfect.

So the best is if you can find a trusted friend or an organization in a different country who runs a {{Code|private obfuscated bridge}} for you. In this case "private" means that the bridge is configured with the option {{Code|PublishServerDescriptor 0}}. Without this option The Tor Project can learn about the bridge and may distribute its address to others and so it could end up in the hands of your adversary.

See also [[Hide Tor and Whonix from your ISP]]!

= Finding a bridge and choosing the right protocol =
In order to use bridges, you must know in advance the address of at least one bridge. It is preferable to have a private obfuscated bridge because the alternative (public obfuscated bridges) have a greater likelihood of being censored, simply due to the fact that public obfuscated bridges are by their very nature publicly listed. The Tor Project distributes public bridge addresses in several ways, for example from their [https://bridges.torproject.org/ website] and via email. The easiest way to find a list of public bridges is from [https://bridges.torproject.org/options The Tor Project Bridge Database]

As of August 2015, according to The Tor Project, "obfs3 is currently the recommend type, but depending on where you are located another type may work better for you." [https://www.torproject.org/docs/bridges.html.en#5a%29] The Tor Project provides a database of [https://bridges.torproject.org/bridges?transport=obfs3 public obfs3 bridges] A more exhaustive list of public obfuscated bridges is available at [https://bridges.torproject.org/options The Tor Project Bridge Database]. It is not recommended to use obfs and obfs2 bridges, which "are now deprecated and were replaced by obfs3, scramblesuit, fte, and obfs4."[https://www.torproject.org/docs/bridges.html.en#PluggableTransports]



= How to use bridges in Whonix =
== Using obfuscated, (private) and/or ordinary bridges ==
Whonix does not yet include a wizard that guides you through the process of setting up bridges before connecting to Tor. You must add bridges manually to {{Code2|/etc/tor/torrc}}. 

({{Code|Private}}) Ordinary, {{Code|obfs2}}, {{Code|obfs3}} and {{Code|obfs4}} bridges can currently be configured on Whonix-Gateway the same way they would be configured when not using Whonix, i.e. just like on a server without graphical user interface. This is done by editing /etc/tor/torrc within the Whonix-Gateway.  See [https://github.com/Whonix/anon-gw-anonymizer-config/blob/master/etc/tor/torrc example for editing /etc/tor/torrc]

'''If you are using Qubes-Whonix''', complete the following steps to add obfuscated bridges:
<pre>
Qubes App Launcher (blue/grey "Q") --> Whonix-Gateway (commonly named whonix-gw) --> Terminal
</pre>

Edit {{Code2|/etc/tor/torrc}}
<pre>
sudo nano /etc/tor/torrc
</pre>

Once inside {{Code2|/etc/tor/torrc}}, scoll all the way to the bottom, and copy-paste the following text:
<pre>
UseBridges 1
ClientTransportPlugin obfs2,obfs3 exec /usr/bin/obfsproxy managed
ClientTransportPlugin obfs4 exec /usr/bin/obfs4proxy managed
</pre>

Now you must add the IP addresses for your bridges. If you don't know a private bridge, get a [https://bridges.torproject.org/bridges?transport=obfs3 list of obf3 obfuscated bridges from The Tor Project]. The obf3 protocol is currently recommended by Tor. [https://www.torproject.org/docs/bridges.html.en#5a%29] However, if you want a more exhaustive list of public obfuscated bridges, go to [https://bridges.torproject.org/options The Tor Project Bridge Database]

Copy-paste the IP addresses at the bottom of {{Code2|/etc/tor/torrc}}.  Now make sure to manually add the text "bridge" at the beginning of each line entry.

Example of text to add to {{Code2|/etc/tor/torrc}}. '''Note:''' do not copy-paste this list; these IP's will not work. [https://bridges.torproject.org/bridges?transport=obfs3 Get your own IP's from Tor]):
<pre>
bridge obfs3 109.195.132.77:22321
bridge obfs3 55.32.27.22:38123 
bridge obfs3 192.24.131.513:62389 
</pre>

Now save and exit{{Code2|/etc/tor/torrc}}
<pre>
<Ctrl-X> --> press Y --> <Enter>
</pre>

Whonix-Gateway and any dependent AppVMs now must be shutdown and restarted for the changes to take effect. 


'''If you are using a graphical Whonix-Gateway''', for more documentation and examples, see:

<pre>
Start Menu -> Applications -> Settings -> /etc/tor/torrc.examples
</pre>

To edit your {{Code2|/etc/tor/torrc}}.

<pre>
Start Menu -> Applications -> Settings -> /etc/tor/torrc
</pre>

After editing your {{Code2|/etc/tor/torrc}} you must reload Tor so your changes take effect.

<pre>
Start Menu -> Applications -> Settings -> Reload Tor
</pre>

'''If you are using a terminal-only Whonix-Gateway''', click on expand on the right side.
<div class="toccolours mw-collapsible mw-collapsed" style="width:800px">
<div class="mw-collapsible-content">
For more documentation and examples, see:

<pre>
nano /etc/tor/torrc.examples
</pre>

To edit your {{Code2|/etc/tor/torrc}}.

<pre>
sudo nano /etc/tor/torrc
</pre>

After editing your {{Code2|/etc/tor/torrc}} you must reload Tor so your changes take effect.

<pre>
sudo service tor reload
</pre>

</div>
</div>

If you would like to see an example using {{Code|obfs3}} bridges, click on expand on the right.
<div class="toccolours mw-collapsible mw-collapsed" style="width:800px">
<div class="mw-collapsible-content">
You cannot use the example bridge {{Code2|141.201.27.48:420}} below, because it's only an example. You still need to find your own bridges as explained in {{Code2|[https://github.com/Whonix/anon-gw-anonymizer-config/blob/master/etc/tor/torrc.examples /etc/tor/torrc.examples]}}.
<pre>
UseBridges 1
ClientTransportPlugin obfs2,obfs3 exec /usr/bin/obfsproxy managed
bridge obfs3 141.201.27.48:420 4352e58420e68f5e40bf7c74faddccd9d1349413
</pre>
</div>
</div>

If you would like to see an example using {{Code|obfs4}} bridges, click on expand on the right.
<div class="toccolours mw-collapsible mw-collapsed" style="width:800px">
<div class="mw-collapsible-content">
Requires Whonix 11 or higher.

You cannot use the example bridge {{Code2|141.201.27.48:420}} below, because it's only an example. You still need to find your own bridges as explained in {{Code2|[https://github.com/Whonix/anon-gw-anonymizer-config/blob/master/etc/tor/torrc.examples /etc/tor/torrc.examples]}}.
<pre>
UseBridges 1
ClientTransportPlugin obfs4 exec /usr/bin/obfs4proxy managed
Bridge obfs4 141.201.27.48:420 gibberish cert=more-gibberish iat-mode=0
</pre>
</div>
</div>

{{Code|scramblesuit}}: In short, forget about it. Use the above {{Code|obfs4}}. More more information, click on expand on the right.
<div class="toccolours mw-collapsible mw-collapsed" style="width:800px">
<div class="mw-collapsible-content">
[https://labs.riseup.net/code/issues/7909#note-8 Quote intrigeri] (Tails developer):
<blockquote>
On tor-talk we've been told "You shouldn't prioritise ScrambleSuit because it's superseded by obfs4", and there are now pressing plans in the Tor Project to deprecate obfs2 and obfs3 in favour of obfs4. Hence rejecting this ticket, and focusing on #7980 instead.
</blockquote>


AppArmor issue. Probably not been reported anywhere yet.
<pre>
audit: type=1400 audit(1439818522.818:9): apparmor="DENIED" operation="mkdir" profile="/usr/bin/obfsproxy" name="/var/lib/tor/pt_state/scramblesuit/" pid=11163 comm="obfsproxy" requested_mask="c" denied_mask="c" fsuid=106 ouid=106
</pre>

<pre>
ClientTransportPlugin obfs2,obfs3,scramblesuit exec /usr/bin/obfsproxy managed
Bridge scramblesuit 141.201.27.48:420 gliberish password=more-gliberish
</pre>
</div>
</div>

= Flash Proxy Bridges =
<div class="toccolours mw-collapsible mw-collapsed" style="width:800px">
'''Untested!'''

'''Unfinished!'''

This has NOTHING to do with Adobe Flash.

If you would like to see the unfinished documentation, please press on expand on the right.
<div class="mw-collapsible-content">
Should work in Whonix-Gateway as well, but require some fiddling. See also [https://sourceforge.net/p/whonix/discussion/general/thread/729ba238/ Forum topic].

1. Enable port forwarding from your host operating system to Whonix-Gateway. Enter this command in a terminal on the host.

<pre>VBoxManage modifyvm "Whonix-Gateway" --natpf1 "9000",tcp,127.0.0.1,9000,,9000</pre>

2. Create a file /etc/whonix_firewall.d/50_user (Or if you using a graphical Whonix-Gateway, you can use the desktop shortcut.)

<pre>kdesudo kwrite /etc/whonix_firewall.d/50_user</pre>

3. Add the following content.

<pre>
GATEWAY_ALLOW_INCOMING_FLASHPROXY=1
FLASHPROXY_PORT=9000
</pre>

4. Reload Whonix Firewall. (Or if you using a graphical Whonix-Gateway, you can use the desktop shortcut.)

<pre>sudo whonix_firewall</pre>

5. Install flashproxy.

Ok, this is a bit tricky, since there is no Debian package with the flashproxy-client. <ref>feature request: [https://trac.torproject.org/projects/tor/ticket/8092 make a deb of flashproxy and get into Debian]</ref>

Either get it from here:
https://crypto.stanford.edu/flashproxy/#how-to

Or...

Go to the [https://blog.torproject.org/ Tor Blog] and look for the latest pluggable transports bundle. This has not been documented yet:
https://github.com/Whonix/Whonix/issues/53

6. Set up a Port Forwarding from your Router to your Computer

https://trac.torproject.org/projects/tor/wiki/FlashProxyHowto#Settingupportforwarding
</div>
</div>

= Using Tor / Pluggable Transports from the Tor Browser Bundle =
'''Untested!'''

'''Unfinished!'''

https://phabricator.whonix.org/T116

Install the Tor Browser Updater by Whonix developers ({{Code2|tb-updater}}). <ref>https://github.com/Whonix/tb-updater</ref> <ref>[[Tor Browser]]</ref> <ref>
Using <code>--no-install-recommends</code> to prevent installing {{Code2|[https://github.com/Whonix/tb-starter tb-starter]}} and {{Code2|[https://github.com/Whonix/tb-default-browser tb-default-browser]}}.
</ref>

<pre>
sudo apt-get install --no-install-recommends tb-updater
</pre>

Create a new home folder for user debian-tor.

<pre>
sudo mkdir /home/user/debian-tor
</pre>

Fix permissions.

<pre>
sudo chown --recursive debian-tor:debian-tor /home/user/debian-tor
</pre>

Allow login as user debian-tor by modifying it's default shell {{Code2|false}} to {{Code2|/bin/bash}}.

<pre>
sudo usermod debian-tor -s /bin/bash
</pre>

Login as user debian-tor.

<pre>
sudo su debian-tor
</pre>

Change directory into {{Code2|/home/debian-tor}}. (Do not use {{Code|~}}. <ref>Because that is set to /var/lib/tor for user debian-tor.</ref>)

<pre>
cd /home/debian-tor
</pre>

Download and install Tor Browser.

<pre>
update-torbrowser
</pre>

Security warning: Do not start Tor Browser on Whonix-Gateway for any purpose other than configuring Tor. Use Whonix-Workstation to browse the web using [[Tor Browser]].

Apply Whonix's Tor config to TBB.

<pre>
cp /usr/share/tor/tor-service-defaults-torrc /home/debian-tor/tor-browser_en-US/Browser/TorBrowser/Data/Tor/torrc-defaults
</pre>

TODO for developers:

* Install tb-updater by default on Whonix-Gateway?
* Install Tor Browser by default on Whonix-Gateway?

<pre>
mv /home/debian-tor/tor-browser_en-US/Browser/TorBrowser/Data/Tor/torrc-defaults /home/user/debian-tor
</pre>

Eventual apparmor issues? Copy is better?

<pre>
ln -s /usr/share/tor/tor-service-defaults-torrc /home/debian-tor/tor-browser_en-US/Browser/TorBrowser/Data/Tor/torrc-defaults
</pre>

= Footnotes =
<references />

= License =
<pre>Whonix Bridges wiki page Copyright (C) Amnesia <amnesia at boum dot org>
Whonix Bridges wiki page Copyright (C) 2012 -2014 Patrick Schleizer <adrelanos@riseup.net>

This program comes with ABSOLUTELY NO WARRANTY; for details see the wiki source code.
This is free software, and you are welcome to redistribute it
under certain conditions; see the wiki source code for details.</pre>

{{Footer}}

[[Category:Documentation]]
