<translate>

{{Header}}
<!--
Copyright:

   Whonix Bridges wiki page Copyright (C) Amnesia <amnesia at boum dot org>
   Whonix Bridges wiki page Copyright (C) 2012 - 2017 Patrick Schleizer <adrelanos@riseup.net>
   
   This program is free software; you can redistribute it and/or modify
   it under the terms of the GNU General Public License as published by
   the Free Software Foundation; either version 3 of the License, or
   (at your option) any later version.
         
   This program is distributed in the hope that it will be useful,
   but WITHOUT ANY WARRANTY; without even the implied warranty of
   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
   GNU General Public License for more details.
      
   You should have received a copy of the GNU General Public License
   along with this program; if not, write to:

    Free Software Foundation, Inc. 
    51 Franklin St, Fifth Floor
    Boston, MA 02110-1301, USA.

On Debian GNU/Linux systems, the complete text of the GNU General Public
License can be found in the /usr/share/common-licenses' directory.
The complete text of the GNU General Public License can also be found online on gnu.org <https://www.gnu.org/licenses/gpl.html>, in Whonix virtual machine images in /usr/share/common-licenses/GPL-3 file or on Github <https://github.com/Whonix/Whonix/blob/master/GPLv3>.
-->
<!--
This wiki page is a fork of the Tails Tor Bridge Mode page, from this exact source <http://git.immerda.ch/?p=amnesia.git;a=blob;f=wiki/src/doc/first_steps/startup_options/bridge_mode.mdwn;hb=b4c1868fc9d59b6a1cb6d0e956ece5c92059c653>.
-->
{{#seo:
|description=Censorship Circumvention. Get around network bans. Using Whonix with (private) (obfuscated) bridges. Useful in case your Internet Service Provider (ISP) bans or throttles connections to the Tor public network.
|image=https://www.whonix.org/w/images/8/85/Black-and-white-50272-640.jpg
}}
= Bridges: Description and When to Use Them =
When Tor is used with Whonix in the default configuration, anybody observing the flow of network traffic from the Internet connection can determine that Tor is being used. Potential observers include the Internet Service Provider (ISP), advanced adversaries, censorship enforcement bodies, and other interested parties.

This may be a problem for users residing in certain countries. For instance:

# '''Tor use is blocked by censorship:''' Since all Internet traffic is routed through Tor, Whonix would be rendered useless for most activities except working offline on documents, etc.
# '''Tor use is dangerous or considered suspicious:''' Starting Whonix in the default configuration might land the user in serious trouble.


Tor bridges ("Tor bridge relays") are alternative entry points to the Tor network, not all of which are listed publicly. Using a bridge makes it harder, but not impossible, for the ISP to determine a user is connecting to Tor.

Users facing one of the situations described above should consider using Tor bridges in Whonix. Prior to taking this step, please read The Tor Project's [https://www.torproject.org/docs/bridges dedicated page about bridges] to get a better understanding of bridges and their operation. Users should also learn [https://www.torproject.org/projects/obfsproxy.html.en how Obfsproxy works], since it is the application that Tor uses to connect bridges.

Bridges are not bullet-proof. Here is a reminder regarding bridge versus non-bridge anonymity: <ref>https://lists.torproject.org/pipermail/tor-talk/2012-May/024378.html</ref>

<blockquote>Bridges are less reliable and tend to have lower performance than other entry points. If you live in a uncensored area, they are not necessarily more secure than entry guards.</blockquote>

{{Just Connectivity}} See [[#Better Connectivity without real Censorship Circumvention]].

== If Tor Use is Dangerous or Deemed Suspicious in your Location ==
{{mbox
| image   = [[File:Ambox_warning_pn.svg.png|40px]]
| text       = 
'''Warning:''' Bridges are important tools that work in many cases but they are <u>not</u> an absolute protection against the technical progress an adversary might make in identifying Tor users.
}}


The Tor Project's [https://www.torproject.org/docs/bridges documentation on bridges] mainly focuses on censorship circumvention, that is, overcoming attempts by ISPs or governments to block Tor use. If Tor use is dangerous or deemed suspicious in your location, then using bridges <i>may</i> be advisable to prevent identification as a Tor user.

== Additional Information and Recommendations ==
{{mbox
| type      = notice
| image   = [[File:Ambox_notice.png|40px|alt=Info]]
| text       = When Whonix starts for the first time, it <u>will not</u> automatically connect to the public Tor network, which is beneficial for safety reasons. Users are guided by the Whonix Setup Wizard, which is automatically started.
}}


When deciding on what kind of bridge to configure, it is recommended to:

* Only use [https://www.torproject.org/docs/bridges#PluggableTransports {{Code2|obfuscated bridges}}], since they are harder to identify than other bridges.
* Use less publicly known bridges, since it is safer. <ref>Some bridge addresses are freely provided by the Tor website or by email upon request, meaning adversaries likely use these methods to obtain bridge information. The Tor Project has some protection against adversary threats, but they are far from perfect.</ref>
* Consider whether [[Hide Tor and Whonix from your ISP|Hiding Tor and Whonix from your ISP]] is advisable in your circumstances.
* Avoid using a meek provider that also runs DNS core servers, like Google's (now defunct) bridge. <ref>Google sees forty percent of Tor Exits' DNS traffic and so using them as a bridge aids website fingerprinting attacks. That said, there is evidence that website fingerprinting is more difficult to mount than previously thought. See: [https://nymity.ch/tor-dns/tor-dns.pdf The Effect of DNS on Torâ€™s Anonymity]</ref>
* For greater safety, use a {{Code2|private obfuscated bridge}} bridge run by a trusted friend or organization in a different country. In this case "{{Code2|private}}" means that the bridge is configured with the option {{Code2|PublishServerDescriptor 0}}. <ref>
[https://www.torproject.org/docs/tor-manual.html.en#PublishServerDescriptor Tor manual: PublishServerDescriptor] 
Without this option set, The Tor Project can learn about the bridge and may distribute its address to others, potentially handing this information to an adversary seeking to generate a list of all known bridges.</ref>

= Finding a Bridge and Choosing the Right Protocol =
In order to use bridges, the address of at least one bridge must be known in advance. It is preferable to have a {{Code2|private obfuscated bridge}} because the alternative - {{Code2|public obfuscated bridges}} - have a greater likelihood of being censored, since they are publicly listed. The Tor Project distributes {{Code2|public bridge}} addresses in several ways, including from their [https://bridges.torproject.org/ website] and via email. The easiest way to find a list of public bridges is from [https://bridges.torproject.org/options The Tor Project Bridge Database].

As of early 2017, The Tor Project advice is that the recommended bridge type has been changed: <ref>https://trac.torproject.org/projects/tor/ticket/18072</ref>

<blockquote>... in Tor Browser to obfs4, given that we now have several high capacity obfs4 bridges and obfs4 is more likely to work in more regions than obfs3."
</blockquote>
As time goes on and more {{Code2|obfs4}} bridge operators go online, it may be preferable to use {{Code2|obfs4}} instead of {{Code2|obfs3}}, as {{Code2|obfs4}}: <ref>https://blog.torproject.org/blog/recent-and-upcoming-developments-pluggable-transports#obfs2_deprecation</ref>
<blockquote> ... should be able to defend more effectively against active probing.</blockquote>

The Tor Project provides a database of [https://bridges.torproject.org/bridges?transport=obfs3 {{Code2|public obfs3 bridges}}] and [https://bridges.torproject.org/bridges?transport=obfs4 {{Code2|public obfs4 bridges}}] A more exhaustive list of public obfuscated bridges is available at [https://bridges.torproject.org/options The Tor Project Bridge Database]. It is not recommended to use {{Code2|obfs}} and {{Code2|obfs2}} bridges, which: <ref>https://www.torproject.org/docs/bridges.html.en#PluggableTransports</ref> 
<blockquote>... are now deprecated and were replaced by {{Code2|obfs3}} . . . and {{Code2|obfs4}}.</blockquote>
Do not select the "IPv6 compatible" check box when [https://bridges.torproject.org/options sourcing bridges] from the database, as they [https://phabricator.whonix.org/T509 cannot be used in Whonix] yet.

= How to Use Bridges in Whonix =
== Introduction ==
This section will explain how to use obfuscated bridges in Whonix.

{{mbox
| type      = notice
| image   = [[File:Ambox_notice.png|40px|alt=Info]]
| text       = '''Tip:''' Until Whonix 14 is released, there is no wizard available to help set up bridges before connecting to Tor. The graphical [[Tor_Browser#tor-launcher_vs_torbrowser-launcher|tor-launcher]] ([[Dev/tor-launcher|screenshots]]) that some users might know from The Tor Project's Tor Browser cannot be used in Whonix. 
}}


{{Code2|obfs2}}, {{Code2|obfs3}} and {{Code2|obfs4}} bridges can currently be configured on Whonix-Gateway. From Whonix 14, {{Code2|meek}} bridges can also be used on Whonix-Gateway. The process is identical to the steps completed on a Debian platform because [[About#Based_on_Debian|Whonix is based on Debian]]. From Whonix 14, bridges can be configured easily using [[Anon_Connection_Wizard|Anon Connection Wizard]]. Alternatively, for all Whonix versions, Tor bridges can be configured by editing {{Code2|/etc/tor/torrc}} within the Whonix-Gateway. Click the expand button to see instructions for each method.

== Option 1: Use {{Code2|Anon Connection Wizard}} ==

<div class="toccolours mw-collapsible mw-collapsed">
<div class="mw-collapsible-content">
=== Step 1: Start Anon Connection Wizard ===
{{Start_Anon_Connection_Wizard}}

=== Step 2: Use bridge configuration page ===
{{Anon_Connection_Wizard_Use_Bridges}}
</div>
</div>

== Option 2: Edit {{Code2|/etc/tor/torrc}}  ==

<div class="toccolours mw-collapsible mw-collapsed">
<div class="mw-collapsible-content">

=== Step 1: Access {{Code2|/etc/tor/torrc}} to Add Bridges ===
{{Open_/etc/tor/torrc}}

=== Step 2: Edit {{Code2|/etc/tor/torrc}} ===

{{mbox
| type      = notice
| image   = [[File:Ambox_notice.png|40px|alt=Info]]
| text       = This step is the same on all Whonix platforms.
}}


Once inside {{Code2|/etc/tor/torrc}}, scroll all the way to the bottom of the file. Copy and paste the following text.
{{CodeSelect|code=
UseBridges 1
ClientTransportPlugin obfs2,obfs3 exec /usr/bin/obfsproxy managed
ClientTransportPlugin obfs4 exec /usr/bin/obfs4proxy
}}

Begin with Whonix 14, meek bridges can also be used. To use it, simply add one more line to the {{Code2|/etc/tor/torrc}}. Notice that the bridge type is actually called {{Code2|meek_lite}}, not {{Code2|meek}} which is used in Tor Browser Bundle.

<ref>
Because {{Code2|meek_lite}} is actually using a different implementation by {{Code2|obfs4proxy}}. Forum discussion: https://forums.whonix.org/t/censorship-circumvention-tor-pluggable-transports/2601/3
</ref>

{{CodeSelect|code=
ClientTransportPlugin meek_lite exec /usr/bin/obfs4proxy
}}



<ref>
{{CodeSelect|code=
ClientTransportPlugin fte exec /usr/bin/fteproxy --managed
}}
</ref>

Now add the bridge IP addresses you discovered in the section [[#Finding_a_bridge_and_choosing_the_right_protocol|Finding a Bridge and Choosing the Right Protocol]] to the file.

Copy and paste those IP addresses to the very bottom of {{Code2|/etc/tor/torrc}}, <u>after the ClientTransportPlugin entries</u>. Make sure to manually type the text "bridge" at the beginning of each line entry.

In the <i>obfs3</i> and <i>obfs4</i> examples below:
* '''Do not copy and paste this list of bridge entries to the torrc file.''' They will not work.
* Make sure to have already retrieved your own [https://bridges.torproject.org/bridges?transport=obfs3 obfs3 bridges] or better yet [https://bridges.torproject.org/bridges?transport=obfs4 obfs4 bridges] from The Tor Project.
* Use '''either''' the <i>obfs3</i> or <i>obfs4</i> protocol, not both.
* '''Capitalization in the torrc file matters.''' For example, bridges will not connect if you type "Bridge" instead of "bridge".


{{Code2|Obfs3}} example text to add to {{Code2|/etc/tor/torrc}}.

{{CodeSelect|code=
bridge obfs3 109.195.132.77:22321 4352e58420e68f5e40bf7c74faddccd9d1349413
bridge obfs3 55.32.27.22:38123  4352e58420e68f5e40bf7c74faddccd9d1349413
bridge obfs3 192.24.131.513:62389 4352e58420e68f5e40bf7c74faddccd9d1349413
}}

{{Code2|Obfs4}} example text to add to {{Code2|/etc/tor/torrc}}.

{{CodeSelect|code=
bridge obfs4 192.235.207.85:42086 0EEB10BF4B4FAF56D46E cert=oue8sYYw5wi4n3mf2WDOg iat-mode=0
bridge obfs4 34.218.26.20:43263 DD21A551767816A0C9495 cert=7qzS6KASquPvJU82Fm7qoJw iat-mode=0
bridge obfs4 161.217.177.95:10703 B3B8009D01BB7E5FDFAEC cert=4RaIqGiOytEXm6Hw iat-mode=0
}}

{{Code2|meek_lite}} example text to add to {{Code2|/etc/tor/torrc}}.

{{CodeSelect|code=
bridge meek_lite 0.0.2.0:2 B9E7141C594AF25699E0079C1F0146F409495296 url=https://d2cly7j4zqgua7.cloudfront.net/ front=a0.awsstatic.com
}}


<ref>
{{Code2|fte}} example text to add to {{Code2|/etc/tor/torrc}}. 

fte is not yet supported in Whonix 13; wait for the Whonix 14 release. https://phabricator.whonix.org/T520
{{CodeSelect|code=
bridge fte 10.200.100.60:95128 4352e58420e68f5e40bf7c74faddccd9d1349413
bridge fte 300.100.300.80:23521 4352e58420e68f5e40bf7c74faddccd9d1349413
}}
</ref>

When {{Code2|/etc/tor/torrc}} editing is finished, save and exit.

<pre>
<Ctrl-X> --> press Y --> <Enter>
</pre>

The sample text for a complete {{Code2|obfs4}} torrc file is below. Check your file is similar, except for the specific bridge entries.
<pre>
# This file is part of Whonix
# Copyright (C) 2012 - 2013 adrelanos
# See the file COPYING for copying conditions.

# Use this file for your user customizations.
# Please see /etc/tor/torrc.examples for help, options, comments etc.

# Anything here will override Whonix's own Tor config customizations in /usr/share/tor/tor-service-defaults-torrc

# Enable Tor through whonixsetup or manually uncomment "DisableNetwork 0" by
# removing the # in front of it.
DisableNetwork 0
UseBridges 1
ClientTransportPlugin obfs2,obfs3 exec /usr/bin/obfsproxy managed
ClientTransportPlugin obfs4 exec /usr/bin/obfs4proxy

bridge obfs4 192.235.207.85:42086 0EEB10BF4B4FAF56D46E cert=oue8sYYw5wi4n3mf2WDOg iat-mode=0
bridge obfs4 34.218.26.20:43263 DD21A551767816A0C9495 cert=7qzS6KASquPvJU82Fm7qoJw iat-mode=0
bridge obfs4 161.217.177.95:10703 B3B8009D01BB7E5FDFAEC cert=4RaIqGiOytEXm6Hw iat-mode=0
</pre>

<ref>
<pre>
ClientTransportPlugin fte exec /usr/bin/fteproxy --managed
</pre>
</ref>

=== Step 3: Enable Tor ===
Follow this procedure if it has not been previously completed.

{{Enable_Tor}}

=== Step 4: Have {{Code2|/etc/tor/torrc}} Changes Take Effect ===
{{Reload_Tor}}
</div>
</div>

= Troubleshooting =
== Check Tor Network Connection is Using a Tor Bridge ==
Concerned bridge users can complete a simple check.

1. Open [[Tor_Controller#Arm|Arm]] as follows.

{{Start_Arm}}

2. Use the right arrow button to navigate to page 2 of 5 in Arm.

3. If a bridge is in use, the circuit information will be similar to this.

<pre>
192.168.0.1 UNKNOWN 1 / Guard
</pre>

4. If a bridge is ''not'' in use, the circuit information will be similar to this.
<pre>
IP Nickname 1 / Guard
</pre>
The IP is the real IP (''not'' 192.168.0.1) of the Guard, and the Nickname is the name of that Guard relay.

5. Exit Arm by pressing the following.
<pre>
q
q
</pre>

== Connection Issues ==
After configuration, connection problems can relate to firewall settings that block outgoing connections to the ports provided by the bridge. To check the {{Code2|port}} the bridge is using, see the following example.

<pre>
bridge 109.195.132.77:22321
</pre>

In this example, the IP address is {{Code2|109.195.132.77}}, while the the port is {{Code2|22321}}.

Try using a (private) (obfuscated) bridge that uses port {{Code2|80}} or {{Code2|443}}, as these ports are mostly used for web browsing and therefore usually unblocked.

== Trying Packet Size and Timing Obfuscation for obfs4 ==

If a provided {{Code2|obfs4}} bridge doesn't work, the user can try enabling packet size and timing obfuscation by changing the <code>iat-mode</code> value in each last line to either <code>1</code> or <code>2</code>. <ref>
 1 = Enabled: ScrambleSuit-style with bulk throughput optimizations.
 2 = Paranoid: Each IAT write will send a length sampled from the length distribution (expensive). See: https://lists.torproject.org/pipermail/tor-commits/2014-August/079402.html</ref>

== Better Connectivity Without Real Censorship Circumvention ==

{{Just Connectivity}}

The following will limit Tor to establish only connections to the public Tor network relays that listen on ports {{Code2|80}} and {{Code2|443}}.

{{Open /etc/tor/torrc}}

Add. <ref>
https://www.torproject.org/docs/tor-manual.html.en#FascistFirewall
</ref>

{{CodeSelect|code=
FascistFirewall 1
}}

Save.

{{Reload Tor}}

Done.

== Missing ClientTransportPlugin Line ==
When one is using.

{{CodeSelect|code=
bridge obfs4 ...:... ... cert=... iat-mode=0
}}

But forgot to add the corresponding line.

{{CodeSelect|code=
ClientTransportPlugin obfs4 exec /usr/bin/obfs4proxy
}}

Then only a warning will be shown in the logs.

<pre>
[warn] We were supposed to connect to bridge '...:...' using pluggable transport 'obfs4', but we can't find a pluggable transport proxy supporting 'obfs4'. This can happen if you haven't provided a ClientTransportPlugin line, or if your pluggable transport proxy stopped running.
</pre>

== Missing ClientTransportPlugin Executable ==
<pre>
[warn] Could not launch managed proxy executable at '/usr/bin/obfs4proxy' ('No such file or directory').
</pre>

= Deprecated Tor Pluggable Transports =
=== Scramblesuit ===
{{Code2|scramblesuit}}: Not recommended (see footnote). Use the provided {{Code2|obfs4}} instructions instead. <ref>
[https://labs.riseup.net/code/issues/7909#note-8 Quote intrigeri] (Tails developer):
<blockquote>
On tor-talk we've been told "You shouldn't prioritise ScrambleSuit because it is superseded by obfs4", and there are now pressing plans in the Tor Project to deprecate obfs2 and obfs3 in favour of obfs4. Hence rejecting this ticket, and focusing on [https://labs.riseup.net/code/issues/7980 #7980] [obfs4 support] instead.
</blockquote>

[https://blog.torproject.org/blog/recent-and-upcoming-developments-pluggable-transports Also see Tor Announcement under heading "obfs4 and scramblesuit"]

* Old instructions: [[Deprecated#scramblesuit]]
</ref>

=== Flashproxy ===
{{Code2|flashproxy}}: Not recommended (see footnote). Use the provided {{Code2|obfs4}} instructions instead. <ref>
[https://trac.torproject.org/projects/tor/ticket/17428 Flashproxy has been removed from Tor Browser.] Therefore it can be considered deprecated.

* Old instructions: [[Deprecated#flashproxy]]
* Old development notes: [[Dev/Flash_Proxy]]
</ref>

= See Also =
* [[Lantern]]: An alternative censorship circumvention tool documented for [[Qubes-Whonix]] only.
* ''Unfinished'': [[Censorship Circumvention Tools]] other than bridges.
* ''Unfinished'': [[Deprecated#Using_Tor_.2F_Pluggable_Transports_from_the_Tor_Browser_Bundle|Using Tor / Pluggable Transports from the Tor Browser Bundle]].

= Footnotes =
<references />

= License =
{{License_Amnesia|{{FULLPAGENAME}}}}

{{Footer}}

[[Category:Documentation]]
</translate>
