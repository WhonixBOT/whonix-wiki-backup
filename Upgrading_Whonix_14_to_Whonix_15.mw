{{Header}}
{{#seo:
|description=How to Release Upgrade from Whonix 14 to Whonix 15
|image=https://www.whonix.org/w/images/d/d3/Upgrade.jpg
}}

{{mbox
| image   = [[File:Ambox_warning_pn.svg.png|40px]]
| text    = 
Untested! Do not use yet!
}}

__NOINDEX__

{{Box|text=
* The instruction on this page are describing how to perform a [[Release Upgrade]] from Whonix 14 to Whonix 15.
* For standard ("everyday") upgrade instructions see [[Operating System Software and Updates]].
}}

{{mbox
| type    = notice
| image   = [[File:Ambox_notice.png|40px|alt=Info]]
| text    = To use Whonix 15, users can either:

* '''A)''' upgrade existing Whonix 14 templates <u>OR</u>,
* '''B)''' re-install Whonix by [[Download|downloading the new release]], which is much simpler than upgrading.
}}


{{mbox
| image   = [[File:Ambox_warning_pn.svg.png|40px]]
| text    = Note to users of [[Qubes-Whonix]]: [https://www.qubes-os.org/news/2019/03/28/qubes-3-2-has-reached-eol/ Qubes OS 3.2 has reached End Of Life.] If you are using Qubes R3.2 or Qubes R3.2.1, upgrades are [[unsupported]].
}}

= High Level Overview =

# Backup your data - ideally have a copy of the VM so it is possible to try again (if necessary). <br />
# Consider running the optional [[#Sanity Tests|sanity tests]]. <br />
# Upgrade Whonix-Workstation (<code>whonix-ws-14</code>). <br />
# Power off Whonix-Workstation (<code>whonix-ws-14</code>). <br />
# Upgrade Whonix-Gateway (<code>whonix-gw-14</code>). <br />
# Restart Whonix-Gateway (<code>whonix-gw-14</code>). <br />
# Restart Whonix-Workstation (<code>whonix-ws-14</code>). <br />

= Sanity Tests =
<div class="toccolours mw-collapsible mw-collapsed">
These are optional, but recommended. To complete sanity tests, please press on expand on the right.
<div class="mw-collapsible-content">
{{CodeSelect|code=
sudo dpkg --audit ; echo $?
}}

Expected output.

{{CodeSelect|code=
0
}}

{{CodeSelect|code=
sudo dpkg --configure -a ; echo $?
}}

Expected output.

{{CodeSelect|code=
0
}}

[[Security_Guide#Updates|Get package upgrades.]]

{{CodeSelect|code=
sudo apt-get update
}}

{{CodeSelect|code=
sudo apt-get dist-upgrade
}}

For testing purposes, install python-qt4.

{{CodeSelect|code=
sudo apt-get install python-qt4 ; echo $?
}}

{{CodeSelect|code=
## ... successful installation of python-qt4 ...
0
}}
</div>
</div>

= Upgrading =

== Introduction ==

{{mbox
| type      = notice
| image   = [[File:Ambox_notice.png|40px|alt=Info]]
| text       = Downloading a new Whonix-Gateway / Whonix-Workstation is easier than applying the following upgrade instructions, but this process should be relatively smooth.
}}


Both [[Non-Qubes-Whonix]] and [[Qubes-Whonix]] are supported.

First consider completing the [[#Sanity Tests|sanity tests]] described above; the system is checked for obvious and grave issues that must be fixed before attempting an upgrade. For example, if the package manager is broken due to the mixing of packages from both Debian stable and Debian testing, then the upgrade may fail part way through, leaving the system in an unstable state that is difficult to resolve.

Consider retaining the full terminal (Konsole) log. Even if the upgrade appears successful, there might be issues following reboot. To properly report a bug in the Whonix forums it is necessary to share the upgrade log so the issue can be investigated.

== Update Package and Sources Lists ==

First, [[Security_Guide#Updates|upgrade]] the system's packages from Debian.

=== All Platforms ===

Update Whonix apt sources list.

{{CodeSelect|code=
sudo whonix_repository --enable --codename buster
}}

Update Debian apt sources list.

{{CodeSelect|code=
sudo sed -i "s/stretch/buster/g" /etc/apt/sources.list.d/debian.list
}}

Delete [[Install_Software#Backports|backports]], [[Install_Software#Install_from_Debian_testing|testing]], [[Install_Software#Install_from_Debian_Unstable|unstable]] repository, as well as  [[Install_Software#Install_from_Debian_testing|default release APT config]] snippet. <ref>
Only required if you previously enabled but the command is safe to run even if you did not use it earlier.
</ref>

{{CodeSelect|code=
sudo rm -f /etc/apt/sources.list.d/backports.list /etc/apt/sources.list.d/testing.list /etc/apt/sources.list.d/unstable.list /etc/apt/apt.conf.d/70defaultrelease
}}

=== Qubes-Whonix Only ===
Update Qubes apt sources list.

{{CodeSelect|code=
sudo sed -i "s/stretch/buster/g" /etc/apt/sources.list.d/qubes*.list
}}

{{Anchor|Enable Debugging and Update Select Packages}}

== Preparation ==
Become root.

{{CodeSelect|code=
sudo su
}}

Enable extensive debugging so the reporting of any eventual bugs is easier.

{{CodeSelect|code=
export DEBDEBUG=1
}}

{{Update}}

{{CodeSelect|code=
apt-get update
}}

== Upgrade ==

=== Distribution Upgrade ===
Run.

{{CodeSelect|code=
apt-get-noninteractive dist-upgrade
}}

=== Restart Necessary Services ===

Restart whonix-legacy service. <ref>
A manual restart is required because apt-get-noninteractive is being used. This step is not crucial since it would also run after reboot.
</ref>

{{CodeSelect|code=
service whonix-legacy restart
}}

=== Install Whonix-Gateway and Whonix-Workstation ===

[[Update]] the package lists again. <ref>
This is required because the Whonix repository URI has been upgraded to a new location by the whonix-legacy package.
</ref>

{{CodeSelect|code=
apt-get update
}}

<div class="toccolours mw-collapsible mw-collapsed">
<u>[[Non-Qubes-Whonix]] users</u> please click on expand on the right.
<div class="mw-collapsible-content">
{{mbox
| type    = notice
| image   = [[File:Ambox_notice.png|40px|alt=Info]]
| text    = Non-Qubes-Whonix only! Only complete this step in Whonix-Gateway!
}}


{{CodeSelect|code=
apt-get install non-qubes-whonix-gateway-xfce
}}

{{mbox
| type      = notice
| image   = [[File:Ambox_notice.png|40px|alt=Info]]
| text       = Non-Qubes-Whonix only! Only complete this step in Whonix-Workstation!
}}


{{CodeSelect|code=
apt-get install non-qubes-whonix-workstation-xfce
}}
</div>
</div>

<div class="toccolours mw-collapsible mw-collapsed">
<u>[[Qubes-Whonix]] users</u> please click on expand on the right.
<div class="mw-collapsible-content">
{{mbox
| type    = notice
| image   = [[File:Ambox_notice.png|40px|alt=Info]]
| text    = Qubes-Whonix only! Only complete this step in Whonix-Gateway (<code>whonix-gw-14</code>)!
}}


{{CodeSelect|code=
apt-get install qubes-whonix-gateway
}}

{{mbox
| type    = notice
| image   = [[File:Ambox_notice.png|40px|alt=Info]]
| text    = Qubes-Whonix only! Only complete this step in Whonix-Workstation (<code>whonix-ws-14</code>)!
}}


{{CodeSelect|code=
apt-get install qubes-whonix-workstation
}}

=== Miscellaneous Configuration Steps ===

{{mbox
| type      = notice
| image   = [[File:Ambox_notice.png|40px|alt=Info]]
| text       = Qubes-Whonix Whonix-Workstation (<code>whonix-ws</code>) only! Qubes R4 only!
}}


{{CodeSelect|code=
apt-get install pulseaudio-qubes
}}
</div>
</div>

<!--
If snapshots or backups of the VM were not made, then at least /boot should be backed up.

{{CodeSelect|code=
cp -a /boot /boot.back
}}

Remove the old versions of initrd and create new ones with dracut.

{{CodeSelect|code=
rm /boot/initr*
dracut --regenerate-all
}}

Update GRUB.

{{CodeSelect|code=
update-grub
}}
-->

=== Remove Unneeded Packages and Reinstall Firewall ===

Remove packages which are no longer required.

{{CodeSelect|code=
apt-get autoremove
}}

=== VirtualBox Only ===

The next step is required for [[VirtualBox]] users only! <ref>
This is not always required and depends on the host VirtualBox version; no harm is caused if it is not needed.
</ref>

{{CodeSelect|code=
sudo apt-get install --reinstall virtualbox-guest-*
}}

=== Konsole Log ===

Remember to store the terminal (Konsole) log: <code>File</code> -> <code>Save Output As</code>

Open a new terminal (Konsole) tab. <ref>
Or type <code>exit</code> to sign out as root to get back to user <code>user</code>.
</ref>

=== Whonix APT-Repository ===

Run [[Whonix-APT-Repository|Whonix APT Repository Tool]].

{{CodeSelect|code=
kdesudo whonix-repository-wizard
}}

A poweroff is required.

{{CodeSelect|code=
sudo poweroff
}}

All necessary steps are now complete for [[Non-Qubes-Whonix]] users. [[Qubes-Whonix]] users should complete the additional steps below.

= Footnotes =
{{reflist|close=1}}

[[Category:Documentation]]

{{Footer}}
