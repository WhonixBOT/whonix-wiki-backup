{{DISPLAYTITLE:Reinstall Qubes-Whonix TemplateVMs}}
{{Header}}
{{#seo:
|description=How to Reinstall Qubes-Whonix TemplateVMs.
|image=https://www.whonix.org/w/images/5/55/Qubes-logo-icon.png
}}

== Introduction == 

It may become necessary to reinstall a Whonix TemplateVM from the Qubes repository.<ref>https://qubes-os.org/doc/reinstall-template/</ref> The following represents the more common issues that could necessitate reinstallation. 

Reinstallation may be needed if the template is: 

*'''Broken''' - While TemplateVMs can become broken and/or unbootable for a number of reasons. Both [[Whonix_Debian_Packages#Which_meta_packages_are_safe_to_remove.3F| removing meta-packages]] that Whonix "depends" on to function properly and [[Install_Software#Install_from_Debian_testing| mixing packages]] from a later release have been know to cause this issue. 

*'''Misconfigured''' - Not all TemplateVM modifications are easily reversible. In some cases it may be necessary to reinstall the TemplateVM.

*'''Compromised''' - Users may suspect their TemplateVM has been compromised. For more on this, See: [[FAQ#Am_I_Compromised.3F| Am I Compromised?]]

{{mbox
| image   = [[File:Ambox_warning_pn.svg.png|40px|alt=Whonix first time users warning]]
| text    = 
If the Whonix TemplateVM is broken, misconfigured or compromised users should discontinue using VMs based on affected TemplateVM. 
}}


This is because any TemplateBasedVMs that are based on the affected TemplateVM will inherit the same issues. There could be serious consequences if the VMs are continued to be used. For example, the Whonix security model depends, in part, on <code>sys-whonix</code> forcing all traffic through Tor or blocking it. If <code>sys-whonix</code> was based on a TemplateVM with a misconfigured or broken firewall, the Whonix security model could be broken.<ref>https://whonix.org/Dev/Technical_Introduction#With_more_technical_terms</ref>

== Automated Reinstallation ==


Reinstalling Whonix TemplateVMs is a simple process when the automated method is used. The only action required is to run a single command. 

{{mbox
| type      = notice
| image   = [[File:Ambox_notice.png|40px|alt=Info]]
| text       = Note: The affected TemplateVMs root file system will be lost when reinstalling the new template. It is recommended users create a backup of any important files. 
}}

{{Box|text=
Reinstall the Whonix TemplateVM.

{{Box|text=
{{Qubes_Terminal}}

Execute the following command. Replace <code>qubes-template-package</code> with either: <code>qubes-template-whonix-ws-14</code> or <code>qubes-template-whonix-gw-14</code> respectively

{{CodeSelect|code=
sudo qubes-dom0-update --enablerepo=qubes-templates-community --action=reinstall <qubes-template-package>
}}

For example, to reinstall <code>whonix-ws-14</code> TemplateVM. 

{{CodeSelect|code=
sudo qubes-dom0-update --enablerepo=qubes-templates-community --action=reinstall qubes-template-whonix-ws-14 
}}
}}
Note: Any VMs based on the reinstalled TemplateVM will require a restart to update their file system.

}}
== Manual Reinstallation ==

Whonix TemplateVMs can be manually reinstalled using the following multi-step process. 

Users can skip to Step 2 (remove VMs) if they do not wish to keep the target TemplateVM and/or VMs based on the target because they are broken, misconfigured or otherwise compromised. 

{{Box|text=
In the instructions that follow the term "target TemplateVM" refers to the TemplateVM that will be reinstalled.

{{Box|text=
'''1.''' Clone the target TemplateVM: <code>Qube Manager</code> -> <code>TemplateVM to be cloned</code> -> <code><u>C</u>lone qube</code> -> <code>Enter name for qube clone</code><ref>qvm-clone <target-template> <new-template-clone></ref>

'''2.''' Temporarily change all VMs based on the target TemplateVM to the cloned TemplateVM: <code>Qube Manager</code> -> <code>VM-name</code> -> <code>Qubes s<u>e</u>ttings</code> -> <code>Template:</code><ref>qvm-prefs <vm-name> template <cloned-template></ref>  

Alternately, if the VMs are no longer needed they can be removed: <code>Qube Manager</code> -> <code>VM-name</code> -> <code><u>D</u>elete qube</code> -> <code>Confirm qube removal</code><ref>qvm-remove <vm-name></ref>

'''3.''' Remove the target TemplateVM.
 
{{Box|text=
{{Qubes_Terminal}}

Run the following command replacing <code>qubes-template-package</code> with either: <code>qubes-template-whonix-ws-14</code> or <code>qubes-template-whonix-gw-14</code> respectively.

{{CodeSelect|code=
sudo dnf remove <qubes-template-package>
}}

For example, the following command removes <code>whonix-gw-14</code>.

{{CodeSelect|code=
sudo dnf remove qubes-template-whonix-gw-14
}}
}}

'''4.''' Reinstall the Whonix TemplateVM.

{{CodeSelect|code=
sudo qubes-dom0-update --enablerepo=qube-templates-community --action=reinstall <qubes-template-package>
}}

For example, the following command will reinstall <code>whonix-ws-14</code> TemplateVM.

{{CodeSelect|code=
sudo qubes-dom0-update --enablerepo=qube-templates-community --action=reinstall qubes-template-whonix-ws-14
}}

'''5.''' If the VMs were previously deleted, skip to Step 6 to create new Whonix VMs. Otherwise if the VMs were temporarily changed to the cloned TemplateVM, the reinstallation process is complete when the VMs are changed to the newly reinstalled TemplateVM: <code>Qube Manager</code> -> <code>VM-name</code> -> <code>Qube s<u>e</u>ttings</code> -> <code>Template:</code>

'''6.''' Create new VMs based on the reinstalled TemplateVM: <code>Qube manager</code> -> <code><u>Q</u>ube</code> -> <code>Create new qube</code><ref>qvm-create --template <reinstalled-template> --label red <vm-name></ref> 
}}
{{Box|text=
'''(Optional)''' Users may wish to clone the newly reinstalled TemplateVM and use the clone as the default TemplateVM for AppVMs. The reinstalled TemplateVM can be maintained in a "known-good" state and only used for creating additional Whonix template clones: 

Clone the newly reinstalled TemplateVM: <code>Qube Manager</code> -> <code>TemplateVM to be cloned</code> -> <code><u>C</u>lone qube</code> -> <code>Enter name for qube clone</code> 

Change VMs to the newly cloned TemplateVM: <code>Qube Manager</code> -> <code>VM-name</code> -> <code>Qubes s<u>e</u>ttings</code> -> <code>Template:</code>
}}
}}
= Footnotes =
{{reflist|close=1}}

{{Footer}}

[[Category:Documentation]]
