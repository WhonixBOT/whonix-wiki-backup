{{Header}}
{{#seo:
|description=redirect ports of unix domain socket files from {{gateway_product_name}} localhost to {{workstation_product_name}}
|image=https://www.whonix.org/w/images/2/23/Redirect12123.png
}}
[[image:Redirect12123.png|thumb]]
= Introduction =
Port or unix domain socket file redirection could be useful for any future applications that expect Tor or the <code>ControlPort</code> to listen on any specific port or unix domain socket file that is not (yet) added to [[Dev/anon-ws-disable-stacked-tor|anon-ws-disable-stacked-tor]] b[https://github.com/Whonix/anon-ws-disable-stacked-tor/blob/master/usr/lib/anon-ws-disable-stacked-tor/systemd-unit-files-generator#L20 uild-ins] or c[https://github.com/{{project_name_short}}/anon-ws-disable-stacked-tor/blob/master/etc/anon-ws-disable-stacked-tor.d/30_anon-dist.conf onfig] by default, or for any other port or unix domain socket file redirections from the workstation to the gateway.

= Instructions =
To create a port or unix domain socket file, it is required to create and extend config file <code>/etc/anon-ws-disable-stacked-tor.d/50_user.conf</code>. <ref>https://github.com/{{project_name_short}}/anon-ws-disable-stacked-tor/blob/master/etc/anon-ws-disable-stacked-tor.d/30_anon-dist.conf</ref>

Inside {{workstation_product_name}}.

{{Box|text=
Note: Qubes-Whonix users should use folder <code>/etc/anon-ws-disable-stacked-tor.d</code> rather than folder <code>/usr/local/etc/anon-ws-disable-stacked-tor.d/</code> and apply this in <code>{{whonix-ws}}</code> TemplateVM. <ref>
The missing Qubes-Whonix feature is that <code>/usr/lib/anon-ws-disable-stacked-tor/systemd-unit-files-generator</code> doesn't run at boot time and that files generated by <code>/usr/lib/anon-ws-disable-stacked-tor/systemd-unit-files-generator</code> don't persist after reboot of a TemplateBasedVM.
</ref>

Create folder <code>/usr/local/etc/anon-ws-disable-stacked-tor.d/</code>.

{{CodeSelect|code=
sudo mkdir -p /usr/local/etc/anon-ws-disable-stacked-tor.d
}}

{{Open with root rights|filename=
/usr/local/etc/anon-ws-disable-stacked-tor.d/50_user.conf
}}

Then either add a port redirection.

For example to redirect {{workstation_product_name}} port <code>9100</code> to {{gateway_product_name}} port <code>9050</code>. Note: adjust the port numbers for your needs.

{{CodeSelect|code=
file_port_tuples+=" port#9100:9050 "
}}

Or create a unix domain socket file <code>/var/run/anon-ws-disable-stacked-tor/unix-domain-socket-file.sock</code> and have it forwarded to {{gateway_product_name}} port <code>9050</code>.

{{CodeSelect|code=
file_port_tuples+=" /var/run/anon-ws-disable-stacked-tor/unix-domain-socket-file.sock#9050 "
}}

Save.

Run the <code>systemd-socket-proxyd</code> <code>systemd-unit-files-generator</code>. <ref>
https://github.com/Whonix/anon-ws-disable-stacked-tor/blob/master/usr/lib/anon-ws-disable-stacked-tor/systemd-unit-files-generator
</ref>

{{CodeSelect|code=
sudo /usr/lib/anon-ws-disable-stacked-tor/systemd-unit-files-generator
}}
}}

The process of creating a redirection is now complete.

= Testing =
To test <code>/var/run/anon-ws-disable-stacked-tor/unix-domain-socket-file.sock</code>, you could use:

{{CodeSelect|code=
socat - UNIX-CONNECT:/var/run/anon-ws-disable-stacked-tor/unix-domain-socket-file.sock
}}

Then type:

{{CodeSelect|code=
GET
}}

Then press <code><enter></code>.

The expected reply includes <code>Tor is not an HTTP Proxy</code>.

= Footnotes =
{{reflist|close=1}}
[[Category:Documentation]]
{{Footer}}
