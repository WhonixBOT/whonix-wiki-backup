{{Header}}
{{#seo:
|description=Which {{project_name}} Debian packages are safe to remove? What is a meta package? What other packages do {{project_name}} meta packages install? Which packages should never be removed? Why is package X installed?
|image=https://www.{{project_clearnet}}/w/images/a/aa/Box-158523640.png
}}
[[image:Box-158523640.png|thumb]]

= Introduction =

It is safe to run <code>sudo apt-get autoremove</code> so long as the following packages are kept for the {{non q project name short}} or {{q project name short}} platform. In other words, these packages should <u>not</u> be in the list of autoremoved packages.

[[{{non q project name short}}|{{non q project name}}]] XFCE:

* [[{{gateway_product_name_short}}|{{gateway_product_name}}]]: <code>non-qubes-whonix-gateway-xfce</code>
* [[{{workstation_product_name_short}}|{{workstation_product_name}}]]: <code>non-qubes-whonix-workstation-xfce</code>

[[{{q project name short}}|{{q project name}}]]:

* {{gateway_product_name}}: <code>qubes-whonix-gateway</code>
* {{workstation_product_name}}: <code>qubes-whonix-workstation</code>

<ref>
Ok:
<pre>
The following packages will be REMOVED:
  anon-shared-applications-kde anon-shared-desktop anon-shared-desktop-kde anon-shared-packages-dependencies anon-shared-packages-recommended anon-torchat anon-workstation-default-applications anon-workstation-packages-dependencies libcdio13 libdirectfb-1.2-9
  libgles1-mesa libiso9660-8 libjsoncpp1 libvcdinfo0 libvlccore8 non-qubes-vm-enhancements non-qubes-whonix-workstation thunderbird whonix-shared-packages-dependencies whonix-shared-packages-recommended whonix-workstation-packages-dependencies
  whonix-workstation-packages-recommended xul-ext-torbirdy
0 upgraded, 0 newly installed, 23 to remove and 0 not upgraded.
After this operation, 151 MB disk space will be freed.
Do you want to continue? [Y/n]
</pre>
</ref>

<ref>
Temp:
<pre>
sudo apt-get install enigmail
Reading package lists... Done
Building dependency tree       
Reading state information... Done
Some packages could not be installed. This may mean that you have
requested an impossible situation or if you are using the unstable
distribution that some required packages have not yet been created
or been moved out of Incoming.
The following information may help to resolve the situation:

The following packages have unmet dependencies:
 enigmail : Depends: thunderbird (>= 1:52.0) but it is not going to be installed or
                     icedove (>= 1:52.0)
E: Unable to correct problems, you have held broken packages.
</pre>
</ref>

= Re-install Meta Packages and Safely Run Autoremove =

{{Box|text=
'''1.''' [[Update]] the package lists.

{{CodeSelect|code=
sudo apt update
}}

'''2.''' Ensure a proper meta package is installed.

[[{{non q project name short}}|{{non q project name}}]] XFCE:

* {{gateway_product_name}}: {{CodeSelect|code=
sudo apt install non-qubes-whonix-gateway-xfce
}}
* {{workstation_product_name}}: {{CodeSelect|code=
sudo apt install non-qubes-whonix-workstation-xfce
}}

[[{{q project name short}}|{{q project name}}]]:

* {{gateway_product_name}}: {{CodeSelect|code=
sudo apt install qubes-whonix-gateway
}}
* {{workstation_product_name}}: {{CodeSelect|code=
sudo apt install qubes-whonix-workstation
}}

'''3.''' Auto remove packages.

{{CodeSelect|code=
sudo apt autoremove
}}

'''4.''' Reconfirm a proper meta package is still installed.

Repeat step two.

'''5.''' Done.

The procedure of safely running <code>sudo apt autoremove</code> is complete.

Related: [[Factory Reset|{{project name}} Factory Reset]]
}}

= Changed Configuration Files =

Be careful if a message like this appears.

<pre>
Configuration file '/etc/apparmor.d/usr.bin.sdwdate'
Configuration file '/etc/apparmor.d/whonix-firewall'
 ==> Modified (by you or by a script) since installation.
 ==> Package distributor has shipped an updated version.
   What would you like to do about it ?  Your options are:
    Y or I  : install the package maintainer's version
    N or O  : keep your currently-installed version
      D     : show the differences between the versions
      Z     : start a shell to examine the situation
 The default action is to keep your current version.
*** whonix-firewall (Y/I/N/O/D/Z) [default=N] ? 
</pre>

For general advice, see: [[Operating_System_Software_and_Updates#Changed_Configuration_Files|Changed Configuration Files]]. A rule of thumb is to select <code>Y</code> or <code>I</code> for packages coming from {{project_name}}, and <code>N</code> for packages coming from other distributions. <ref>Otherwise settings affecting anonymity, privacy and security might be lost.</ref>

As per the previous link, always install configuration file changes for the following {{project_name}} files which are not an exception:

* <code>/etc/apparmor.d/usr.bin.sdwdate</code>
* <code>/etc/apparmor.d/whonix-firewall</code>

= Non-Issues =

The following messages are expected and it is safe to autoremove these packages.

<pre>
The following packages were automatically installed and are no longer required:
  whonix-workstation-default-applications-gui whonix-ws-desktop-shortcuts
</pre>

<pre>
The following packages were automatically installed and are no longer required:
  whonix-gw-desktop-shortcuts
</pre>

= Advanced Topics =
{{Anchor|Disadvantage}}

== Packages FAQ ==

'''Table:''' ''Meta-packages Frequently Asked Questionss'' 

{| class="wikitable"
|-

! scope="col"| '''Question'''
! scope="col"| '''Answer'''
|-

! scope="row"| What is the disadvantage of removing a meta package?
| The disadvantage is any changes in package dependencies will not be automatically processed by the system when it is [[Security_Guide#Updates|upgraded]].

For example the {{Code2|anon-workstation-packages-recommended}} meta package depends <ref>{{Code2|Depends:}} field in {{Code2|debian/control}}</ref> on {{Code2|[https://github.com/{{project_name_short}}/tb-updater tb-updater]}}. If the {{Code2|anon-workstation-packages-recommended}} package is not installed, you would not notice if {{Code2|tb-updater}} was [https://phabricator.whonix.org/T18 replaced] with [https://github.com/micahflee/torbrowser-launcher {{Code2|torbrowser-launcher}}]. {{Code2|tb-updater}} might become unmaintained, broken or even have unfixed security issues. {{project_name}} tries to [[Stay Tuned|keep users up-to-date]] if/when (security relevant) packages are deprecated. If that occurs, you could simply run {{Code2|sudo apt-get purge tb-updater}} and consider installing what the {{project_name}} meta package recommends as a replacement.

See also: [[#Technical_Information|Technical Information]].
{{Anchor|Which ones are safe to remove?}}
|-

! scope="row"| Which meta packages are safe to remove?
| Use apt-cache to see the package description.

* Replace <code>package-name</code> with the package you intend to install.

{{CodeSelect|code=
apt-cache package-name
}}

It will include either:

* <code>Safe to remove, if you know what you are doing.</code>; or
* <code>Do not remove.</code>

Note the [[#Removal Instructions|Removal Instructions]] below! When that entry is understood, feel free to remove any [[#Non-Issues|desktop specific meta packages]].
|-

! scope="row"| Which packages do {{project_name}} meta packages install?
| See {{Code2|debian/control}} in {{project_name}} [https://github.com/{{project_name_short}}/anon-meta-packages anon-meta-packages] source code folder or [https://github.com/{{project_name_short}}/anon-meta-packages/blob/master/debian/control on github] (choose the correct branch!).

Or use for example.

{{CodeSelect|code=
apt-cache show whonix-workstation-default-applications-gui
}}
{{Anchor|Which packages should never be removed?}}
|-

! scope="row"| Which meta packages should never be removed?
| Do not remove {{Code2|...-dependencies}} packages, unless the implications are fully understood.

TODO: document
|-

! scope="row"| Why is package X installed?
| Look up the package in question in developer and packages documentation:

* https://github.com/{{project_name_short}}/whonix-developer-meta-files/blob/master/package_documentation/{{project_name_short}}-Shared_packages
* https://github.com/{{project_name_short}}/whonix-developer-meta-files/blob/master/package_documentation/{{gateway_product_name_short}}_packages
* https://github.com/{{project_name_short}}/whonix-developer-meta-files/blob/master/package_documentation/{{workstation_product_name_short}}_packages
|-

|}

== Removal Instructions ==

These instructions allow for safe removal of a package (in this example the <code>uwt</code> package). This results in meta package removal without breaking the whole system when next time running <code>sudo apt-get autoremove</code>.

{{Box|text=
'''1.''' Upgrade. 

[[Operating_System_Software_and_Updates|Upgrade the system]].

'''2.''' Clean up.

If custom packages were installed and uninstalled or dependencies changed in the meanwhile, remove unneeded dependencies first.

{{CodeSelect|code=
sudo apt-get autoremove
}}

'''3.''' Uninstall. 

As an example, consider how the [https://github.com/{{project_name_short}}/uwt {{Code2|uwt}}] package could be uninstalled.

{{CodeSelect|code=
sudo apt-get purge uwt
}}

A message will appear similar to this.

<pre>
Reading package lists... Done
Building dependency tree       
Reading state information... Done
The following packages were automatically installed and are no longer required:
  anon-banned-packages anon-iceweasel-warning gpl-sources-download knetattach-hide power-savings-disable-in-vms poweroff-passwordless rads scurl shared-folder-help swap-file-creator swappiness-lowest tor-ctrl
Use 'apt-get autoremove' to remove them.
The following packages will be REMOVED:
  anon-shared-packages-recommended* uwt* whonix-shared-packages-recommended*
0 upgraded, 0 newly installed, 3 to remove and 2 not upgraded.
After this operation, 152 kB disk space will be freed.
Do you want to continue [Y/n]? 
</pre>

'''4.''' Keep packages installed by meta packages. 

Now, there is a small issue: 
* Next time the {{Code2|sudo apt-get autoremove}} command is run, all packages listed under "{{Code2|The following packages were automatically installed and are no longer required:}}" would also be uninstalled. (Such as {{Code2|[https://github.com/{{project_name_short}}/rads rads]}} and others.) 
* In order to keep the other packages which were installed by the {{Code2|anon-shared-packages-recommended}} and the {{Code2|whonix-shared-packages-recommended}} meta packages, mark them as manually installed so they do not get removed. This can be conveniently achieved with {{Code2|aptitude}}. <ref>https://unix.stackexchange.com/questions/166590/what-is-the-apt-get-equvalent-of-aptitude-keep-all</ref> <ref>
It is possible to safely mix {{Code2|apt-get}} and {{Code2|aptitude}}. Raphaël Hertzog, dpkg and Debian Developer, stated in 2011 that this is not a problem anymore:

<blockquote>
First I want to make it clear that you can use both and mix them without problems. It used to be annoying when apt-get did not track which packages were automatically installed while aptitude did, but now that both packages share this list, there’s no reason to avoid switching back and forth.
</blockquote>

Source: [http://raphaelhertzog.com/2011/06/20/apt-get-aptitude-%E2%80%A6-pick-the-right-debian-package-manager-for-you/ apt-get, aptitude, … pick the right Debian package manager for you]
</ref>

{{CodeSelect|code=
sudo aptitude keep-all
}}

'''5.''' Done. 

The procedure is complete. Be sure to understand the [[#Disadvantage|disadvantage]] of this approach.
}}

Alternatively, there might be a very crude workaround which is discussed in the following forum topic:
[https://forums.whonix.org/t/issues-with-removal-of-specific-packages-by-users-builders/653/9 Issues with removal of specific packages by users / builders].

== Technical Information ==

{{mbox
| type    = notice
| image   = [[File:Ambox_notice.png|40px|alt=Info]]
| text    = This section provides technical information for interested readers and can be skipped.
}}

The underlying technical issues with meta packages are not caused by {{project_name}}, but instead have been inherited from Debian. Those are also described here:

* [https://administratosphere.wordpress.com/2011/11/29/the-metapackage-problem-and-apt-get-autoremove/ The Metapackage Problem and apt-get autoremove]
* [https://tanguy.ortolo.eu/blog/article8/uninstall-meta-package Uninstalling a single component of a meta-package]
* [https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=942303 Debian bug report: Weak-Depends - something in the middle between 'Recommends:' and 'Depends:']

The Debian manual also provides further information about meta packages:

* [https://www.debian.org/doc/manuals/developers-reference/best-pkging-practices.html#bpp-meta Best practices for meta-packages] 

The {{project name}} build script installs all packages using <code>apt-get --no-install-recommends</code>. <ref>
Function <code>pkg-install-maybe</code> in https://github.com/{{project_name_short}}/{{project_name_short}}/blob/master/build-steps.d/1700_install-packages#L97.
</ref> The <code>--no-install-recommends</code> option is being used to prevent installation of many additional packages that are unwanted. For example:
* <code>anon-workstation-default-applications</code> <code>Depends: gwenview</code>.
* gwenview <code>Recommends: kamera</code>. 
* Without using <code>--no-install-recommends</code>, <code>kamera</code> would also be installed and then pull its own <code>Depends:</code> as well. 
* <code>kamera</code> [+ dependencies] would not be useful to have installed by default on {{workstation_product_name}} as it would cost unnecessary disk space. There are many more examples which could end up installing packages by default that are unrecommended for privacy reasons.

Since the <code>--no-install-recommends</code> option is used, meta packages like <code>anon-workstation-default-applications</code> must use the <code>Depends:</code> field and cannot use the <code>Recommends:</code> field. (Since no packages would be installed then.)

Even if {{project_name}} could and did use the <code>Recommends:</code> field, new packages added to the <code>Recommends:</code> field would not be installed when the meta package that <code>Recommends:</code> them gets upgraded. This is because packages listed after the <code>Recommends:</code> field only get installed during their initial <code>sudo apt-get install package-name</code> installation.

Some readers might notice that despite this explanation, <code>anon-meta-packages</code>'s <code>debian/control</code> file uses the <code>Recommends:</code> field anyway. This is not a contradiction because it may be useful for a later [[Dev/Installation_from_Repository|{{project_name}} installation from {{project_name}} repository]] use case.

Forum discussion:<br />
[https://forums.whonix.org/t/issues-with-removal-of-specific-packages-by-users-builders Issues with removal of specific packages by users / builders]

= See Also =
* [[Configuration_Files#Configuration_Drop-In_Folders|Configuration Drop-In Folders]]
* [[Configuration_Files#Reset_Configuration_Files_to_Vendor_Default|Reset Configuration Files to Vendor Default]]
* [[Factory Reset|{{project name}} Factory Reset]]
* [[{{project name short}} Packages for Debian Hosts]]
* [[Project-APT-Repository|{{project name}} APT Repository, how to enable/disable it?]]
* [[Dev/Build Documentation‏‎|Building/upgrading {{project name}} debian packages from source code]]
* [[Dev/Installation_from_Repository|Development Discussion - Installing {{project_name}} from repository]]

= Footnotes =
{{reflist|close=1}}

{{Footer}}

[[Category:Documentation]]
